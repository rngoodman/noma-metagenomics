<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.55">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Richard Goodman">
<meta name="dcterms.date" content="2025-06-20">

<title>Noma Metagenomics: Short-read taxonomic based metagenomic analysis of noma vs healthy human saliva samples in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Noma vs healthy_files/libs/clipboard/clipboard.min.js"></script>
<script src="Noma vs healthy_files/libs/quarto-html/quarto.js"></script>
<script src="Noma vs healthy_files/libs/quarto-html/popper.min.js"></script>
<script src="Noma vs healthy_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Noma vs healthy_files/libs/quarto-html/anchor.min.js"></script>
<link href="Noma vs healthy_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Noma vs healthy_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Noma vs healthy_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Noma vs healthy_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Noma vs healthy_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Noma Metagenomics: Short-read taxonomic based metagenomic analysis of noma vs healthy human saliva samples in R</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Richard Goodman </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 20, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>This analysis was used in the short-read (Illumina) taxonomic based metagenomic analysis of noma vs healthy human saliva samples in R posted as a preprint on bioRxiv:</p>
<p>Shotgun metagenomic analysis of the oral microbiomes of noma patients reveals a novel disease-associated organism and potential avenues for disease prevention</p>
<p>Olaleye, M., O’Ferrall A.M., Goodman, R.N. et al.&nbsp;</p>
<section id="getting-started-in-r" class="level1">
<h1>1. Getting Started in R</h1>
<section id="installing-and-loading-packages" class="level2">
<h2 class="anchored" data-anchor-id="installing-and-loading-packages">1.1 Installing and Loading Packages</h2>
<p>Install all necessary packages into R.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make sure these are all installed as packages first </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary libraries</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pheatmap)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(miaViz)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scater)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mia)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(TreeSummarizedExperiment)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(phyloseq)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DESeq2)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggsignif)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vegan)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(randomForest)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(e1071)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ROCR)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="import-and-clean-data" class="level1">
<h1>2. Import and Clean Data</h1>
<p>We will be importing MetaPhlan style Bracken data</p>
<p>First we’ll write a function to import MetaPhlan style bracken data</p>
<section id="load-taxonomic-data" class="level2">
<h2 class="anchored" data-anchor-id="load-taxonomic-data">2.1 Load taxonomic data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>file_path <span class="ot">=</span>  <span class="st">"../data/noma_HMP_saliva_bracken_MetaPhlan_style_report_bacteria_noma_v_healthy_saliva_A1_A19_corrGB.txt"</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>sample_data_path <span class="ot">=</span> <span class="st">"../data/Samples_healthy_v_noma_saliva_A1_A19_corrGB.csv"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Import data</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>tse_metaphlan_noma <span class="ot">=</span> <span class="fu">loadFromMetaphlan</span>(file_path)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Defining the TSE for the rest of the script</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>tse_metaphlan <span class="ot">=</span> tse_metaphlan_noma</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="add-metadata" class="level2">
<h2 class="anchored" data-anchor-id="add-metadata">2.2 Add metadata</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>patient_metadata <span class="ot">=</span> <span class="fu">read_excel</span>(<span class="st">"../data/micro_study_metadata.xlsx"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>sample_to_patient <span class="ot">=</span> <span class="fu">read_excel</span>(<span class="st">"../data/sample_to_patient_A1_A40.xlsx"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>metadata <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">inner_join</span>(patient_metadata, sample_to_patient, <span class="at">by =</span> <span class="st">"respondent_id"</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>metadata_2 <span class="ot">=</span> metadata <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sample_name  <span class="sc">%in%</span> <span class="fu">colnames</span>(tse_metaphlan_noma))</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>coldata <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">sample_name =</span> <span class="fu">colnames</span>(tse_metaphlan_noma))</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>metadata_3 <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(coldata, metadata_2, <span class="at">by =</span> <span class="st">"sample_name"</span>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a DataFrame with this information</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>metadata_df <span class="ot">=</span> <span class="fu">DataFrame</span>(metadata_3)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(metadata_df) <span class="ot">=</span> metadata_3<span class="sc">$</span>sample_name</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>t_metadata_df <span class="ot">=</span> <span class="fu">t</span>(metadata_df)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ncol</span>(t_metadata_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 37</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add this DataFrame as colData to your TreeSummarizedExperiment object</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colData</span>(tse_metaphlan_noma) <span class="ot">=</span> metadata_df</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>tse_metaphlan <span class="ot">=</span> tse_metaphlan_noma</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="adding-diseased-or-healthy-condition-metadata" class="level2">
<h2 class="anchored" data-anchor-id="adding-diseased-or-healthy-condition-metadata">2.3 Adding diseased or healthy condition metadata</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assume your TreeSummarizedExperiment object is called `tse`</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the current sample names (column names)</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>sample_names <span class="ot">&lt;-</span> <span class="fu">colnames</span>(tse_metaphlan)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>sample_names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "A10"        "A11"        "A13"        "A14"        "A16"       
 [6] "A17"        "A18"        "A19"        "A1"         "A2"        
[11] "A3"         "A4"         "A5"         "A6"         "A7"        
[16] "A8"         "A9"         "DRR214959"  "DRR214960"  "DRR214961" 
[21] "DRR214962"  "DRR241310"  "SRR5892208" "SRR5892209" "SRR5892210"
[26] "SRR5892211" "SRR5892212" "SRR5892213" "SRR5892214" "SRR5892215"
[31] "SRR5892216" "SRR5892217" "SRS013942"  "SRS014468"  "SRS014692" 
[36] "SRS015055"  "SRS019120" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a vector indicating the condition (diseased or healthy)</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># sample_1 to sample_17 are diseased, and sample_18 to sample_37 are healthy</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>condition <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"diseased"</span>, <span class="dv">17</span>), <span class="fu">rep</span>(<span class="st">"healthy"</span>, <span class="dv">20</span>))</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a DataFrame with this information</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>sample_metadata_disease <span class="ot">&lt;-</span> <span class="fu">DataFrame</span>(<span class="at">condition =</span> condition)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(sample_metadata_disease) <span class="ot">=</span> sample_names</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>sample_metadata_disease</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>DataFrame with 37 rows and 1 column
            condition
          &lt;character&gt;
A10          diseased
A11          diseased
A13          diseased
A14          diseased
A16          diseased
...               ...
SRS013942     healthy
SRS014468     healthy
SRS014692     healthy
SRS015055     healthy
SRS019120     healthy</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add this DataFrame as colData to your TreeSummarizedExperiment object</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colData</span>(tse_metaphlan) <span class="ot">&lt;-</span> sample_metadata_disease</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Check that colData was added successfully</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">as.data.frame</span>(<span class="fu">colData</span>(tse_metaphlan)), <span class="at">n =</span> <span class="dv">37</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           condition
A10         diseased
A11         diseased
A13         diseased
A14         diseased
A16         diseased
A17         diseased
A18         diseased
A19         diseased
A1          diseased
A2          diseased
A3          diseased
A4          diseased
A5          diseased
A6          diseased
A7          diseased
A8          diseased
A9          diseased
DRR214959    healthy
DRR214960    healthy
DRR214961    healthy
DRR214962    healthy
DRR241310    healthy
SRR5892208   healthy
SRR5892209   healthy
SRR5892210   healthy
SRR5892211   healthy
SRR5892212   healthy
SRR5892213   healthy
SRR5892214   healthy
SRR5892215   healthy
SRR5892216   healthy
SRR5892217   healthy
SRS013942    healthy
SRS014468    healthy
SRS014692    healthy
SRS015055    healthy
SRS019120    healthy</code></pre>
</div>
</div>
</section>
<section id="inspecting-the-data" class="level2">
<h2 class="anchored" data-anchor-id="inspecting-the-data">2.4 Inspecting the Data</h2>
<p>You can inspect the data with these functions.</p>
<p>The output is not printed here as it would be too large.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>(count <span class="ot">&lt;-</span> <span class="fu">assays</span>(tse_metaphlan)[[<span class="dv">1</span>]])</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">rowData</span>(tse_metaphlan))</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">colData</span>(tse_metaphlan))</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">metadata</span>(tse_metaphlan))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="converting-tse-to-other-common-data-formats-e.g.-phyloseq" class="level2">
<h2 class="anchored" data-anchor-id="converting-tse-to-other-common-data-formats-e.g.-phyloseq">2.5 Converting TSE to other common data formats e.g.&nbsp;Phyloseq</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>phyloseq_metaphlan <span class="ot">=</span> <span class="fu">makePhyloseqFromTreeSE</span>(tse_metaphlan)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>phyloseq_obj <span class="ot">=</span> <span class="fu">makePhyloseqFromTreeSE</span>(tse_metaphlan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="non-parametric-statistical-tests" class="level1">
<h1>3. Non-parametric statistical tests</h1>
<p>Non-parametric methods were used to determine the difference between samples based on the categorical variable of disease status. Non-parametric tests are used for metagenomic data due to the non-normal distribution of the data. We used the Bray-Curtis dissimilarity matrix for all these tests.</p>
<section id="preparing-the-data" class="level2">
<h2 class="anchored" data-anchor-id="preparing-the-data">3.1 Preparing the data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># See above "Converting TSE to other common data formats e.g. Phyloseq"</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Use makePhyloseqFromTreeSE from Miaverse</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>tse_metaphlan_noma <span class="ot">=</span> tse_metaphlan</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># make an assay for abundance</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>tse_metaphlan_noma <span class="ot">&lt;-</span> <span class="fu">transformAssay</span>(tse_metaphlan_noma, <span class="at">assay.type=</span><span class="st">"counts"</span>, <span class="at">method=</span><span class="st">"relabundance"</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="fu">taxonomyRanks</span>(tse_metaphlan_noma)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Kingdom" "Phylum"  "Class"   "Order"   "Family"  "Genus"   "Species"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colData</span>(tse_metaphlan_noma)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>DataFrame with 37 rows and 1 column
            condition
          &lt;character&gt;
A10          diseased
A11          diseased
A13          diseased
A14          diseased
A16          diseased
...               ...
SRS013942     healthy
SRS014468     healthy
SRS014692     healthy
SRS015055     healthy
SRS019120     healthy</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make an altExp and matrix for order</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>tse_metaphlan_noma_genus <span class="ot">=</span> <span class="fu">altExp</span>(tse_metaphlan_noma, <span class="st">"Genus"</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add metadata to colData </span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colData</span>(tse_metaphlan_noma_genus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>DataFrame with 37 rows and 0 columns</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colData</span>(tse_metaphlan_noma_genus) <span class="ot">&lt;-</span> sample_metadata_disease</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>metadata_df <span class="ot">=</span> <span class="fu">colData</span>(tse_metaphlan_noma_genus)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>metadata_noma_genus <span class="ot">=</span> <span class="fu">as.data.frame</span>(<span class="fu">colData</span>(tse_metaphlan_noma_genus))</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>metadata_noma_genus</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           condition
A10         diseased
A11         diseased
A13         diseased
A14         diseased
A16         diseased
A17         diseased
A18         diseased
A19         diseased
A1          diseased
A2          diseased
A3          diseased
A4          diseased
A5          diseased
A6          diseased
A7          diseased
A8          diseased
A9          diseased
DRR214959    healthy
DRR214960    healthy
DRR214961    healthy
DRR214962    healthy
DRR241310    healthy
SRR5892208   healthy
SRR5892209   healthy
SRR5892210   healthy
SRR5892211   healthy
SRR5892212   healthy
SRR5892213   healthy
SRR5892214   healthy
SRR5892215   healthy
SRR5892216   healthy
SRR5892217   healthy
SRS013942    healthy
SRS014468    healthy
SRS014692    healthy
SRS015055    healthy
SRS019120    healthy</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># genus</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>phyloseq_noma <span class="ot">=</span> <span class="fu">makePhyloseqFromTreeSE</span>(tse_metaphlan_noma_genus)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>phyloseq_noma_esd <span class="ot">=</span> <span class="fu">transform_sample_counts</span>(phyloseq_noma, <span class="cf">function</span>(x) <span class="fl">1E6</span> <span class="sc">*</span> x<span class="sc">/</span><span class="fu">sum</span>(x))</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ntaxa</span>(phyloseq_noma_esd) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1757</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nsamples</span>(phyloseq_noma_esd) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 37</code></pre>
</div>
</div>
</section>
<section id="permanova-across-entire-dataset" class="level2">
<h2 class="anchored" data-anchor-id="permanova-across-entire-dataset">3.1 Permanova across entire dataset</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123456</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate bray curtis distance matrix on main variables </span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>noma.bray <span class="ot">=</span> phyloseq<span class="sc">::</span><span class="fu">distance</span>(phyloseq_noma_esd, <span class="at">method =</span> <span class="st">"bray"</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>sample.noma.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">sample_data</span>(phyloseq_noma_esd))</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>permanova_all <span class="ot">=</span> vegan<span class="sc">::</span><span class="fu">adonis2</span>(noma.bray <span class="sc">~</span> condition , <span class="at">data =</span> sample.noma.df)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>permanova_all</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Permutation test for adonis under reduced model
Permutation: free
Number of permutations: 999

vegan::adonis2(formula = noma.bray ~ condition, data = sample.noma.df)
         Df SumOfSqs      R2      F Pr(&gt;F)    
Model     1   2.5163 0.40556 23.879  0.001 ***
Residual 35   3.6881 0.59444                  
Total    36   6.2044 1.00000                  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Next we will test the beta dispersion</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># All together now</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>vegan<span class="sc">::</span><span class="fu">adonis2</span>(noma.bray <span class="sc">~</span> condition, <span class="at">data =</span> sample.noma.df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Permutation test for adonis under reduced model
Permutation: free
Number of permutations: 999

vegan::adonis2(formula = noma.bray ~ condition, data = sample.noma.df)
         Df SumOfSqs      R2      F Pr(&gt;F)    
Model     1   2.5163 0.40556 23.879  0.001 ***
Residual 35   3.6881 0.59444                  
Total    36   6.2044 1.00000                  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">betadisper</span>(noma.bray, sample.noma.df<span class="sc">$</span>condition)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">permutest</span>(beta)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Permutation test for homogeneity of multivariate dispersions
Permutation: free
Number of permutations: 999

Response: Distances
          Df  Sum Sq  Mean Sq      F N.Perm Pr(&gt;F)  
Groups     1 0.07827 0.078269 3.8016    999  0.056 .
Residuals 35 0.72060 0.020589                       
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># we don't want this to be significant </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="anosim-across-entire-dataset" class="level2">
<h2 class="anchored" data-anchor-id="anosim-across-entire-dataset">3.2 Anosim across entire dataset</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>condition_group <span class="ot">=</span> <span class="fu">get_variable</span>(phyloseq_noma_esd, <span class="st">"condition"</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span> (<span class="dv">123456</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="fu">anosim</span>(<span class="fu">distance</span>(phyloseq_noma_esd, <span class="st">"bray"</span>), condition_group)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
anosim(x = distance(phyloseq_noma_esd, "bray"), grouping = condition_group) 
Dissimilarity: bray 

ANOSIM statistic R: 0.734 
      Significance: 0.001 

Permutation: free
Number of permutations: 999</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>condition_ano <span class="ot">=</span> <span class="fu">anosim</span>(<span class="fu">distance</span>(phyloseq_noma_esd, <span class="st">"bray"</span>), condition_group)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>condition_ano</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
anosim(x = distance(phyloseq_noma_esd, "bray"), grouping = condition_group) 
Dissimilarity: bray 

ANOSIM statistic R: 0.734 
      Significance: 0.001 

Permutation: free
Number of permutations: 999</code></pre>
</div>
</div>
</section>
<section id="mrpp-across-entire-dataset" class="level2">
<h2 class="anchored" data-anchor-id="mrpp-across-entire-dataset">3.3 MRPP across entire dataset</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">#condition</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>noma.bray <span class="ot">&lt;-</span> phyloseq<span class="sc">::</span><span class="fu">distance</span>(phyloseq_noma_esd, <span class="at">method =</span> <span class="st">"bray"</span>) <span class="co"># Calculate bray curtis distance matrix</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>condition_group <span class="ot">=</span> <span class="fu">get_variable</span>(phyloseq_noma_esd, <span class="st">"condition"</span>) <span class="co"># Make condition Grouping</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Run MRPP</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123456</span>)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>vegan<span class="sc">::</span><span class="fu">mrpp</span>(noma.bray, condition_group, <span class="at">permutations =</span> <span class="dv">999</span>, </span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">weight.type =</span> <span class="dv">1</span>, <span class="at">strata =</span> <span class="cn">NULL</span>, <span class="at">parallel =</span> <span class="fu">getOption</span>(<span class="st">"mc.cores"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
vegan::mrpp(dat = noma.bray, grouping = condition_group, permutations = 999,      weight.type = 1, strata = NULL, parallel = getOption("mc.cores")) 

Dissimilarity index: bray 
Weights for groups:  n 

Class means and counts:

      diseased healthy
delta 0.4931   0.3533 
n     17       20     

Chance corrected within-group agreement A: 0.2364 
Based on observed delta 0.4176 and expected delta 0.5468 

Significance of delta: 0.001 
Permutation: free
Number of permutations: 999</code></pre>
</div>
</div>
</section>
<section id="outputting-non-paramteric-tests-into-table" class="level2">
<h2 class="anchored" data-anchor-id="outputting-non-paramteric-tests-into-table">3.4 Outputting non paramteric tests into table</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the list of metadata variables you want to test</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>variables_to_test <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"condition"</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set a seed for reproducibility of permutation-based tests</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123456</span>)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>bray_dist <span class="ot">&lt;-</span> phyloseq<span class="sc">::</span><span class="fu">distance</span>(phyloseq_noma_esd, <span class="at">method =</span> <span class="st">"bray"</span>)</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the sample data into a data frame for use with adonis2</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>sample_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">sample_data</span>(phyloseq_noma_esd))</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an empty list to store the results from each iteration</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>results_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through each variable name in the 'variables_to_test' vector</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (variable <span class="cf">in</span> variables_to_test) {</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="fu">paste</span>(<span class="st">"Running tests for variable:"</span>, variable))</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># PERMANOVA (adonis2) </span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the statistical formula dynamically for the current variable</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>  formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">"bray_dist ~"</span>, variable))</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Run the PERMANOVA test using the adonis2 function</span></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>  permanova_res <span class="ot">&lt;-</span> vegan<span class="sc">::</span><span class="fu">adonis2</span>(formula, <span class="at">data =</span> sample_df, <span class="at">permutations =</span> <span class="dv">999</span>)</span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract the p-value from the results. It's in the 'Pr(&gt;F)' column.</span></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>  p_permanova <span class="ot">&lt;-</span> permanova_res<span class="sc">$</span><span class="st">`</span><span class="at">Pr(&gt;F)</span><span class="st">`</span>[<span class="dv">1</span>]</span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ANOSIM </span></span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the grouping factor (the actual variable data) from the phyloseq object</span></span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>  grouping_factor <span class="ot">&lt;-</span> phyloseq<span class="sc">::</span><span class="fu">get_variable</span>(phyloseq_noma_esd, variable)</span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Run the ANOSIM test</span></span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>  anosim_res <span class="ot">&lt;-</span> vegan<span class="sc">::</span><span class="fu">anosim</span>(bray_dist, grouping_factor, <span class="at">permutations =</span> <span class="dv">999</span>)</span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract the p-value (significance) from the ANOSIM result</span></span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>  p_anosim <span class="ot">&lt;-</span> anosim_res<span class="sc">$</span>signif</span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># MRPP </span></span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The grouping factor is the same as for ANOSIM</span></span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Run the MRPP test</span></span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a>  mrpp_res <span class="ot">&lt;-</span> vegan<span class="sc">::</span><span class="fu">mrpp</span>(bray_dist, grouping_factor, <span class="at">permutations =</span> <span class="dv">999</span>)</span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract the p-value from the MRPP result</span></span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a>  p_mrpp <span class="ot">&lt;-</span> mrpp_res<span class="sc">$</span>Pvalue</span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Store Results </span></span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Store the p-values for the current variable in our results list.</span></span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We create a small data frame for this iteration's results.</span></span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a>  results_list[[variable]] <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">Variable =</span> <span class="fu">paste0</span>(variable, <span class="st">"."</span>),</span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">permanova.</span><span class="st">`</span> <span class="ot">=</span> p_permanova,</span>
<span id="cb39-54"><a href="#cb39-54" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">anosim.</span><span class="st">`</span> <span class="ot">=</span> p_anosim,</span>
<span id="cb39-55"><a href="#cb39-55" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">mrpp.</span><span class="st">`</span> <span class="ot">=</span> p_mrpp,</span>
<span id="cb39-56"><a href="#cb39-56" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 'check.names = FALSE' prevents R from changing our column names</span></span>
<span id="cb39-57"><a href="#cb39-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">check.names =</span> <span class="cn">FALSE</span> </span>
<span id="cb39-58"><a href="#cb39-58" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-59"><a href="#cb39-59" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Running tests for variable: condition</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the list of individual data frames into one final table</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>final_results_table <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, results_list)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean up the row names of the final table</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(final_results_table) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the final, consolidated table to the console</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(final_results_table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Variable permanova. anosim. mrpp.
1 condition.      0.001   0.001 0.001</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(final_results_table, <span class="at">file =</span><span class="st">"../tbls/Table_1A.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="permanova-function-for-specific-taxa" class="level2">
<h2 class="anchored" data-anchor-id="permanova-function-for-specific-taxa">3.5 Permanova function for specific taxa</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a </span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>tse_metaphlan_genus <span class="ot">=</span> <span class="fu">altExp</span>(tse_metaphlan, <span class="st">"Genus"</span>) </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the counts and taxonomic table</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>counts <span class="ot">&lt;-</span> <span class="fu">assay</span>(tse_metaphlan_genus, <span class="st">"counts"</span>)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>tax_table <span class="ot">&lt;-</span> <span class="fu">rowData</span>(tse_metaphlan_genus)<span class="sc">$</span>Genus  <span class="co"># Replace "Genus" with your taxonomic level of interest</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>sample_data <span class="ot">&lt;-</span> <span class="fu">colData</span>(tse_metaphlan_genus)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>groups <span class="ot">=</span> <span class="fu">as.data.frame</span>(sample_data)</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate counts by Genus</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>aggregated_counts <span class="ot">&lt;-</span> <span class="fu">rowsum</span>(counts, tax_table)</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new aggregated TreeSummarizedExperiment object</span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>tse_aggregated <span class="ot">&lt;-</span> <span class="fu">TreeSummarizedExperiment</span>(<span class="at">assays =</span> <span class="fu">list</span>(<span class="at">counts =</span> aggregated_counts), </span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">colData =</span> sample_data)</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate relative abundances</span></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>relative_abundances <span class="ot">&lt;-</span> <span class="fu">sweep</span>(<span class="fu">assay</span>(tse_aggregated, <span class="st">"counts"</span>), <span class="dv">2</span>, <span class="fu">colSums</span>(<span class="fu">assay</span>(tse_aggregated, <span class="st">"counts"</span>)), <span class="at">FUN =</span> <span class="st">"/"</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to a data frame and group by Treatment</span></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>relative_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(relative_abundances))</span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span> (<span class="dv">123456</span>)</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the vector of genera names (without the "g__" prefix)</span></span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>genera <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Prevotella"</span>, <span class="st">"Treponema"</span>, <span class="st">"Neisseria"</span>, <span class="st">"Bacteroides"</span>, </span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Filifactor"</span>, <span class="st">"Porphyromonas"</span>, <span class="st">"Fusobacterium"</span>, <span class="st">"Escherichia"</span>,</span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Selenomonas"</span>, <span class="st">"Aggregatibacter"</span>, <span class="st">"Capnocytophaga"</span>)</span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize an empty data frame to store the results</span></span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a>permanova_taxa_results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Genus =</span> <span class="fu">character</span>(), <span class="at">pvalue =</span> <span class="fu">numeric</span>(), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over each genus</span></span>
<span id="cb44-35"><a href="#cb44-35" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (genus <span class="cf">in</span> genera) {</span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span> (<span class="dv">123456</span>)</span>
<span id="cb44-37"><a href="#cb44-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Subset the data for the genus; adjust column selection as needed</span></span>
<span id="cb44-38"><a href="#cb44-38" aria-hidden="true" tabindex="-1"></a>  subset_data <span class="ot">&lt;-</span> relative_df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">paste0</span>(<span class="st">"g__"</span>, genus))</span>
<span id="cb44-39"><a href="#cb44-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-40"><a href="#cb44-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate the Bray-Curtis distance</span></span>
<span id="cb44-41"><a href="#cb44-41" aria-hidden="true" tabindex="-1"></a>  bray_dist <span class="ot">&lt;-</span> <span class="fu">vegdist</span>(subset_data, <span class="at">method =</span> <span class="st">"bray"</span>)</span>
<span id="cb44-42"><a href="#cb44-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-43"><a href="#cb44-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Run PERMANOVA using adonis2</span></span>
<span id="cb44-44"><a href="#cb44-44" aria-hidden="true" tabindex="-1"></a>  adonis_result <span class="ot">&lt;-</span> <span class="fu">adonis2</span>(bray_dist <span class="sc">~</span> condition, <span class="at">data =</span> groups)</span>
<span id="cb44-45"><a href="#cb44-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-46"><a href="#cb44-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract the p-value for the sample_type factor (usually in the first row)</span></span>
<span id="cb44-47"><a href="#cb44-47" aria-hidden="true" tabindex="-1"></a>  pval <span class="ot">&lt;-</span> adonis_result<span class="sc">$</span><span class="st">`</span><span class="at">Pr(&gt;F)</span><span class="st">`</span>[<span class="dv">1</span>]</span>
<span id="cb44-48"><a href="#cb44-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-49"><a href="#cb44-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Append the result to the results data frame</span></span>
<span id="cb44-50"><a href="#cb44-50" aria-hidden="true" tabindex="-1"></a>  permanova_taxa_results <span class="ot">&lt;-</span> <span class="fu">rbind</span>(permanova_taxa_results, <span class="fu">data.frame</span>(<span class="at">Genus =</span> genus, <span class="at">pvalue =</span> pval))</span>
<span id="cb44-51"><a href="#cb44-51" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb44-52"><a href="#cb44-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-53"><a href="#cb44-53" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(permanova_taxa_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             Genus pvalue
1       Prevotella  0.014
2        Treponema  0.001
3        Neisseria  0.035
4      Bacteroides  0.001
5       Filifactor  0.001
6    Porphyromonas  0.001
7    Fusobacterium  0.002
8      Escherichia  0.002
9      Selenomonas  0.003
10 Aggregatibacter  0.002
11  Capnocytophaga  0.016</code></pre>
</div>
</div>
</section>
</section>
<section id="relative-abundance" class="level1">
<h1>4. Relative Abundance</h1>
<p>The top 20 most abundant genera were selected from across the entire dataset and visualised with the plotAbundance function of miaViz.</p>
<section id="plotting-relative-abundance-of-genera-across-samples" class="level2">
<h2 class="anchored" data-anchor-id="plotting-relative-abundance-of-genera-across-samples">4.1 Plotting relative abundance of genera across samples</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># Check taxonomy ranks </span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">taxonomyRanks</span>(tse_metaphlan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Kingdom" "Phylum"  "Class"   "Order"   "Family"  "Genus"   "Species"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make an assay for abundance</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  tse_metaphlan <span class="ot">&lt;-</span> <span class="fu">transformAssay</span>(tse_metaphlan, <span class="at">assay.type=</span><span class="st">"counts"</span>, <span class="at">method=</span><span class="st">"relabundance"</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make an altExp and matrix for Genus</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">altExp</span>(tse_metaphlan,<span class="st">"Genus"</span>) <span class="ot">&lt;-</span> <span class="fu">agglomerateByRank</span>(tse_metaphlan,<span class="st">"Genus"</span>)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make a dataframe of relative abundance </span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  relabundance_df_Genus <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">assay</span>(<span class="fu">altExp</span>(tse_metaphlan, <span class="st">"Genus"</span>), <span class="st">"relabundance"</span>))</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make a matric of relative abundance </span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>  relabundance_matrix_Genus <span class="ot">&lt;-</span> <span class="fu">assay</span>(<span class="fu">altExp</span>(tse_metaphlan, <span class="st">"Genus"</span>), <span class="st">"relabundance"</span>)</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate the total relative abundance of each Genus (row sums)</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>  total_relabundance_Genus <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(relabundance_matrix_Genus)</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Identify the top 20 top Genuss</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>  top_Genus <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">sort</span>(total_relabundance_Genus, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>])</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Delete everything from start to Genus</span></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>  top_Genus <span class="ot">=</span> <span class="fu">sub</span>(<span class="st">".*_g__"</span>,<span class="st">""</span>,top_Genus)</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add Genus back in </span></span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>  top_Genus <span class="ot">=</span> <span class="fu">paste0</span>(<span class="fu">paste</span>(<span class="fu">rep</span>(<span class="st">"g__"</span>, <span class="fu">length</span>(top_Genus)), top_Genus))</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Delete the space introduced by this </span></span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>  top_Genus <span class="ot">=</span> <span class="fu">sub</span>(<span class="st">" "</span>,<span class="st">""</span>,top_Genus)</span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>  top_Genus</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "g__Prevotella"      "g__Streptococcus"   "g__Neisseria"      
 [4] "g__Haemophilus"     "g__Veillonella"     "g__Rothia"         
 [7] "g__Fusobacterium"   "g__Treponema"       "g__Schaalia"       
[10] "g__Escherichia"     "g__Aggregatibacter" "g__Selenomonas"    
[13] "g__Leptotrichia"    "g__Actinomyces"     "g__Campylobacter"  
[16] "g__Capnocytophaga"  "g__Porphyromonas"   "g__Bacteroides"    
[19] "g__Gemella"         "g__Filifactor"     </code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make a new tse_metaphlan where the top 14 Genuss are recognised, while others are "other"</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  tse_metaphlan_top_20_Genus <span class="ot">&lt;-</span> tse_metaphlan</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowData</span>(tse_metaphlan_top_20_Genus)<span class="sc">$</span>Genus <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">rowData</span>(tse_metaphlan_top_20_Genus)<span class="sc">$</span>Genus <span class="sc">%in%</span> top_Genus, <span class="fu">rowData</span>(tse_metaphlan_top_20_Genus)<span class="sc">$</span>Genus, <span class="st">"-other"</span>)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  genus_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"-other"</span> <span class="ot">=</span> <span class="st">"#E41A1C"</span>,</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"g__Actinomyces"</span> <span class="ot">=</span> <span class="st">"#377EB8"</span>,</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"g__Aggregatibacter"</span> <span class="ot">=</span> <span class="st">"#4DAF4A"</span>,</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"g__Bacteroides"</span> <span class="ot">=</span> <span class="st">"#984EA3"</span>,</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"g__Campylobacter"</span> <span class="ot">=</span> <span class="st">"#FF7F00"</span>,</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"g__Capnocytophaga"</span> <span class="ot">=</span> <span class="st">"#FFFF33"</span>,</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"g__Dialister"</span> <span class="ot">=</span> <span class="st">"#E7298A"</span>,</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"g__Escherichia"</span> <span class="ot">=</span> <span class="st">"#A65628"</span>,</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"g__Filifactor"</span> <span class="ot">=</span> <span class="st">"#F781BF"</span>,</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"g__Fusobacterium"</span> <span class="ot">=</span> <span class="st">"#999999"</span>,</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"g_Gemella"</span> <span class="ot">=</span> <span class="st">"#1B9E77"</span>,</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"g__Haemophilus"</span> <span class="ot">=</span> <span class="st">"#D95F02"</span>,</span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"g__Leptotrichia"</span> <span class="ot">=</span> <span class="st">"#7570B3"</span>,</span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"g__Neisseria"</span> <span class="ot">=</span> <span class="st">"#E7298A"</span>,</span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"g__Porphyromonas"</span> <span class="ot">=</span> <span class="st">"#66A61E"</span>,</span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"g__Prevotella"</span> <span class="ot">=</span> <span class="st">"#E6AB02"</span>,</span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"g__Rothia"</span> <span class="ot">=</span> <span class="st">"#66C2A5"</span>,</span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"g__Schaalia"</span> <span class="ot">=</span> <span class="st">"#FC8D62"</span>,</span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"g__Selenomonas"</span> <span class="ot">=</span> <span class="st">"#8DA0CB"</span>,</span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"g__Streptococcus"</span> <span class="ot">=</span> <span class="st">"#E78AC3"</span>,</span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"g__Tannerella"</span> <span class="ot">=</span> <span class="st">"#E41A1C"</span>,</span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"g__Treponema"</span> <span class="ot">=</span> <span class="st">"#A6D854"</span>,</span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"g__Veillonella"</span> <span class="ot">=</span> <span class="st">"#FFD92F"</span></span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a>  Genus_plot <span class="ot">&lt;-</span> <span class="fu">plotAbundance</span>(tse_metaphlan_top_20_Genus, </span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a>                              <span class="at">assay.type =</span> <span class="st">"relabundance"</span>, </span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a>                              <span class="at">rank =</span> <span class="st">"Genus"</span>, </span>
<span id="cb50-35"><a href="#cb50-35" aria-hidden="true" tabindex="-1"></a>                              <span class="at">add_x_text =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb50-36"><a href="#cb50-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">plot.margin =</span> ggplot2<span class="sc">::</span><span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">30</span>, <span class="at">r =</span> <span class="dv">10</span>, <span class="at">b =</span> <span class="dv">10</span>, <span class="at">l =</span> <span class="dv">10</span>))  </span>
<span id="cb50-37"><a href="#cb50-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-38"><a href="#cb50-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-39"><a href="#cb50-39" aria-hidden="true" tabindex="-1"></a>  Genus_plot_cols <span class="ot">=</span> Genus_plot <span class="sc">+</span> <span class="fu">scale_fill_manual</span>(<span class="at">values=</span>genus_colors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for fill is already present.
Adding another scale for fill, which will replace the existing scale.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>  Genus_plot_cols</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="st">"../imgs/Figure_1B.png"</span>, <span class="at">plot =</span>  Genus_plot_cols, <span class="at">width =</span> <span class="dv">28</span>, <span class="at">height =</span> <span class="dv">16</span>, <span class="at">dpi =</span> <span class="dv">400</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="creating-a-table-of-average-relative-abundance" class="level2">
<h2 class="anchored" data-anchor-id="creating-a-table-of-average-relative-abundance">4.2 Creating a table of average relative abundance</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get numbers in table </span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Total </span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  top_Genus_numbers_basic <span class="ot">=</span> <span class="fu">sort</span>(total_relabundance_Genus, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  top_Genus_numbers_df <span class="ot">=</span> <span class="fu">as.data.frame</span>(top_Genus_numbers_basic)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  top_Genus_numbers <span class="ot">=</span> <span class="fu">as.tibble</span>(top_Genus_numbers_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `as.tibble()` was deprecated in tibble 2.0.0.
ℹ Please use `as_tibble()` instead.
ℹ The signature and semantics have changed, see `?as_tibble`.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(top_Genus_numbers_df) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">".*(g__*)"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, <span class="fu">rownames</span>(top_Genus_numbers_df))</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>top_Genus_pc <span class="ot">=</span> top_Genus_numbers <span class="sc">%&gt;%</span> </span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">top_Genus_percentage =</span> (top_Genus_numbers_basic<span class="sc">/</span><span class="fu">sum</span>(top_Genus_numbers<span class="sc">$</span>top_Genus_numbers_basic)) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">top_Genus =</span> <span class="fu">rownames</span>(top_Genus_numbers_df))</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(top_Genus_pc<span class="sc">$</span>top_Genus_percentage)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 100</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>top_Genus_pc<span class="sc">$</span>top_20_Genus <span class="ot">=</span> <span class="fu">ifelse</span>(top_Genus_pc<span class="sc">$</span>top_Genus <span class="sc">%in%</span> top_Genus, top_Genus_pc<span class="sc">$</span>top_Genus, <span class="st">"-other"</span>)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>top_Genus_pc<span class="sc">$</span>top_Genus_above_1 <span class="ot">=</span> <span class="fu">ifelse</span>(top_Genus_pc<span class="sc">$</span>top_Genus_percentage <span class="sc">&gt;</span> <span class="dv">1</span>, top_Genus_pc<span class="sc">$</span>top_Genus, <span class="st">"-other"</span>)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>top_Genus_above_1 <span class="ot">=</span> <span class="fu">unique</span>(top_Genus_pc<span class="sc">$</span>top_Genus_above_1)</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>top_Genus_pc<span class="sc">$</span>top_Genus_above_0<span class="fl">.1</span> <span class="ot">=</span> <span class="fu">ifelse</span>(top_Genus_pc<span class="sc">$</span>top_Genus_percentage <span class="sc">&gt;</span> <span class="fl">0.1</span>, top_Genus_pc<span class="sc">$</span>top_Genus, <span class="st">"-other"</span>)</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>top_Genus_above_0<span class="fl">.1</span> <span class="ot">=</span> <span class="fu">unique</span>(top_Genus_pc<span class="sc">$</span>top_Genus_above_0<span class="fl">.1</span>)</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>mat_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">brewer.pal</span>(<span class="dv">8</span>, <span class="st">"Dark2"</span>), <span class="fu">brewer.pal</span>(<span class="dv">8</span>, <span class="st">"Set1"</span>), <span class="fu">brewer.pal</span>(<span class="dv">8</span>, <span class="st">"Set2"</span>))</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the abundance plot with a single stacked bar for 1%</span></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> <span class="fu">ggplot</span>(top_Genus_pc, <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">y =</span> top_Genus_percentage, <span class="at">fill =</span> top_Genus_above_1)) <span class="sc">+</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Abundance (%)"</span>, <span class="at">title =</span> <span class="st">"Abundance Plot of Genus"</span>) <span class="sc">+</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> genus_colors, <span class="at">name =</span> <span class="st">"Top genera above 0.1%"</span>) <span class="sc">+</span></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(), <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"../imgs/Supplementary_Figure_4.png"</span>, <span class="at">plot =</span>  p, <span class="at">width =</span> <span class="dv">28</span>, <span class="at">height =</span> <span class="dv">16</span>, <span class="at">dpi =</span> <span class="dv">400</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="statistical-differences-in-relative-abundance-of-top-20-genera" class="level2">
<h2 class="anchored" data-anchor-id="statistical-differences-in-relative-abundance-of-top-20-genera">4.3 Statistical differences in relative abundance of top 20 genera</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>  plot_relab_boxplot <span class="ot">=</span> <span class="cf">function</span>(<span class="at">genus =</span> relative_df<span class="sc">$</span>g__Prevotella,</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>                                <span class="at">sample_data =</span> sample_data,</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>                                <span class="at">title =</span> <span class="st">"Prevotella"</span>,</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>                                ...) {  </span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>    rel_df <span class="ot">=</span> <span class="fu">data.frame</span> (</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">genus =</span> genus,</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">condition =</span> sample_data</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create the boxplot with significance</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">=</span> <span class="fu">ggplot</span>(rel_df, <span class="fu">aes</span>(<span class="at">x =</span> condition, <span class="at">y =</span> genus, <span class="at">fill =</span> condition)) <span class="sc">+</span></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_signif</span>(<span class="at">comparisons =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">"healthy"</span>, <span class="st">"diseased"</span>)),</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">map_signif_level =</span> <span class="cn">FALSE</span>,</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>                  <span class="at">test =</span> wilcox.test) <span class="sc">+</span></span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> title,</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="st">"condition"</span>,</span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="st">"Relative Abundance"</span>) <span class="sc">+</span></span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"healthy"</span> <span class="ot">=</span> <span class="st">"#4682B4"</span>, <span class="st">"diseased"</span> <span class="ot">=</span> <span class="st">"#E41A1C"</span>)) <span class="sc">+</span></span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(p)</span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a>  Actinomyces_rel_bp <span class="ot">=</span> <span class="fu">plot_relab_boxplot</span>(<span class="at">genus =</span> relative_df<span class="sc">$</span>g__Actinomyces,</span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">sample_data =</span> sample_data,</span>
<span id="cb60-29"><a href="#cb60-29" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">title =</span> <span class="st">"Actinomyces"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>  Aggregatibacter_rel_bp <span class="ot">=</span> <span class="fu">plot_relab_boxplot</span>(<span class="at">genus =</span> relative_df<span class="sc">$</span>g__Aggregatibacter,</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">sample_data =</span> sample_data,</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">title =</span> <span class="st">"Aggregatibacter"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-16-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>  Bacteroides_rel_bp <span class="ot">=</span> <span class="fu">plot_relab_boxplot</span>(<span class="at">genus =</span> relative_df<span class="sc">$</span>g__Bacteroides,</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">sample_data =</span> sample_data,</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">title =</span> <span class="st">"Bacteroides"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-16-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>  Campylobacter_rel_bp <span class="ot">=</span> <span class="fu">plot_relab_boxplot</span>(<span class="at">genus =</span> relative_df<span class="sc">$</span>g__Campylobacter,</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">sample_data =</span> sample_data,</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">title =</span> <span class="st">"Campylobacter"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-16-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>  Capnocytophaga_rel_bp <span class="ot">=</span> <span class="fu">plot_relab_boxplot</span>(<span class="at">genus =</span> relative_df<span class="sc">$</span>g__Capnocytophaga,</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">sample_data =</span> sample_data,</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">title =</span> <span class="st">"Capnocytophaga"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-16-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>  Dialister_rel_bp <span class="ot">=</span> <span class="fu">plot_relab_boxplot</span>(<span class="at">genus =</span> relative_df<span class="sc">$</span>g__Dialister,</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">sample_data =</span> sample_data,</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">title =</span> <span class="st">"Dialister"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-16-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>  Escherichia_rel_bp <span class="ot">=</span> <span class="fu">plot_relab_boxplot</span>(<span class="at">genus =</span> relative_df<span class="sc">$</span>g__Escherichia,</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">sample_data =</span> sample_data,</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">title =</span> <span class="st">"Escherichia"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-16-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>  Filifactor_rel_bp <span class="ot">=</span> <span class="fu">plot_relab_boxplot</span>(<span class="at">genus =</span> relative_df<span class="sc">$</span>g__Filifactor,</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">sample_data =</span> sample_data,</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">title =</span> <span class="st">"Filifactor"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-16-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>  Fusobacterium_rel_bp <span class="ot">=</span> <span class="fu">plot_relab_boxplot</span>(<span class="at">genus =</span> relative_df<span class="sc">$</span>g__Fusobacterium,</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">sample_data =</span> sample_data,</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">title =</span> <span class="st">" Fusobacterium"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-16-9.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>  Gemella_rel_bp <span class="ot">=</span> <span class="fu">plot_relab_boxplot</span>(<span class="at">genus =</span> relative_df<span class="sc">$</span>g__Gemella,</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">sample_data =</span> sample_data,</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">title =</span> <span class="st">"Gemella"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-16-10.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>  Haemophilus_rel_bp <span class="ot">=</span> <span class="fu">plot_relab_boxplot</span>(<span class="at">genus =</span> relative_df<span class="sc">$</span>g__Haemophilus,</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">sample_data =</span> sample_data,</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">title =</span> <span class="st">"Haemophilus"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-16-11.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>  Leptotrichia_rel_bp <span class="ot">=</span> <span class="fu">plot_relab_boxplot</span>(<span class="at">genus =</span> relative_df<span class="sc">$</span>g__Leptotrichia,</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">sample_data =</span> sample_data,</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">title =</span> <span class="st">"Leptotrichia"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-16-12.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>  Neisseria_rel_bp <span class="ot">=</span> <span class="fu">plot_relab_boxplot</span>(<span class="at">genus =</span> relative_df<span class="sc">$</span>g__Neisseria,</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">sample_data =</span> sample_data,</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">title =</span> <span class="st">"Neisseria"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-16-13.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>  Porphyromonas_rel_bp <span class="ot">=</span> <span class="fu">plot_relab_boxplot</span>(<span class="at">genus =</span> relative_df<span class="sc">$</span>g__Porphyromonas,</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">sample_data =</span> sample_data,</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">title =</span> <span class="st">"Porphyromonas"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-16-14.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>  Prevotella_rel_bp <span class="ot">=</span> <span class="fu">plot_relab_boxplot</span>(<span class="at">genus =</span> relative_df<span class="sc">$</span>g__Prevotella,</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">sample_data =</span> sample_data,</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">title =</span> <span class="st">"Prevotella"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-16-15.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>  Rothia_rel_bp <span class="ot">=</span> <span class="fu">plot_relab_boxplot</span>(<span class="at">genus =</span> relative_df<span class="sc">$</span>g__Rothia,</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">sample_data =</span> sample_data,</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">title =</span> <span class="st">"Rothia"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-16-16.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>  Schaalia_rel_bp <span class="ot">=</span> <span class="fu">plot_relab_boxplot</span>(<span class="at">genus =</span> relative_df<span class="sc">$</span>g__Schaalia,</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">sample_data =</span> sample_data,</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">title =</span> <span class="st">"Schaalia"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-16-17.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>  Selenomonas_rel_bp <span class="ot">=</span> <span class="fu">plot_relab_boxplot</span>(<span class="at">genus =</span> relative_df<span class="sc">$</span>g__Selenomonas,</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">sample_data =</span> sample_data,</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">title =</span> <span class="st">"Selenomonas"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-16-18.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>  Streptococcus_rel_bp <span class="ot">=</span> <span class="fu">plot_relab_boxplot</span>(<span class="at">genus =</span> relative_df<span class="sc">$</span>g__Streptococcus,</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">sample_data =</span> sample_data,</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">title =</span> <span class="st">"Streptococcus"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-16-19.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>  Tannerella_rel_bp <span class="ot">=</span> <span class="fu">plot_relab_boxplot</span>(<span class="at">genus =</span> relative_df<span class="sc">$</span>g__Tannerella,</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">sample_data =</span> sample_data,</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">title =</span> <span class="st">"Tannerella"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-16-20.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>  Treponema_rel_bp <span class="ot">=</span> <span class="fu">plot_relab_boxplot</span>(<span class="at">genus =</span> relative_df<span class="sc">$</span>g__Treponema,</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">sample_data =</span> sample_data,</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">title =</span> <span class="st">"Treponema"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-16-21.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>  Veillonella_rel_bp <span class="ot">=</span> <span class="fu">plot_relab_boxplot</span>(<span class="at">genus =</span> relative_df<span class="sc">$</span>g__Veillonella,</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">sample_data =</span> sample_data,</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">title =</span> <span class="st">"Veillonella"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-16-22.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">grid.arrange</span>(Actinomyces_rel_bp, Gemella_rel_bp, Rothia_rel_bp, Schaalia_rel_bp, Streptococcus_rel_bp, Veillonella_rel_bp,</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>               Aggregatibacter_rel_bp,Bacteroides_rel_bp, Capnocytophaga_rel_bp, Dialister_rel_bp, Escherichia_rel_bp, Filifactor_rel_bp, </span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>               Neisseria_rel_bp, Porphyromonas_rel_bp, Prevotella_rel_bp, Selenomonas_rel_bp, Tannerella_rel_bp, Treponema_rel_bp,</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">ncol=</span><span class="dv">6</span>, <span class="at">top =</span> <span class="st">"Relative Abundance"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-16-23.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"../imgs/Supplementary_Figure_3.png"</span>, </span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">arrangeGrob</span>(Actinomyces_rel_bp, Gemella_rel_bp, Rothia_rel_bp, Schaalia_rel_bp, Streptococcus_rel_bp,</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>Veillonella_rel_bp,</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>               Aggregatibacter_rel_bp,Bacteroides_rel_bp, Capnocytophaga_rel_bp, Dialister_rel_bp, Escherichia_rel_bp, Filifactor_rel_bp, </span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>               Neisseria_rel_bp, Porphyromonas_rel_bp, Prevotella_rel_bp, Selenomonas_rel_bp, Tannerella_rel_bp, Treponema_rel_bp,</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">ncol=</span><span class="dv">6</span>),</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a><span class="at">width =</span> <span class="dv">20</span>,</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a><span class="at">height =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="differential-analysis-with-deseq" class="level1">
<h1>5. Differential Analysis with Deseq</h1>
<p>Differential analysis used the DESeq2 model on normalised count data and determined fold-change and significant differences between noma and healthy samples at the genera level.</p>
<section id="preparing-the-data-1" class="level2">
<h2 class="anchored" data-anchor-id="preparing-the-data-1">5.1 Preparing the data</h2>
<p>Use makePhyloseqFromTreeSE from Miaverse to convert</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assume your TreeSummarizedExperiment object is called `tse`</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the current sample names (column names)</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>tse_metaphlan_genus <span class="ot">=</span> <span class="fu">altExp</span>(tse_metaphlan, <span class="st">"Genus"</span>) </span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>sample_names_genus <span class="ot">&lt;-</span> <span class="fu">colnames</span>(tse_metaphlan_genus)</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>sample_names_genus</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "A10"        "A11"        "A13"        "A14"        "A16"       
 [6] "A17"        "A18"        "A19"        "A1"         "A2"        
[11] "A3"         "A4"         "A5"         "A6"         "A7"        
[16] "A8"         "A9"         "DRR214959"  "DRR214960"  "DRR214961" 
[21] "DRR214962"  "DRR241310"  "SRR5892208" "SRR5892209" "SRR5892210"
[26] "SRR5892211" "SRR5892212" "SRR5892213" "SRR5892214" "SRR5892215"
[31] "SRR5892216" "SRR5892217" "SRS013942"  "SRS014468"  "SRS014692" 
[36] "SRS015055"  "SRS019120" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a vector indicating the condition (diseased or healthy)</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming sample_1 to sample_19 are diseased, and sample_20 to sample_22 are healthy</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>condition <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"diseased"</span>, <span class="dv">17</span>), <span class="fu">rep</span>(<span class="st">"healthy"</span>, <span class="dv">20</span>))</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a DataFrame with this information</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>sample_metadata_disease <span class="ot">&lt;-</span> <span class="fu">DataFrame</span>(<span class="at">condition =</span> condition)</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(sample_metadata_disease) <span class="ot">=</span> sample_names</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>sample_metadata_disease</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>DataFrame with 37 rows and 1 column
            condition
          &lt;character&gt;
A10          diseased
A11          diseased
A13          diseased
A14          diseased
A16          diseased
...               ...
SRS013942     healthy
SRS014468     healthy
SRS014692     healthy
SRS015055     healthy
SRS019120     healthy</code></pre>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">as.data.frame</span>(sample_metadata_disease), <span class="at">n =</span> <span class="dv">37</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           condition
A10         diseased
A11         diseased
A13         diseased
A14         diseased
A16         diseased
A17         diseased
A18         diseased
A19         diseased
A1          diseased
A2          diseased
A3          diseased
A4          diseased
A5          diseased
A6          diseased
A7          diseased
A8          diseased
A9          diseased
DRR214959    healthy
DRR214960    healthy
DRR214961    healthy
DRR214962    healthy
DRR241310    healthy
SRR5892208   healthy
SRR5892209   healthy
SRR5892210   healthy
SRR5892211   healthy
SRR5892212   healthy
SRR5892213   healthy
SRR5892214   healthy
SRR5892215   healthy
SRR5892216   healthy
SRR5892217   healthy
SRS013942    healthy
SRS014468    healthy
SRS014692    healthy
SRS015055    healthy
SRS019120    healthy</code></pre>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add this DataFrame as colData to your TreeSummarizedExperiment object</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colData</span>(tse_metaphlan_genus) <span class="ot">&lt;-</span> sample_metadata_disease</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Check that colData was added successfully</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colData</span>(tse_metaphlan_genus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>DataFrame with 37 rows and 1 column
            condition
          &lt;character&gt;
A10          diseased
A11          diseased
A13          diseased
A14          diseased
A16          diseased
...               ...
SRS013942     healthy
SRS014468     healthy
SRS014692     healthy
SRS015055     healthy
SRS019120     healthy</code></pre>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use makePhyloseqFromTreeSE from Miaverse</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>phyloseq_metaphlan_genus <span class="ot">=</span> <span class="fu">makePhyloseqFromTreeSE</span>(tse_metaphlan_genus)</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>deseq2_metaphlan_genus <span class="ot">=</span> <span class="fu">phyloseq_to_deseq2</span>(phyloseq_metaphlan_genus, <span class="at">design =</span> <span class="sc">~</span>condition)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in DESeqDataSet(se, design = design, ignoreRank): some variables in
design formula are characters, converting to factors</code></pre>
</div>
</div>
</section>
<section id="running-differential-analysis-on-diseased-vs-healthy" class="level2">
<h2 class="anchored" data-anchor-id="running-differential-analysis-on-diseased-vs-healthy">5.2 Running differential analysis on diseased vs healthy</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>dds_genus <span class="ot">=</span> deseq2_metaphlan_genus</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="fu">design</span>(dds_genus) <span class="ot">&lt;-</span> <span class="er">~</span> condition  <span class="co"># Replace with your column name for condition</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Run DESeq2 analysis</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>dds_genus <span class="ot">&lt;-</span> <span class="fu">DESeq</span>(dds_genus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="extracting-results-for-disease-state" class="level2">
<h2 class="anchored" data-anchor-id="extracting-results-for-disease-state">5.3 Extracting results for disease state</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract results for diseased vs healthy</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>res_genus <span class="ot">&lt;-</span> <span class="fu">results</span>(dds_genus, <span class="at">contrast =</span> <span class="fu">c</span>(<span class="st">"condition"</span>, <span class="st">"diseased"</span>, <span class="st">"healthy"</span>))</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>string <span class="ot">&lt;-</span> <span class="st">"NA_p__Actinobacteria_c__Actinobacteria_o__Streptomycetales_f__Streptomycetaceae_g__Streptomyces"</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>string_result <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">".*(g__Streptomyces)"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, string)</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(string_result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "g__Streptomyces"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean up genus names for dds</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(dds_genus) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">".*(g__*)"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, <span class="fu">rownames</span>(dds_genus))</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean up genus names for res</span></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>res_genus<span class="sc">@</span>rownames <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">".*(g__*)"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, res_genus<span class="sc">@</span>rownames)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plotting-output-as-volcano-plot" class="level2">
<h2 class="anchored" data-anchor-id="plotting-output-as-volcano-plot">5.4 Plotting output as volcano plot</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>deseq_volcano_g <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="fu">as.data.frame</span>(res_genus), </span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> log2FoldChange, </span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="sc">-</span><span class="fu">log10</span>(pvalue), </span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="fu">ifelse</span>(<span class="sc">-</span><span class="fu">log10</span>(pvalue) <span class="sc">&gt;</span> <span class="fl">1.3</span>, log2FoldChange <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"grey"</span>), </span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">ifelse</span>(<span class="sc">-</span><span class="fu">log10</span>(pvalue) <span class="sc">&gt;</span> <span class="fl">1.3</span>, <span class="fu">as.character</span>(<span class="fu">rownames</span>(<span class="fu">as.data.frame</span>(res_genus))), <span class="st">''</span>))) <span class="sc">+</span></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">1.3</span>) <span class="sc">+</span> </span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Log2 fold change"</span>, </span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"TRUE"</span> <span class="ot">=</span> <span class="st">"#E47273"</span>, <span class="st">"FALSE"</span> <span class="ot">=</span> <span class="st">"#6DA6CE"</span>, <span class="st">"grey"</span> <span class="ot">=</span> <span class="st">"grey"</span>)) <span class="sc">+</span></span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Differential Abundance Analysis"</span>,</span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Log2 Fold Change"</span>,</span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"-Log10 P-Value"</span>) <span class="sc">+</span></span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label_repel</span>() </span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a>deseq_volcano_g </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ggrepel: 723 unlabeled data points (too many overlaps). Consider
increasing max.overlaps</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"../imgs/Figure_2A.png"</span>, <span class="at">plot =</span>  deseq_volcano_g, <span class="at">width =</span> <span class="dv">28</span>, <span class="at">height =</span> <span class="dv">16</span>, <span class="at">dpi =</span> <span class="dv">400</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ggrepel: 648 unlabeled data points (too many overlaps). Consider
increasing max.overlaps</code></pre>
</div>
</div>
</section>
<section id="inspecting-genera-that-are-significantly-different-between-disease-states" class="level2">
<h2 class="anchored" data-anchor-id="inspecting-genera-that-are-significantly-different-between-disease-states">5.5 Inspecting Genera that are significantly different between disease states</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort summary list by p-value</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>res_ordered_genus <span class="ot">&lt;-</span> res_genus[<span class="fu">order</span>(res_genus<span class="sc">$</span>padj),]</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res_ordered_genus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>log2 fold change (MLE): condition diseased vs healthy 
Wald test p-value: condition diseased vs healthy 
DataFrame with 6 rows and 6 columns
                    baseMean log2FoldChange     lfcSE      stat      pvalue
                   &lt;numeric&gt;      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;
g__Streptococcus 1.20291e+06       -4.55825  0.372011  -12.2530 1.61898e-34
g__Wolinella     8.26901e+01        4.31475  0.366735   11.7653 5.89076e-32
g__Atopobium     1.71802e+04       -5.01526  0.443219  -11.3155 1.09918e-29
g__Mesorhizobium 1.10485e+03        3.43460  0.323326   10.6227 2.33594e-26
g__Mogibacterium 1.99595e+04       -3.38475  0.319175  -10.6047 2.83487e-26
g__Treponema     5.17980e+04        4.65427  0.445544   10.4463 1.52395e-25
                        padj
                   &lt;numeric&gt;
g__Streptococcus 2.63084e-31
g__Wolinella     4.78624e-29
g__Atopobium     5.95388e-27
g__Mesorhizobium 9.21334e-24
g__Mogibacterium 9.21334e-24
g__Treponema     4.12737e-23</code></pre>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res_ordered_genus, <span class="at">n =</span><span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>log2 fold change (MLE): condition diseased vs healthy 
Wald test p-value: condition diseased vs healthy 
DataFrame with 20 rows and 6 columns
                     baseMean log2FoldChange     lfcSE      stat      pvalue
                    &lt;numeric&gt;      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;
g__Streptococcus  1.20291e+06       -4.55825  0.372011  -12.2530 1.61898e-34
g__Wolinella      8.26901e+01        4.31475  0.366735   11.7653 5.89076e-32
g__Atopobium      1.71802e+04       -5.01526  0.443219  -11.3155 1.09918e-29
g__Mesorhizobium  1.10485e+03        3.43460  0.323326   10.6227 2.33594e-26
g__Mogibacterium  1.99595e+04       -3.38475  0.319175  -10.6047 2.83487e-26
...                       ...            ...       ...       ...         ...
g__Trueperella        369.261       -3.88747  0.446248  -8.71147 2.99966e-18
g__Brochothrix        104.056       -1.75310  0.202062  -8.67605 4.09762e-18
g__Cellulomonas       276.053       -3.45878  0.402625  -8.59058 8.65346e-18
g__Carnobacterium     965.031       -2.28987  0.267449  -8.56188 1.11039e-17
g__Helicobacter       466.085        1.54649  0.182290   8.48371 2.18116e-17
                         padj
                    &lt;numeric&gt;
g__Streptococcus  2.63084e-31
g__Wolinella      4.78624e-29
g__Atopobium      5.95388e-27
g__Mesorhizobium  9.21334e-24
g__Mogibacterium  9.21334e-24
...                       ...
g__Trueperella    3.04653e-16
g__Brochothrix    3.91684e-16
g__Cellulomonas   7.81215e-16
g__Carnobacterium 9.49675e-16
g__Helicobacter   1.77219e-15</code></pre>
</div>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for significant species </span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>significant_genus <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(res_genus) <span class="sc">%&gt;%</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(padj <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(significant_genus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                           baseMean log2FoldChange     lfcSE     stat
g__Coprothermobacter       5.335380      1.4410253 0.5116803 2.816261
g__Caldisericum           17.227644      1.8273856 0.3686445 4.957040
g__Endomicrobium          19.087437      1.1224406 0.3217218 3.488855
g__Thermodesulfobacterium 36.973878      0.6180491 0.2182316 2.832078
g__Thermovibrio            8.442273      1.2631596 0.4095794 3.084041
g__Hydrogenobaculum       10.621548      1.5927663 0.5268100 3.023417
                                pvalue         padj
g__Coprothermobacter      4.858615e-03 1.572759e-02
g__Caldisericum           7.157526e-07 5.512312e-06
g__Endomicrobium          4.850945e-04 2.096486e-03
g__Thermodesulfobacterium 4.624651e-03 1.518194e-02
g__Thermovibrio           2.042094e-03 7.357877e-03
g__Hydrogenobaculum       2.499376e-03 8.772108e-03</code></pre>
</div>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for significant species with higher abundance in healthy samples</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>significant_genus_less_thn_zero <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(res_genus) <span class="sc">%&gt;%</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(padj <span class="sc">&lt;</span> <span class="fl">0.05</span>, log2FoldChange <span class="sc">&lt;</span> <span class="dv">0</span>)</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for significant species with higher abundance in diseased samples</span></span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>significant_genus_grtr_thn_zero <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(res_genus) <span class="sc">%&gt;%</span></span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(padj <span class="sc">&lt;</span> <span class="fl">0.05</span>, log2FoldChange <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the results</span></span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(significant_genus_grtr_thn_zero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                           baseMean log2FoldChange     lfcSE     stat
g__Coprothermobacter       5.335380      1.4410253 0.5116803 2.816261
g__Caldisericum           17.227644      1.8273856 0.3686445 4.957040
g__Endomicrobium          19.087437      1.1224406 0.3217218 3.488855
g__Thermodesulfobacterium 36.973878      0.6180491 0.2182316 2.832078
g__Thermovibrio            8.442273      1.2631596 0.4095794 3.084041
g__Hydrogenobaculum       10.621548      1.5927663 0.5268100 3.023417
                                pvalue         padj
g__Coprothermobacter      4.858615e-03 1.572759e-02
g__Caldisericum           7.157526e-07 5.512312e-06
g__Endomicrobium          4.850945e-04 2.096486e-03
g__Thermodesulfobacterium 4.624651e-03 1.518194e-02
g__Thermovibrio           2.042094e-03 7.357877e-03
g__Hydrogenobaculum       2.499376e-03 8.772108e-03</code></pre>
</div>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(significant_genus_less_thn_zero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                                   baseMean
NA_p__Candidatus_Saccharibacteria_NA_NA_NA_NA                    9950.98811
g__Candidatus_Saccharimonas                                       132.50097
g__Petrotoga                                                       22.53548
g__Luteitalea                                                      20.57572
NA_p__Planctomycetes_c__Planctomycetia_o__Planctomycetales_NA_NA   16.78372
g__Gemmata                                                         23.15259
                                                                 log2FoldChange
NA_p__Candidatus_Saccharibacteria_NA_NA_NA_NA                        -3.2200083
g__Candidatus_Saccharimonas                                          -2.7674007
g__Petrotoga                                                         -0.6724982
g__Luteitalea                                                        -0.9780208
NA_p__Planctomycetes_c__Planctomycetia_o__Planctomycetales_NA_NA     -1.1875691
g__Gemmata                                                           -1.3204942
                                                                     lfcSE
NA_p__Candidatus_Saccharibacteria_NA_NA_NA_NA                    0.4082855
g__Candidatus_Saccharimonas                                      0.4198980
g__Petrotoga                                                     0.2627007
g__Luteitalea                                                    0.3365252
NA_p__Planctomycetes_c__Planctomycetia_o__Planctomycetales_NA_NA 0.4243233
g__Gemmata                                                       0.3807214
                                                                      stat
NA_p__Candidatus_Saccharibacteria_NA_NA_NA_NA                    -7.886658
g__Candidatus_Saccharimonas                                      -6.590649
g__Petrotoga                                                     -2.559940
g__Luteitalea                                                    -2.906234
NA_p__Planctomycetes_c__Planctomycetia_o__Planctomycetales_NA_NA -2.798737
g__Gemmata                                                       -3.468401
                                                                       pvalue
NA_p__Candidatus_Saccharibacteria_NA_NA_NA_NA                    3.103870e-15
g__Candidatus_Saccharimonas                                      4.379075e-11
g__Petrotoga                                                     1.046901e-02
g__Luteitalea                                                    3.658079e-03
NA_p__Planctomycetes_c__Planctomycetia_o__Planctomycetales_NA_NA 5.130296e-03
g__Gemmata                                                       5.235659e-04
                                                                         padj
NA_p__Candidatus_Saccharibacteria_NA_NA_NA_NA                    1.441083e-13
g__Candidatus_Saccharimonas                                      8.471424e-10
g__Petrotoga                                                     3.016337e-02
g__Luteitalea                                                    1.230720e-02
NA_p__Planctomycetes_c__Planctomycetia_o__Planctomycetales_NA_NA 1.644250e-02
g__Gemmata                                                       2.250779e-03</code></pre>
</div>
</div>
<p>For noma samples</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Order the results </span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>sig_res_genus <span class="ot">&lt;-</span> significant_genus[<span class="fu">order</span>(significant_genus<span class="sc">$</span>padj),]</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sig_res_genus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                     baseMean log2FoldChange     lfcSE      stat       pvalue
g__Streptococcus 1.202906e+06      -4.558247 0.3720108 -12.25300 1.618980e-34
g__Wolinella     8.269014e+01       4.314750 0.3667349  11.76531 5.890761e-32
g__Atopobium     1.718017e+04      -5.015261 0.4432187 -11.31554 1.099178e-29
g__Mesorhizobium 1.104854e+03       3.434604 0.3233255  10.62274 2.335943e-26
g__Mogibacterium 1.995953e+04      -3.384746 0.3191753 -10.60466 2.834874e-26
g__Treponema     5.179799e+04       4.654275 0.4455440  10.44627 1.523951e-25
                         padj
g__Streptococcus 2.630843e-31
g__Wolinella     4.786244e-29
g__Atopobium     5.953883e-27
g__Mesorhizobium 9.213340e-24
g__Mogibacterium 9.213340e-24
g__Treponema     4.127368e-23</code></pre>
</div>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sig_res_genus, <span class="at">n=</span> <span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                                              baseMean
g__Streptococcus                                                          1.202906e+06
g__Wolinella                                                              8.269014e+01
g__Atopobium                                                              1.718017e+04
g__Mesorhizobium                                                          1.104854e+03
g__Mogibacterium                                                          1.995953e+04
g__Treponema                                                              5.179799e+04
g__Staphylococcus                                                         4.277333e+03
g__Filifactor                                                             1.174252e+04
g__Cutibacterium                                                          9.676835e+02
NA_p__Chloroflexi_c__Anaerolineae_o__Anaerolineales_f__Anaerolineaceae_NA 1.769642e+02
g__Bradyrhizobium                                                         8.111957e+02
g__Lactococcus                                                            2.259492e+03
g__Kurthia                                                                1.268817e+02
g__Salinispira                                                            6.477155e+01
g__Kingella                                                               1.023084e+03
                                                                          log2FoldChange
g__Streptococcus                                                               -4.558247
g__Wolinella                                                                    4.314750
g__Atopobium                                                                   -5.015261
g__Mesorhizobium                                                                3.434604
g__Mogibacterium                                                               -3.384746
g__Treponema                                                                    4.654275
g__Staphylococcus                                                              -2.267672
g__Filifactor                                                                   3.876533
g__Cutibacterium                                                               -3.931289
NA_p__Chloroflexi_c__Anaerolineae_o__Anaerolineales_f__Anaerolineaceae_NA       3.508700
g__Bradyrhizobium                                                               2.395926
g__Lactococcus                                                                 -3.677923
g__Kurthia                                                                     -1.632900
g__Salinispira                                                                  3.530439
g__Kingella                                                                     4.225752
                                                                              lfcSE
g__Streptococcus                                                          0.3720108
g__Wolinella                                                              0.3667349
g__Atopobium                                                              0.4432187
g__Mesorhizobium                                                          0.3233255
g__Mogibacterium                                                          0.3191753
g__Treponema                                                              0.4455440
g__Staphylococcus                                                         0.2269665
g__Filifactor                                                             0.3909906
g__Cutibacterium                                                          0.4055293
NA_p__Chloroflexi_c__Anaerolineae_o__Anaerolineales_f__Anaerolineaceae_NA 0.3682544
g__Bradyrhizobium                                                         0.2517317
g__Lactococcus                                                            0.3882346
g__Kurthia                                                                0.1740667
g__Salinispira                                                            0.3804755
g__Kingella                                                               0.4697250
                                                                                stat
g__Streptococcus                                                          -12.252998
g__Wolinella                                                               11.765313
g__Atopobium                                                              -11.315544
g__Mesorhizobium                                                           10.622743
g__Mogibacterium                                                          -10.604662
g__Treponema                                                               10.446274
g__Staphylococcus                                                          -9.991219
g__Filifactor                                                               9.914646
g__Cutibacterium                                                           -9.694218
NA_p__Chloroflexi_c__Anaerolineae_o__Anaerolineales_f__Anaerolineaceae_NA   9.527923
g__Bradyrhizobium                                                           9.517779
g__Lactococcus                                                             -9.473456
g__Kurthia                                                                 -9.380891
g__Salinispira                                                              9.279020
g__Kingella                                                                 8.996226
                                                                                pvalue
g__Streptococcus                                                          1.618980e-34
g__Wolinella                                                              5.890761e-32
g__Atopobium                                                              1.099178e-29
g__Mesorhizobium                                                          2.335943e-26
g__Mogibacterium                                                          2.834874e-26
g__Treponema                                                              1.523951e-25
g__Staphylococcus                                                         1.665213e-23
g__Filifactor                                                             3.595287e-23
g__Cutibacterium                                                          3.190735e-22
NA_p__Chloroflexi_c__Anaerolineae_o__Anaerolineales_f__Anaerolineaceae_NA 1.604608e-21
g__Bradyrhizobium                                                         1.769193e-21
g__Lactococcus                                                            2.707342e-21
g__Kurthia                                                                6.541730e-21
g__Salinispira                                                            1.710452e-20
g__Kingella                                                               2.336101e-19
                                                                                  padj
g__Streptococcus                                                          2.630843e-31
g__Wolinella                                                              4.786244e-29
g__Atopobium                                                              5.953883e-27
g__Mesorhizobium                                                          9.213340e-24
g__Mogibacterium                                                          9.213340e-24
g__Treponema                                                              4.127368e-23
g__Staphylococcus                                                         3.865673e-21
g__Filifactor                                                             7.302927e-21
g__Cutibacterium                                                          5.761050e-20
NA_p__Chloroflexi_c__Anaerolineae_o__Anaerolineales_f__Anaerolineaceae_NA 2.607487e-19
g__Bradyrhizobium                                                         2.613581e-19
g__Lactococcus                                                            3.666192e-19
g__Kurthia                                                                8.177163e-19
g__Salinispira                                                            1.985347e-18
g__Kingella                                                               2.530776e-17</code></pre>
</div>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Order the results by significance greater than zero (Noma)</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>sig_res_genus_grtr_thn_zero <span class="ot">&lt;-</span> significant_genus_grtr_thn_zero[<span class="fu">order</span>(significant_genus_grtr_thn_zero<span class="sc">$</span>padj),]</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>sig_res_genus_grtr_thn_zero<span class="sc">$</span>genus <span class="ot">=</span> <span class="fu">rownames</span>(sig_res_genus_grtr_thn_zero)</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">as.data.frame</span>(sig_res_genus_grtr_thn_zero, <span class="at">n =</span> <span class="dv">30</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                                             baseMean
g__Wolinella                                                                 82.69014
g__Mesorhizobium                                                           1104.85379
g__Treponema                                                              51797.99394
g__Filifactor                                                             11742.51502
NA_p__Chloroflexi_c__Anaerolineae_o__Anaerolineales_f__Anaerolineaceae_NA   176.96419
g__Bradyrhizobium                                                           811.19569
                                                                          log2FoldChange
g__Wolinella                                                                    4.314750
g__Mesorhizobium                                                                3.434604
g__Treponema                                                                    4.654275
g__Filifactor                                                                   3.876533
NA_p__Chloroflexi_c__Anaerolineae_o__Anaerolineales_f__Anaerolineaceae_NA       3.508700
g__Bradyrhizobium                                                               2.395926
                                                                              lfcSE
g__Wolinella                                                              0.3667349
g__Mesorhizobium                                                          0.3233255
g__Treponema                                                              0.4455440
g__Filifactor                                                             0.3909906
NA_p__Chloroflexi_c__Anaerolineae_o__Anaerolineales_f__Anaerolineaceae_NA 0.3682544
g__Bradyrhizobium                                                         0.2517317
                                                                               stat
g__Wolinella                                                              11.765313
g__Mesorhizobium                                                          10.622743
g__Treponema                                                              10.446274
g__Filifactor                                                              9.914646
NA_p__Chloroflexi_c__Anaerolineae_o__Anaerolineales_f__Anaerolineaceae_NA  9.527923
g__Bradyrhizobium                                                          9.517779
                                                                                pvalue
g__Wolinella                                                              5.890761e-32
g__Mesorhizobium                                                          2.335943e-26
g__Treponema                                                              1.523951e-25
g__Filifactor                                                             3.595287e-23
NA_p__Chloroflexi_c__Anaerolineae_o__Anaerolineales_f__Anaerolineaceae_NA 1.604608e-21
g__Bradyrhizobium                                                         1.769193e-21
                                                                                  padj
g__Wolinella                                                              4.786244e-29
g__Mesorhizobium                                                          9.213340e-24
g__Treponema                                                              4.127368e-23
g__Filifactor                                                             7.302927e-21
NA_p__Chloroflexi_c__Anaerolineae_o__Anaerolineales_f__Anaerolineaceae_NA 2.607487e-19
g__Bradyrhizobium                                                         2.613581e-19
                                                                                                                                              genus
g__Wolinella                                                                                                                           g__Wolinella
g__Mesorhizobium                                                                                                                   g__Mesorhizobium
g__Treponema                                                                                                                           g__Treponema
g__Filifactor                                                                                                                         g__Filifactor
NA_p__Chloroflexi_c__Anaerolineae_o__Anaerolineales_f__Anaerolineaceae_NA NA_p__Chloroflexi_c__Anaerolineae_o__Anaerolineales_f__Anaerolineaceae_NA
g__Bradyrhizobium                                                                                                                 g__Bradyrhizobium</code></pre>
</div>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>deseq_genus_sig_diff_noma <span class="ot">=</span> <span class="fu">head</span>(sig_res_genus_grtr_thn_zero, <span class="at">n =</span> <span class="dv">30</span>)</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Order the results by change greater than zero (Noma)</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>change_res_genus_grtr_thn_zero <span class="ot">&lt;-</span> significant_genus_grtr_thn_zero[<span class="fu">order</span>(significant_genus_grtr_thn_zero<span class="sc">$</span>log2FoldChange),]</span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(change_res_genus_grtr_thn_zero, <span class="at">n  =</span> <span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                           baseMean log2FoldChange     lfcSE     stat
g__Polynucleobacter       158.58906      0.3636115 0.1356301 2.680906
g__Geobacter              197.18389      0.4759009 0.1852261 2.569297
g__Pandoraea              112.41762      0.4765583 0.2021663 2.357259
g__Thermoanaerobacterium  199.00680      0.5044903 0.1998842 2.523913
g__Blattabacterium         91.60746      0.5085865 0.1965401 2.587698
g__Chlorobium              73.96961      0.5181272 0.1777769 2.914480
g__Salegentibacter         82.57517      0.5339047 0.2164407 2.466748
g__Thermosipho             57.03753      0.5379010 0.2015835 2.668379
g__Arcobacter             528.83484      0.5452385 0.1749888 3.115849
g__Echinicola             113.89700      0.5461497 0.1670004 3.270351
g__Brachyspira            254.89486      0.5813467 0.2025750 2.869784
g__Hungateiclostridium    251.56932      0.5858876 0.2157149 2.716027
g__Natranaerobius          20.39054      0.5919283 0.2369416 2.498203
g__Legionella             287.40179      0.6098754 0.1350509 4.515894
g__Thermodesulfobacterium  36.97388      0.6180491 0.2182316 2.832078
                                pvalue         padj
g__Polynucleobacter       7.342307e-03 2.234316e-02
g__Geobacter              1.019050e-02 2.951793e-02
g__Pandoraea              1.841040e-02 4.896383e-02
g__Thermoanaerobacterium  1.160566e-02 3.285575e-02
g__Blattabacterium        9.661964e-03 2.813744e-02
g__Chlorobium             3.562811e-03 1.206160e-02
g__Salegentibacter        1.363462e-02 3.761675e-02
g__Thermosipho            7.621828e-03 2.308301e-02
g__Arcobacter             1.834161e-03 6.697778e-03
g__Echinicola             1.074143e-03 4.236780e-03
g__Brachyspira            4.107519e-03 1.362187e-02
g__Hungateiclostridium    6.607043e-03 2.041149e-02
g__Natranaerobius         1.248245e-02 3.485221e-02
g__Legionella             6.305023e-06 3.955854e-05
g__Thermodesulfobacterium 4.624651e-03 1.518194e-02</code></pre>
</div>
</div>
<p>For healthy samples</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Order the results by significance less than zero (healthy)</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>sig_res_genus_less_thn_zero <span class="ot">&lt;-</span> significant_genus_less_thn_zero[<span class="fu">order</span>(significant_genus_less_thn_zero<span class="sc">$</span>padj),]</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>sig_res_genus_less_thn_zero<span class="sc">$</span>genus <span class="ot">=</span> <span class="fu">rownames</span>(sig_res_genus_less_thn_zero)</span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">as.data.frame</span>(sig_res_genus_less_thn_zero, <span class="at">n =</span><span class="dv">30</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                      baseMean log2FoldChange     lfcSE       stat       pvalue
g__Streptococcus  1202906.4900      -4.558247 0.3720108 -12.252998 1.618980e-34
g__Atopobium        17180.1727      -5.015261 0.4432187 -11.315544 1.099178e-29
g__Mogibacterium    19959.5262      -3.384746 0.3191753 -10.604662 2.834874e-26
g__Staphylococcus    4277.3332      -2.267672 0.2269665  -9.991219 1.665213e-23
g__Cutibacterium      967.6835      -3.931289 0.4055293  -9.694218 3.190735e-22
g__Lactococcus       2259.4921      -3.677923 0.3882346  -9.473456 2.707342e-21
                          padj             genus
g__Streptococcus  2.630843e-31  g__Streptococcus
g__Atopobium      5.953883e-27      g__Atopobium
g__Mogibacterium  9.213340e-24  g__Mogibacterium
g__Staphylococcus 3.865673e-21 g__Staphylococcus
g__Cutibacterium  5.761050e-20  g__Cutibacterium
g__Lactococcus    3.666192e-19    g__Lactococcus</code></pre>
</div>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>deseq_genus_sig_diff_healthy <span class="ot">=</span> <span class="fu">head</span>(sig_res_genus_less_thn_zero, <span class="at">n =</span> <span class="dv">30</span>)</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Order the results by change greater than zero (healthy)</span></span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>change_res_genus_less_thn_zero <span class="ot">&lt;-</span> significant_genus_less_thn_zero[<span class="fu">order</span>(significant_genus_less_thn_zero<span class="sc">$</span>log2FoldChange),]</span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">as.data.frame</span>(change_res_genus_less_thn_zero, <span class="at">n =</span><span class="dv">15</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                       baseMean log2FoldChange     lfcSE       stat
g__Rothia          3.111581e+05      -5.606861 0.8099458  -6.922513
g__Atopobium       1.718017e+04      -5.015261 0.4432187 -11.315544
g__Schaalia        1.275042e+05      -4.845840 0.6891937  -7.031174
g__Kochikohdavirus 4.688045e+00      -4.830583 0.7413594  -6.515845
g__Streptococcus   1.202906e+06      -4.558247 0.3720108 -12.252998
g__Ruania          6.387048e+01      -4.088696 0.5071776  -8.061665
                         pvalue         padj
g__Rothia          4.437010e-12 9.613521e-11
g__Atopobium       1.099178e-29 5.953883e-27
g__Schaalia        2.048035e-12 4.894202e-11
g__Kochikohdavirus 7.228141e-11 1.276710e-09
g__Streptococcus   1.618980e-34 2.630843e-31
g__Ruania          7.526211e-16 4.367890e-14</code></pre>
</div>
</div>
</section>
<section id="look-for-highly-abundant-significant-ones" class="level2">
<h2 class="anchored" data-anchor-id="look-for-highly-abundant-significant-ones">5.6 Look for highly abundant significant ones</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">taxonomyRanks</span>(tse_metaphlan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Kingdom" "Phylum"  "Class"   "Order"   "Family"  "Genus"   "Species"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make an assay for abundance</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>tse_metaphlan <span class="ot">&lt;-</span> <span class="fu">transformAssay</span>(tse_metaphlan, <span class="at">assay.type=</span><span class="st">"counts"</span>, <span class="at">method=</span><span class="st">"relabundance"</span>)</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a><span class="co"># make an altExp and matrix for Genus</span></span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a><span class="fu">altExp</span>(tse_metaphlan,<span class="st">"Genus"</span>) <span class="ot">&lt;-</span> <span class="fu">agglomerateByRank</span>(tse_metaphlan,<span class="st">"Genus"</span>)</span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a><span class="co"># make a dataframe of relative abundance </span></span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a>relabundance_df_Genus <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">assay</span>(<span class="fu">altExp</span>(tse_metaphlan, <span class="st">"Genus"</span>), <span class="st">"relabundance"</span>))</span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a><span class="co"># make a matric of relative abundance </span></span>
<span id="cb126-11"><a href="#cb126-11" aria-hidden="true" tabindex="-1"></a>relabundance_matrix_Genus <span class="ot">&lt;-</span> <span class="fu">assay</span>(<span class="fu">altExp</span>(tse_metaphlan, <span class="st">"Genus"</span>), <span class="st">"relabundance"</span>)</span>
<span id="cb126-12"><a href="#cb126-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-13"><a href="#cb126-13" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the total relative abundance of each Genus (row sums)</span></span>
<span id="cb126-14"><a href="#cb126-14" aria-hidden="true" tabindex="-1"></a>total_relabundance_Genus <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(relabundance_matrix_Genus)</span>
<span id="cb126-15"><a href="#cb126-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-16"><a href="#cb126-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the top highly abundant genera based on relative abundance </span></span>
<span id="cb126-17"><a href="#cb126-17" aria-hidden="true" tabindex="-1"></a>top_Genus_numbers_basic <span class="ot">=</span> <span class="fu">sort</span>(total_relabundance_Genus, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb126-18"><a href="#cb126-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-19"><a href="#cb126-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Make into dataframe</span></span>
<span id="cb126-20"><a href="#cb126-20" aria-hidden="true" tabindex="-1"></a>top_Genus_numbers_df <span class="ot">=</span> <span class="fu">as.data.frame</span>(top_Genus_numbers_basic)</span>
<span id="cb126-21"><a href="#cb126-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-22"><a href="#cb126-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Make into tibble</span></span>
<span id="cb126-23"><a href="#cb126-23" aria-hidden="true" tabindex="-1"></a>top_Genus_numbers <span class="ot">=</span> <span class="fu">as.tibble</span>(top_Genus_numbers_df)</span>
<span id="cb126-24"><a href="#cb126-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-25"><a href="#cb126-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename genera to remove any higher taxonomic names (a quirk of the metaphaln style)</span></span>
<span id="cb126-26"><a href="#cb126-26" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(top_Genus_numbers_df) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">".*(g__*)"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, <span class="fu">rownames</span>(top_Genus_numbers_df))</span>
<span id="cb126-27"><a href="#cb126-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-28"><a href="#cb126-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Get percenatge by dividing by totoal number of samples (21) and * by 100</span></span>
<span id="cb126-29"><a href="#cb126-29" aria-hidden="true" tabindex="-1"></a>top_Genus_pc <span class="ot">=</span> top_Genus_numbers <span class="sc">%&gt;%</span> </span>
<span id="cb126-30"><a href="#cb126-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">top_Genus_percentage =</span> (top_Genus_numbers_basic<span class="sc">/</span><span class="dv">21</span>) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb126-31"><a href="#cb126-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">top_Genus =</span> <span class="fu">rownames</span>(top_Genus_numbers_df))</span>
<span id="cb126-32"><a href="#cb126-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-33"><a href="#cb126-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Select only the top 20 genera by relative abundance </span></span>
<span id="cb126-34"><a href="#cb126-34" aria-hidden="true" tabindex="-1"></a>top_Genus_pc<span class="sc">$</span>top_20_Genus <span class="ot">=</span> <span class="fu">ifelse</span>(top_Genus_pc<span class="sc">$</span>top_Genus <span class="sc">%in%</span> top_Genus, top_Genus_pc<span class="sc">$</span>top_Genus, <span class="st">"-other"</span>)</span>
<span id="cb126-35"><a href="#cb126-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-36"><a href="#cb126-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Select only the top genera with a relative abundance above 1%</span></span>
<span id="cb126-37"><a href="#cb126-37" aria-hidden="true" tabindex="-1"></a>top_Genus_pc<span class="sc">$</span>top_Genus_above_1 <span class="ot">=</span> <span class="fu">ifelse</span>(top_Genus_pc<span class="sc">$</span>top_Genus_percentage <span class="sc">&gt;</span> <span class="dv">1</span>, top_Genus_pc<span class="sc">$</span>top_Genus, <span class="st">"-other"</span>)</span>
<span id="cb126-38"><a href="#cb126-38" aria-hidden="true" tabindex="-1"></a>top_Genus_above_1 <span class="ot">=</span> <span class="fu">unique</span>(top_Genus_pc<span class="sc">$</span>top_Genus_above_1)</span>
<span id="cb126-39"><a href="#cb126-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-40"><a href="#cb126-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Select </span></span>
<span id="cb126-41"><a href="#cb126-41" aria-hidden="true" tabindex="-1"></a>sig_res_genus_grtr_thn_zero<span class="sc">$</span>genera_above_1pc_relab <span class="ot">=</span> <span class="fu">ifelse</span>(sig_res_genus_grtr_thn_zero<span class="sc">$</span>genus <span class="sc">%in%</span> top_Genus_above_1, sig_res_genus_grtr_thn_zero<span class="sc">$</span>genus, <span class="st">"-other"</span>)</span>
<span id="cb126-42"><a href="#cb126-42" aria-hidden="true" tabindex="-1"></a>sig_res_genus_less_thn_zero<span class="sc">$</span>genera_above_1pc_relab <span class="ot">=</span> <span class="fu">ifelse</span>(sig_res_genus_less_thn_zero<span class="sc">$</span>genus <span class="sc">%in%</span> top_Genus_above_1, sig_res_genus_less_thn_zero<span class="sc">$</span>genus, <span class="st">"-other"</span>)</span>
<span id="cb126-43"><a href="#cb126-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-44"><a href="#cb126-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Check which genera are both signifiantly different and highly abundant </span></span>
<span id="cb126-45"><a href="#cb126-45" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(sig_res_genus_grtr_thn_zero<span class="sc">$</span>genera_above_1pc_relab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "-other"           "g__Treponema"     "g__Porphyromonas" "g__Bacteroides"  
[5] "g__Selenomonas"  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(sig_res_genus_less_thn_zero<span class="sc">$</span>genera_above_1pc_relab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "g__Streptococcus" "-other"           "g__Veillonella"   "g__Gemella"      
[5] "g__Schaalia"      "g__Rothia"        "g__Actinomyces"   "g__Haemophilus"  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">as.data.frame</span>(sig_res_genus_grtr_thn_zero, <span class="at">n=</span><span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                                             baseMean
g__Wolinella                                                                 82.69014
g__Mesorhizobium                                                           1104.85379
g__Treponema                                                              51797.99394
g__Filifactor                                                             11742.51502
NA_p__Chloroflexi_c__Anaerolineae_o__Anaerolineales_f__Anaerolineaceae_NA   176.96419
g__Bradyrhizobium                                                           811.19569
                                                                          log2FoldChange
g__Wolinella                                                                    4.314750
g__Mesorhizobium                                                                3.434604
g__Treponema                                                                    4.654275
g__Filifactor                                                                   3.876533
NA_p__Chloroflexi_c__Anaerolineae_o__Anaerolineales_f__Anaerolineaceae_NA       3.508700
g__Bradyrhizobium                                                               2.395926
                                                                              lfcSE
g__Wolinella                                                              0.3667349
g__Mesorhizobium                                                          0.3233255
g__Treponema                                                              0.4455440
g__Filifactor                                                             0.3909906
NA_p__Chloroflexi_c__Anaerolineae_o__Anaerolineales_f__Anaerolineaceae_NA 0.3682544
g__Bradyrhizobium                                                         0.2517317
                                                                               stat
g__Wolinella                                                              11.765313
g__Mesorhizobium                                                          10.622743
g__Treponema                                                              10.446274
g__Filifactor                                                              9.914646
NA_p__Chloroflexi_c__Anaerolineae_o__Anaerolineales_f__Anaerolineaceae_NA  9.527923
g__Bradyrhizobium                                                          9.517779
                                                                                pvalue
g__Wolinella                                                              5.890761e-32
g__Mesorhizobium                                                          2.335943e-26
g__Treponema                                                              1.523951e-25
g__Filifactor                                                             3.595287e-23
NA_p__Chloroflexi_c__Anaerolineae_o__Anaerolineales_f__Anaerolineaceae_NA 1.604608e-21
g__Bradyrhizobium                                                         1.769193e-21
                                                                                  padj
g__Wolinella                                                              4.786244e-29
g__Mesorhizobium                                                          9.213340e-24
g__Treponema                                                              4.127368e-23
g__Filifactor                                                             7.302927e-21
NA_p__Chloroflexi_c__Anaerolineae_o__Anaerolineales_f__Anaerolineaceae_NA 2.607487e-19
g__Bradyrhizobium                                                         2.613581e-19
                                                                                                                                              genus
g__Wolinella                                                                                                                           g__Wolinella
g__Mesorhizobium                                                                                                                   g__Mesorhizobium
g__Treponema                                                                                                                           g__Treponema
g__Filifactor                                                                                                                         g__Filifactor
NA_p__Chloroflexi_c__Anaerolineae_o__Anaerolineales_f__Anaerolineaceae_NA NA_p__Chloroflexi_c__Anaerolineae_o__Anaerolineales_f__Anaerolineaceae_NA
g__Bradyrhizobium                                                                                                                 g__Bradyrhizobium
                                                                          genera_above_1pc_relab
g__Wolinella                                                                              -other
g__Mesorhizobium                                                                          -other
g__Treponema                                                                        g__Treponema
g__Filifactor                                                                             -other
NA_p__Chloroflexi_c__Anaerolineae_o__Anaerolineales_f__Anaerolineaceae_NA                 -other
g__Bradyrhizobium                                                                         -other</code></pre>
</div>
</div>
</section>
<section id="plotting-p-values" class="level2">
<h2 class="anchored" data-anchor-id="plotting-p-values">5.7 Plotting p-values</h2>
<p>Plotting for noma</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>sig_res_genus_grtr_thn_zero_above_1pc_relab <span class="ot">=</span> sig_res_genus_grtr_thn_zero <span class="sc">%&gt;%</span> <span class="fu">filter</span>(genera_above_1pc_relab <span class="sc">!=</span> <span class="st">"-other"</span>)</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>sig_res_genus_grtr_thn_zero_above_1pc_relab <span class="ot">=</span> sig_res_genus_grtr_thn_zero_above_1pc_relab[<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"NA_p__Firmicutes_c__Clostridia_o__Clostridiales_f__Lachnospiraceae_NA"</span>, sig_res_genus_grtr_thn_zero_above_1pc_relab<span class="sc">$</span>genus), ]</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a>padj_plot_noma <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(sig_res_genus_grtr_thn_zero_above_1pc_relab, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(genera_above_1pc_relab, <span class="st">`</span><span class="at">padj</span><span class="st">`</span>), <span class="at">y =</span> <span class="st">`</span><span class="at">padj</span><span class="st">`</span>)) <span class="sc">+</span> </span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"#D1352B"</span>) <span class="sc">+</span> </span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(<span class="st">`</span><span class="at">padj</span><span class="st">`</span>, <span class="dv">4</span>)), </span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">hjust =</span> <span class="fl">1.2</span>, <span class="co"># Adjust horizontal position (slightly outside the bars)</span></span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="co"># Center vertically</span></span>
<span id="cb132-10"><a href="#cb132-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">6</span>, <span class="co"># Adjust text size</span></span>
<span id="cb132-11"><a href="#cb132-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb132-12"><a href="#cb132-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span>  <span class="co"># Flip to make the plot horizontal</span></span>
<span id="cb132-13"><a href="#cb132-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb132-14"><a href="#cb132-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Most significantly different genera above 1% abundance noma related"</span>,</span>
<span id="cb132-15"><a href="#cb132-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Genus"</span>,</span>
<span id="cb132-16"><a href="#cb132-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Adjusted p-value"</span></span>
<span id="cb132-17"><a href="#cb132-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb132-18"><a href="#cb132-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb132-19"><a href="#cb132-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb132-20"><a href="#cb132-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)<span class="co"># Center the title</span></span>
<span id="cb132-21"><a href="#cb132-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb132-22"><a href="#cb132-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-23"><a href="#cb132-23" aria-hidden="true" tabindex="-1"></a>padj_plot_noma</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"../imgs/Figure_2E.png"</span>, <span class="at">plot =</span>  padj_plot_noma, <span class="at">width =</span> <span class="dv">28</span>, <span class="at">height =</span> <span class="dv">16</span>, <span class="at">dpi =</span> <span class="dv">400</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Plotting for healthy</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot for Healthy</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>sig_res_genus_less_thn_zero_above_1pc_relab <span class="ot">=</span> sig_res_genus_less_thn_zero <span class="sc">%&gt;%</span> <span class="fu">filter</span>(genera_above_1pc_relab <span class="sc">!=</span> <span class="st">"-other"</span>)</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>sig_res_genus_less_thn_zero_above_1pc_relab <span class="ot">=</span> sig_res_genus_less_thn_zero_above_1pc_relab[<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"NA_p__Firmicutes_c__Clostridia_o__Clostridiales_f__Clostridiales_Family_XIII._Incertae_Sedis_NA"</span>, sig_res_genus_less_thn_zero_above_1pc_relab<span class="sc">$</span>genus), ]</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>sig_res_genus_less_thn_zero_above_1pc_relab <span class="ot">=</span> sig_res_genus_less_thn_zero_above_1pc_relab[<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"NA_p__Candidatus_Saccharibacteria_NA_NA_NA_NA"</span>, sig_res_genus_less_thn_zero_above_1pc_relab<span class="sc">$</span>genus), ]</span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>padj_plot_healthy <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(sig_res_genus_less_thn_zero_above_1pc_relab, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(genera_above_1pc_relab, <span class="st">`</span><span class="at">padj</span><span class="st">`</span>), <span class="at">y =</span> <span class="st">`</span><span class="at">padj</span><span class="st">`</span>)) <span class="sc">+</span> </span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span> </span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(<span class="st">`</span><span class="at">padj</span><span class="st">`</span>, <span class="dv">4</span>)), </span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">hjust =</span> <span class="fl">1.2</span>, <span class="co"># Adjust horizontal position (slightly outside the bars)</span></span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="co"># Center vertically</span></span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">6</span>, <span class="co"># Adjust text size</span></span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb134-14"><a href="#cb134-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span>  <span class="co"># Flip to make the plot horizontal</span></span>
<span id="cb134-15"><a href="#cb134-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb134-16"><a href="#cb134-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Most significantly different genera above 1% abundance noma related"</span>,</span>
<span id="cb134-17"><a href="#cb134-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Genus"</span>,</span>
<span id="cb134-18"><a href="#cb134-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Adjusted p-value"</span></span>
<span id="cb134-19"><a href="#cb134-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb134-20"><a href="#cb134-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb134-21"><a href="#cb134-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb134-22"><a href="#cb134-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)<span class="co"># Center the title</span></span>
<span id="cb134-23"><a href="#cb134-23" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb134-24"><a href="#cb134-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-25"><a href="#cb134-25" aria-hidden="true" tabindex="-1"></a>padj_plot_healthy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"../imgs/Figure_2D.png"</span>, <span class="at">plot =</span>  padj_plot_healthy, <span class="at">width =</span> <span class="dv">28</span>, <span class="at">height =</span> <span class="dv">16</span>, <span class="at">dpi =</span> <span class="dv">400</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plotting-normalised-counts-as-boxplots" class="level2">
<h2 class="anchored" data-anchor-id="plotting-normalised-counts-as-boxplots">5.8 Plotting normalised counts as boxplots</h2>
<p>First we create a function</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>plotCountsGGanysig <span class="ot">&lt;-</span> <span class="cf">function</span>(dds, gene, <span class="at">intgroup =</span> <span class="st">"condition"</span>, <span class="at">normalized =</span> <span class="cn">TRUE</span>,  </span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">transform =</span> <span class="cn">TRUE</span>, main, <span class="at">xlab =</span> <span class="st">"group"</span>, <span class="at">returnData =</span> <span class="cn">FALSE</span>,  </span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">replaced =</span> <span class="cn">FALSE</span>, pc, <span class="at">plot =</span> <span class="st">"point"</span>, <span class="at">text =</span> <span class="cn">TRUE</span>, <span class="at">showSignificance =</span> <span class="cn">TRUE</span>, ...) {  </span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check input gene validity</span></span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">length</span>(gene) <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> (<span class="fu">is.character</span>(gene) <span class="sc">|</span> (<span class="fu">is.numeric</span>(gene) <span class="sc">&amp;</span>  </span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a>                                                         (gene <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;</span> gene <span class="sc">&lt;=</span> <span class="fu">nrow</span>(dds)))))  </span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if all intgroup columns exist in colData</span></span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(intgroup <span class="sc">%in%</span> <span class="fu">names</span>(<span class="fu">colData</span>(dds))))  </span>
<span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"all variables in 'intgroup' must be columns of colData"</span>)  </span>
<span id="cb136-11"><a href="#cb136-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb136-12"><a href="#cb136-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If not returning data, ensure intgroup variables are factors</span></span>
<span id="cb136-13"><a href="#cb136-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>returnData) {  </span>
<span id="cb136-14"><a href="#cb136-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(<span class="fu">sapply</span>(intgroup, <span class="cf">function</span>(v) <span class="fu">is</span>(<span class="fu">colData</span>(dds)[[v]], <span class="st">"factor"</span>)))) {  </span>
<span id="cb136-15"><a href="#cb136-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="st">"all variables in 'intgroup' should be factors, or choose returnData=TRUE and plot manually"</span>)  </span>
<span id="cb136-16"><a href="#cb136-16" aria-hidden="true" tabindex="-1"></a>    }  </span>
<span id="cb136-17"><a href="#cb136-17" aria-hidden="true" tabindex="-1"></a>  }  </span>
<span id="cb136-18"><a href="#cb136-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb136-19"><a href="#cb136-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set pseudo count if not provided</span></span>
<span id="cb136-20"><a href="#cb136-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">missing</span>(pc)) {  </span>
<span id="cb136-21"><a href="#cb136-21" aria-hidden="true" tabindex="-1"></a>    pc <span class="ot">&lt;-</span> <span class="cf">if</span> (transform) <span class="fl">0.5</span> <span class="cf">else</span> <span class="dv">0</span>  </span>
<span id="cb136-22"><a href="#cb136-22" aria-hidden="true" tabindex="-1"></a>  }  </span>
<span id="cb136-23"><a href="#cb136-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb136-24"><a href="#cb136-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Estimate size factors if missing</span></span>
<span id="cb136-25"><a href="#cb136-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(<span class="fu">sizeFactors</span>(dds)) <span class="sc">&amp;</span> <span class="fu">is.null</span>(<span class="fu">normalizationFactors</span>(dds))) {  </span>
<span id="cb136-26"><a href="#cb136-26" aria-hidden="true" tabindex="-1"></a>    dds <span class="ot">&lt;-</span> <span class="fu">estimateSizeFactors</span>(dds)  </span>
<span id="cb136-27"><a href="#cb136-27" aria-hidden="true" tabindex="-1"></a>  }  </span>
<span id="cb136-28"><a href="#cb136-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb136-29"><a href="#cb136-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the counts for the gene</span></span>
<span id="cb136-30"><a href="#cb136-30" aria-hidden="true" tabindex="-1"></a>  cnts <span class="ot">&lt;-</span> <span class="fu">counts</span>(dds, <span class="at">normalized =</span> normalized, <span class="at">replaced =</span> replaced)[gene, ]  </span>
<span id="cb136-31"><a href="#cb136-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb136-32"><a href="#cb136-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate grouping variable</span></span>
<span id="cb136-33"><a href="#cb136-33" aria-hidden="true" tabindex="-1"></a>  group <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">length</span>(intgroup) <span class="sc">==</span> <span class="dv">1</span>) {  </span>
<span id="cb136-34"><a href="#cb136-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colData</span>(dds)[[intgroup]]  </span>
<span id="cb136-35"><a href="#cb136-35" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">length</span>(intgroup) <span class="sc">==</span> <span class="dv">2</span>) {  </span>
<span id="cb136-36"><a href="#cb136-36" aria-hidden="true" tabindex="-1"></a>    lvls <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">t</span>(<span class="fu">outer</span>(<span class="fu">levels</span>(<span class="fu">colData</span>(dds)[[intgroup[<span class="dv">1</span>]]]),  </span>
<span id="cb136-37"><a href="#cb136-37" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">levels</span>(<span class="fu">colData</span>(dds)[[intgroup[<span class="dv">2</span>]]]), <span class="cf">function</span>(x, y) <span class="fu">paste</span>(x, y, <span class="at">sep =</span> <span class="st">":"</span>))))  </span>
<span id="cb136-38"><a href="#cb136-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">droplevels</span>(<span class="fu">factor</span>(<span class="fu">apply</span>(<span class="fu">as.data.frame</span>(<span class="fu">colData</span>(dds)[, intgroup, <span class="at">drop =</span> <span class="cn">FALSE</span>]), <span class="dv">1</span>, paste, <span class="at">collapse =</span> <span class="st">":"</span>),  </span>
<span id="cb136-39"><a href="#cb136-39" aria-hidden="true" tabindex="-1"></a>                      <span class="at">levels =</span> lvls))  </span>
<span id="cb136-40"><a href="#cb136-40" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {  </span>
<span id="cb136-41"><a href="#cb136-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">factor</span>(<span class="fu">apply</span>(<span class="fu">as.data.frame</span>(<span class="fu">colData</span>(dds)[, intgroup, <span class="at">drop =</span> <span class="cn">FALSE</span>]), <span class="dv">1</span>, paste, <span class="at">collapse =</span> <span class="st">":"</span>))  </span>
<span id="cb136-42"><a href="#cb136-42" aria-hidden="true" tabindex="-1"></a>  }  </span>
<span id="cb136-43"><a href="#cb136-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb136-44"><a href="#cb136-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the data frame with counts, group, and sample names</span></span>
<span id="cb136-45"><a href="#cb136-45" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">count =</span> cnts <span class="sc">+</span> pc, <span class="at">group =</span> group, <span class="at">sample =</span> <span class="fu">colnames</span>(dds), <span class="at">condition =</span> group)  </span>
<span id="cb136-46"><a href="#cb136-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb136-47"><a href="#cb136-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set log scale if necessary</span></span>
<span id="cb136-48"><a href="#cb136-48" aria-hidden="true" tabindex="-1"></a>  logxy <span class="ot">&lt;-</span> <span class="cf">if</span> (transform) <span class="st">"y"</span> <span class="cf">else</span> <span class="st">""</span>  </span>
<span id="cb136-49"><a href="#cb136-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb136-50"><a href="#cb136-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set the plot title</span></span>
<span id="cb136-51"><a href="#cb136-51" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">missing</span>(main)) {  </span>
<span id="cb136-52"><a href="#cb136-52" aria-hidden="true" tabindex="-1"></a>    main <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">is.numeric</span>(gene)) {  </span>
<span id="cb136-53"><a href="#cb136-53" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rownames</span>(dds)[gene]  </span>
<span id="cb136-54"><a href="#cb136-54" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {  </span>
<span id="cb136-55"><a href="#cb136-55" aria-hidden="true" tabindex="-1"></a>      gene  </span>
<span id="cb136-56"><a href="#cb136-56" aria-hidden="true" tabindex="-1"></a>    }  </span>
<span id="cb136-57"><a href="#cb136-57" aria-hidden="true" tabindex="-1"></a>  }  </span>
<span id="cb136-58"><a href="#cb136-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb136-59"><a href="#cb136-59" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set the y-axis label based on normalization</span></span>
<span id="cb136-60"><a href="#cb136-60" aria-hidden="true" tabindex="-1"></a>  ylab <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(normalized, <span class="st">"normalized count"</span>, <span class="st">"count"</span>)  </span>
<span id="cb136-61"><a href="#cb136-61" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb136-62"><a href="#cb136-62" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return the data if requested</span></span>
<span id="cb136-63"><a href="#cb136-63" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (returnData)  </span>
<span id="cb136-64"><a href="#cb136-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">data.frame</span>(<span class="at">count =</span> data<span class="sc">$</span>count, <span class="fu">colData</span>(dds)[intgroup]))  </span>
<span id="cb136-65"><a href="#cb136-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb136-66"><a href="#cb136-66" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the base ggplot object with data and aesthetic mappings</span></span>
<span id="cb136-67"><a href="#cb136-67" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> group, <span class="at">y =</span> count, <span class="at">label =</span> sample, <span class="at">color =</span> condition)) <span class="sc">+</span></span>
<span id="cb136-68"><a href="#cb136-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> xlab, <span class="at">y =</span> ylab, <span class="at">title =</span> main) <span class="sc">+</span>  <span class="co"># Labels and title</span></span>
<span id="cb136-69"><a href="#cb136-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span>  <span class="co"># Clean theme</span></span>
<span id="cb136-70"><a href="#cb136-70" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">trans =</span> <span class="fu">ifelse</span>(transform, <span class="st">"log10"</span>, <span class="st">"identity"</span>)) <span class="sc">+</span>  <span class="co"># Apply log transformation if needed</span></span>
<span id="cb136-71"><a href="#cb136-71" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>)  <span class="co"># Optional: use color brewer for nice color scheme</span></span>
<span id="cb136-72"><a href="#cb136-72" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb136-73"><a href="#cb136-73" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select the type of plot based on the 'plot' argument</span></span>
<span id="cb136-74"><a href="#cb136-74" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (plot <span class="sc">==</span> <span class="st">"point"</span>) {</span>
<span id="cb136-75"><a href="#cb136-75" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>)</span>
<span id="cb136-76"><a href="#cb136-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (text) p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_text</span>(<span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.2</span>, <span class="at">vjust =</span> <span class="dv">0</span>)  <span class="co"># Add text if text = TRUE</span></span>
<span id="cb136-77"><a href="#cb136-77" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (plot <span class="sc">==</span> <span class="st">"jitter"</span>) {</span>
<span id="cb136-78"><a href="#cb136-78" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_jitter</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">width =</span> <span class="fl">0.2</span>)</span>
<span id="cb136-79"><a href="#cb136-79" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (text) p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_text</span>(<span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.2</span>, <span class="at">vjust =</span> <span class="dv">0</span>)  <span class="co"># Add text if text = TRUE</span></span>
<span id="cb136-80"><a href="#cb136-80" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (plot <span class="sc">==</span> <span class="st">"bar"</span>) {</span>
<span id="cb136-81"><a href="#cb136-81" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"summary"</span>, <span class="at">fun =</span> <span class="st">"mean"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">width =</span> <span class="fl">0.7</span>) <span class="sc">+</span>  <span class="co"># Bar plot with whiskers</span></span>
<span id="cb136-82"><a href="#cb136-82" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_errorbar</span>(<span class="at">stat =</span> <span class="st">"summary"</span>, <span class="at">fun.data =</span> <span class="st">"mean_se"</span>, <span class="at">width =</span> <span class="fl">0.2</span>)</span>
<span id="cb136-83"><a href="#cb136-83" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (plot <span class="sc">==</span> <span class="st">"violin"</span>) {</span>
<span id="cb136-84"><a href="#cb136-84" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_violin</span>(<span class="at">trim =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">geom_jitter</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">width =</span> <span class="fl">0.2</span>)</span>
<span id="cb136-85"><a href="#cb136-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (text) p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_text</span>(<span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.2</span>, <span class="at">vjust =</span> <span class="dv">0</span>)  <span class="co"># Add text if text = TRUE</span></span>
<span id="cb136-86"><a href="#cb136-86" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (plot <span class="sc">==</span> <span class="st">"box"</span>) {</span>
<span id="cb136-87"><a href="#cb136-87" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span>
<span id="cb136-88"><a href="#cb136-88" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (text) p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_text</span>(<span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.2</span>, <span class="at">vjust =</span> <span class="dv">0</span>)  <span class="co"># Add text if text = TRUE</span></span>
<span id="cb136-89"><a href="#cb136-89" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb136-90"><a href="#cb136-90" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Invalid plot type. Choose from 'point', 'jitter', 'bar', 'violin', or 'box'."</span>)</span>
<span id="cb136-91"><a href="#cb136-91" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb136-92"><a href="#cb136-92" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb136-93"><a href="#cb136-93" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add significance annotation if requested</span></span>
<span id="cb136-94"><a href="#cb136-94" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (showSignificance) {</span>
<span id="cb136-95"><a href="#cb136-95" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get DESeq2 results for gene using Wald test and BH adjustment</span></span>
<span id="cb136-96"><a href="#cb136-96" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">results</span>(dds, <span class="at">contrast =</span> <span class="fu">c</span>(intgroup, <span class="fu">levels</span>(group)[<span class="dv">1</span>], <span class="fu">levels</span>(group)[<span class="dv">2</span>]), <span class="at">alpha =</span> <span class="fl">0.05</span>)</span>
<span id="cb136-97"><a href="#cb136-97" aria-hidden="true" tabindex="-1"></a>    res_gene <span class="ot">&lt;-</span> res[gene, ]</span>
<span id="cb136-98"><a href="#cb136-98" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb136-99"><a href="#cb136-99" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check significance and add stars/annotations</span></span>
<span id="cb136-100"><a href="#cb136-100" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(res_gene<span class="sc">$</span>padj) <span class="sc">&amp;&amp;</span> res_gene<span class="sc">$</span>padj <span class="sc">&lt;</span> <span class="fl">0.05</span>) {</span>
<span id="cb136-101"><a href="#cb136-101" aria-hidden="true" tabindex="-1"></a>      p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">1.5</span>, <span class="at">y =</span> <span class="fu">max</span>(data<span class="sc">$</span>count), <span class="at">label =</span> <span class="st">"*"</span>, <span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb136-102"><a href="#cb136-102" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb136-103"><a href="#cb136-103" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb136-104"><a href="#cb136-104" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb136-105"><a href="#cb136-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(p)</span>
<span id="cb136-106"><a href="#cb136-106" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next we use the function to plot any highly abundant significantly associated with Noma</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant highly abundant for Noma above 1%</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>plot_1 <span class="ot">=</span> <span class="fu">plotCountsGGanysig</span>(dds_genus, <span class="at">gene=</span><span class="st">"g__Treponema"</span>, <span class="at">intgroup =</span> <span class="st">"condition"</span>, <span class="at">plot =</span> <span class="st">"box"</span>, <span class="at">text =</span> <span class="cn">FALSE</span>, <span class="at">showSignificance =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>plot_2 <span class="ot">=</span> <span class="fu">plotCountsGGanysig</span>(dds_genus, <span class="at">gene=</span><span class="st">"g__Porphyromonas"</span>, <span class="at">intgroup =</span> <span class="st">"condition"</span>, <span class="at">plot =</span> <span class="st">"box"</span>, <span class="at">text =</span> <span class="cn">FALSE</span>, <span class="at">showSignificance =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-28-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>plot_3 <span class="ot">=</span> <span class="fu">plotCountsGGanysig</span>(dds_genus, <span class="at">gene=</span><span class="st">"g__Bacteroides"</span>, <span class="at">intgroup =</span> <span class="st">"condition"</span>, <span class="at">plot =</span> <span class="st">"box"</span>, <span class="at">text =</span> <span class="cn">FALSE</span>, <span class="at">showSignificance =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-28-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>plot_4 <span class="ot">=</span> <span class="fu">plotCountsGGanysig</span>(dds_genus, <span class="at">gene=</span><span class="st">"g__Selenomonas"</span>, <span class="at">intgroup =</span> <span class="st">"condition"</span>, <span class="at">plot =</span> <span class="st">"box"</span>, <span class="at">text =</span> <span class="cn">FALSE</span>, <span class="at">showSignificance =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-28-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(plot_1, plot_2, plot_3, plot_4, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-28-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"../imgs/Figure_2C.png"</span>, </span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">arrangeGrob</span>(plot_1, plot_2, plot_3, plot_4, <span class="at">ncol=</span><span class="dv">2</span>),</span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">10</span>,</span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then we use the function to plot any highly abundant signifcantly asscoiated with healthy global dataset</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant highly abundant for healthy above 1%</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>plot_1 <span class="ot">=</span> <span class="fu">plotCountsGGanysig</span>(dds_genus, <span class="at">gene=</span><span class="st">"g__Streptococcus"</span>, <span class="at">intgroup =</span> <span class="st">"condition"</span>, <span class="at">plot =</span> <span class="st">"box"</span>, <span class="at">text =</span> <span class="cn">FALSE</span>, <span class="at">showSignificance =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>plot_2 <span class="ot">=</span> <span class="fu">plotCountsGGanysig</span>(dds_genus, <span class="at">gene=</span><span class="st">"g__Veillonella"</span>, <span class="at">intgroup =</span> <span class="st">"condition"</span>, <span class="at">plot =</span> <span class="st">"box"</span>, <span class="at">text =</span> <span class="cn">FALSE</span>, <span class="at">showSignificance =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-29-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>plot_3 <span class="ot">=</span> <span class="fu">plotCountsGGanysig</span>(dds_genus, <span class="at">gene=</span><span class="st">"g__Gemella"</span>, <span class="at">intgroup =</span> <span class="st">"condition"</span>, <span class="at">plot =</span> <span class="st">"box"</span>, <span class="at">text =</span> <span class="cn">FALSE</span>, <span class="at">showSignificance =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-29-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>plot_4 <span class="ot">=</span> <span class="fu">plotCountsGGanysig</span>(dds_genus, <span class="at">gene=</span><span class="st">"g__Schaalia"</span>, <span class="at">intgroup =</span> <span class="st">"condition"</span>, <span class="at">plot =</span> <span class="st">"box"</span>, <span class="at">text =</span> <span class="cn">FALSE</span>, <span class="at">showSignificance =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-29-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>plot_5 <span class="ot">=</span> <span class="fu">plotCountsGGanysig</span>(dds_genus, <span class="at">gene=</span><span class="st">"g__Rothia"</span>, <span class="at">intgroup =</span> <span class="st">"condition"</span>, <span class="at">plot =</span> <span class="st">"box"</span>, <span class="at">text =</span> <span class="cn">FALSE</span>, <span class="at">showSignificance =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-29-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>plot_6 <span class="ot">=</span> <span class="fu">plotCountsGGanysig</span>(dds_genus, <span class="at">gene=</span><span class="st">"g__Actinomyces"</span>, <span class="at">intgroup =</span> <span class="st">"condition"</span>, <span class="at">plot =</span> <span class="st">"box"</span>, <span class="at">text =</span> <span class="cn">FALSE</span>, <span class="at">showSignificance =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-29-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>plot_7 <span class="ot">=</span> <span class="fu">plotCountsGGanysig</span>(dds_genus, <span class="at">gene=</span><span class="st">"g__Haemophilus"</span>, <span class="at">intgroup =</span> <span class="st">"condition"</span>, <span class="at">plot =</span> <span class="st">"box"</span>, <span class="at">text =</span> <span class="cn">FALSE</span>, <span class="at">showSignificance =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-29-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(plot_1, plot_2, plot_3, plot_4,</span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>             plot_5, plot_6, plot_7, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-29-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"../imgs/Figure_2B.png"</span>, </span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">arrangeGrob</span>(plot_1, plot_2, plot_3, plot_4,</span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>             plot_5, plot_6, plot_7, <span class="at">ncol=</span><span class="dv">2</span>),</span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">10</span>,</span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="comparing-noma-samples-against-the-three-separate-healthy-cohorts" class="level2">
<h2 class="anchored" data-anchor-id="comparing-noma-samples-against-the-three-separate-healthy-cohorts">5.9 Comparing noma samples against the three separate healthy cohorts</h2>
<section id="add-additional-metadata-relating-to-specific-healthy-controls" class="level3">
<h3 class="anchored" data-anchor-id="add-additional-metadata-relating-to-specific-healthy-controls">5.9.1 Add additional metadata relating to specific healthy controls</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the function to update metadata</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>update_sample_metadata <span class="ot">&lt;-</span> <span class="cf">function</span>(tse_object) {</span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract sample names (column names)</span></span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>  sample_names <span class="ot">&lt;-</span> <span class="fu">colnames</span>(tse_object)</span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-6"><a href="#cb152-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the "accession" column based on sample name prefix</span></span>
<span id="cb152-7"><a href="#cb152-7" aria-hidden="true" tabindex="-1"></a>  accession <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">"^SRS"</span>, sample_names), <span class="st">"SRS"</span>,</span>
<span id="cb152-8"><a href="#cb152-8" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">"^SRR"</span>, sample_names), <span class="st">"SRR"</span>,</span>
<span id="cb152-9"><a href="#cb152-9" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">"^A"</span>, sample_names), <span class="st">"noma"</span>,</span>
<span id="cb152-10"><a href="#cb152-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">"^DRR"</span>, sample_names), <span class="st">"DRR"</span>, <span class="cn">NA</span>))))</span>
<span id="cb152-11"><a href="#cb152-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-12"><a href="#cb152-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the "location" column based on sample name prefix</span></span>
<span id="cb152-13"><a href="#cb152-13" aria-hidden="true" tabindex="-1"></a>  location <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">"^SRS"</span>, sample_names), <span class="st">"USA"</span>,</span>
<span id="cb152-14"><a href="#cb152-14" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">"^SRR"</span>, sample_names), <span class="st">"Denmark"</span>,</span>
<span id="cb152-15"><a href="#cb152-15" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">"^A"</span>, sample_names), <span class="st">"Nigeria"</span>,</span>
<span id="cb152-16"><a href="#cb152-16" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">"^DRR"</span>, sample_names), <span class="st">"Japan"</span>, <span class="cn">NA</span>))))</span>
<span id="cb152-17"><a href="#cb152-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-18"><a href="#cb152-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a DataFrame with the new metadata columns</span></span>
<span id="cb152-19"><a href="#cb152-19" aria-hidden="true" tabindex="-1"></a>  sample_metadata <span class="ot">&lt;-</span> <span class="fu">DataFrame</span>(<span class="at">accession =</span> accession, <span class="at">location =</span> location)</span>
<span id="cb152-20"><a href="#cb152-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(sample_metadata) <span class="ot">&lt;-</span> sample_names</span>
<span id="cb152-21"><a href="#cb152-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-22"><a href="#cb152-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add the metadata as colData to the TreeSummarizedExperiment object</span></span>
<span id="cb152-23"><a href="#cb152-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colData</span>(tse_object) <span class="ot">&lt;-</span> sample_metadata</span>
<span id="cb152-24"><a href="#cb152-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-25"><a href="#cb152-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return the updated object</span></span>
<span id="cb152-26"><a href="#cb152-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(tse_object)</span>
<span id="cb152-27"><a href="#cb152-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb152-28"><a href="#cb152-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-29"><a href="#cb152-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage:</span></span>
<span id="cb152-30"><a href="#cb152-30" aria-hidden="true" tabindex="-1"></a>tse_metaphlan_genus_hc <span class="ot">=</span> <span class="fu">altExp</span>(tse_metaphlan, <span class="st">"Genus"</span>) </span>
<span id="cb152-31"><a href="#cb152-31" aria-hidden="true" tabindex="-1"></a>tse_metaphlan_genus_hc <span class="ot">&lt;-</span> <span class="fu">update_sample_metadata</span>(tse_metaphlan_genus_hc)</span>
<span id="cb152-32"><a href="#cb152-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-33"><a href="#cb152-33" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">as.data.frame</span>(<span class="fu">colData</span>(tse_metaphlan_genus_hc)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    accession location
A10      noma  Nigeria
A11      noma  Nigeria
A13      noma  Nigeria
A14      noma  Nigeria
A16      noma  Nigeria
A17      noma  Nigeria</code></pre>
</div>
</div>
</section>
<section id="convert-data" class="level3">
<h3 class="anchored" data-anchor-id="convert-data">5.9.2 Convert data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add this DataFrame as colData to your TreeSummarizedExperiment object</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colData</span>(tse_metaphlan_genus_hc) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>DataFrame with 37 rows and 2 columns
            accession    location
          &lt;character&gt; &lt;character&gt;
A10              noma     Nigeria
A11              noma     Nigeria
A13              noma     Nigeria
A14              noma     Nigeria
A16              noma     Nigeria
...               ...         ...
SRS013942         SRS         USA
SRS014468         SRS         USA
SRS014692         SRS         USA
SRS015055         SRS         USA
SRS019120         SRS         USA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(<span class="fu">colData</span>(tse_metaphlan_genus_hc))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>DataFrame with 4 rows and 2 columns
             accession    location
           &lt;character&gt; &lt;character&gt;
A10               noma     Nigeria
DRR214959          DRR       Japan
SRR5892208         SRR     Denmark
SRS013942          SRS         USA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use makePhyloseqFromTreeSE from Miaverse</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>phyloseq_metaphlan_hc <span class="ot">=</span> <span class="fu">makePhyloseqFromTreeSE</span>(tse_metaphlan_genus_hc)</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>deseq2_metaphlan_hc <span class="ot">=</span> phyloseq<span class="sc">::</span><span class="fu">phyloseq_to_deseq2</span>(phyloseq_metaphlan_hc, <span class="at">design =</span> <span class="sc">~</span> accession)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>converting counts to integer mode</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in DESeqDataSet(se, design = design, ignoreRank): some variables in
design formula are characters, converting to factors</code></pre>
</div>
</div>
</section>
<section id="run-differential-analysis-between-seperate-datasets" class="level3">
<h3 class="anchored" data-anchor-id="run-differential-analysis-between-seperate-datasets">5.9.3 Run differential analysis between seperate datasets</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>dds_hc <span class="ot">=</span> deseq2_metaphlan_hc</span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a><span class="fu">design</span>(dds_hc) <span class="ot">&lt;-</span> <span class="er">~</span> accession  <span class="co"># Replace with your column name for condition</span></span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Run DESeq2 analysis</span></span>
<span id="cb161-6"><a href="#cb161-6" aria-hidden="true" tabindex="-1"></a>dds_hc <span class="ot">&lt;-</span> <span class="fu">DESeq</span>(dds_hc)</span>
<span id="cb161-7"><a href="#cb161-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-8"><a href="#cb161-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean up genus names for dds</span></span>
<span id="cb161-9"><a href="#cb161-9" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(dds_hc) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">".*(g__*)"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, <span class="fu">rownames</span>(dds_hc))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="extract-results-for-disease-state" class="level3">
<h3 class="anchored" data-anchor-id="extract-results-for-disease-state">5.9.4 Extract results for disease state</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(<span class="fu">as.data.frame</span>(<span class="fu">colData</span>(tse_metaphlan_genus_hc)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           accession location
A10             noma  Nigeria
DRR214959        DRR    Japan
SRR5892208       SRR  Denmark
SRS013942        SRS      USA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract results for diseased vs healthy</span></span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>res_SRR_noma <span class="ot">&lt;-</span> <span class="fu">results</span>(dds_hc, <span class="at">contrast =</span> <span class="fu">c</span>(<span class="st">"accession"</span>, <span class="st">"noma"</span>, <span class="st">"SRR"</span>))</span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>res_DRR_noma <span class="ot">&lt;-</span> <span class="fu">results</span>(dds_hc, <span class="at">contrast =</span> <span class="fu">c</span>(<span class="st">"accession"</span>, <span class="st">"noma"</span>, <span class="st">"DRR"</span>))</span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>res_SRS_noma <span class="ot">&lt;-</span> <span class="fu">results</span>(dds_hc, <span class="at">contrast =</span> <span class="fu">c</span>(<span class="st">"accession"</span>, <span class="st">"noma"</span>, <span class="st">"SRS"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plot-counts-of-genera-between-diseased-and-healthy" class="level3">
<h3 class="anchored" data-anchor-id="plot-counts-of-genera-between-diseased-and-healthy">5.9.5 Plot counts of genera between diseased and healthy</h3>
<p>Here we introduce another function which plots lines for significance</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>plotCountsGGsigline <span class="ot">=</span> <span class="cf">function</span>(dds, gene, <span class="at">intgroup =</span> <span class="st">"condition"</span>, <span class="at">normalized =</span> <span class="cn">TRUE</span>,</span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a>                               <span class="at">transform =</span> <span class="cn">TRUE</span>, main, <span class="at">xlab =</span> <span class="st">"group"</span>, <span class="at">returnData =</span> <span class="cn">FALSE</span>,</span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a>                               <span class="at">replaced =</span> <span class="cn">FALSE</span>, pc, <span class="at">plot =</span> <span class="st">"point"</span>, <span class="at">text =</span> <span class="cn">TRUE</span>,</span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a>                               <span class="at">showSignificance =</span> <span class="cn">TRUE</span>, <span class="at">lineSpacing =</span> <span class="fl">0.1</span>,</span>
<span id="cb165-5"><a href="#cb165-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">groupOrder =</span> <span class="cn">NULL</span>, ...) {</span>
<span id="cb165-6"><a href="#cb165-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb165-7"><a href="#cb165-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># input checks</span></span>
<span id="cb165-8"><a href="#cb165-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">length</span>(gene)<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;&amp;</span> (<span class="fu">is.character</span>(gene) <span class="sc">||</span></span>
<span id="cb165-9"><a href="#cb165-9" aria-hidden="true" tabindex="-1"></a>                                  (<span class="fu">is.numeric</span>(gene) <span class="sc">&amp;&amp;</span> gene<span class="sc">&gt;=</span><span class="dv">1</span> <span class="sc">&amp;&amp;</span> gene<span class="sc">&lt;=</span><span class="fu">nrow</span>(dds))))</span>
<span id="cb165-10"><a href="#cb165-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(intgroup <span class="sc">%in%</span> <span class="fu">names</span>(<span class="fu">colData</span>(dds))))</span>
<span id="cb165-11"><a href="#cb165-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"all variables in 'intgroup' must be columns of colData"</span>)</span>
<span id="cb165-12"><a href="#cb165-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>returnData) {</span>
<span id="cb165-13"><a href="#cb165-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(<span class="fu">sapply</span>(intgroup, <span class="cf">function</span>(v) <span class="fu">is</span>(<span class="fu">colData</span>(dds)[[v]], <span class="st">"factor"</span>))))</span>
<span id="cb165-14"><a href="#cb165-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="st">"all variables in 'intgroup' should be factors, or choose returnData=TRUE"</span>)</span>
<span id="cb165-15"><a href="#cb165-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb165-16"><a href="#cb165-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb165-17"><a href="#cb165-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># pseudo-count</span></span>
<span id="cb165-18"><a href="#cb165-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">missing</span>(pc)) pc <span class="ot">&lt;-</span> <span class="cf">if</span> (transform) <span class="fl">0.5</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb165-19"><a href="#cb165-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb165-20"><a href="#cb165-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ensure size factors</span></span>
<span id="cb165-21"><a href="#cb165-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(<span class="fu">sizeFactors</span>(dds)) <span class="sc">&amp;&amp;</span> <span class="fu">is.null</span>(<span class="fu">normalizationFactors</span>(dds)))</span>
<span id="cb165-22"><a href="#cb165-22" aria-hidden="true" tabindex="-1"></a>    dds <span class="ot">&lt;-</span> <span class="fu">estimateSizeFactors</span>(dds)</span>
<span id="cb165-23"><a href="#cb165-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-24"><a href="#cb165-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb165-25"><a href="#cb165-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># extract counts + grouping</span></span>
<span id="cb165-26"><a href="#cb165-26" aria-hidden="true" tabindex="-1"></a>  cnts  <span class="ot">&lt;-</span> <span class="fu">counts</span>(dds, <span class="at">normalized=</span>normalized, <span class="at">replaced=</span>replaced)[gene,]</span>
<span id="cb165-27"><a href="#cb165-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(intgroup)<span class="sc">==</span><span class="dv">1</span>) {</span>
<span id="cb165-28"><a href="#cb165-28" aria-hidden="true" tabindex="-1"></a>    group <span class="ot">&lt;-</span> <span class="fu">colData</span>(dds)[[intgroup]]</span>
<span id="cb165-29"><a href="#cb165-29" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb165-30"><a href="#cb165-30" aria-hidden="true" tabindex="-1"></a>    lvls  <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">t</span>(<span class="fu">outer</span>(<span class="fu">levels</span>(<span class="fu">colData</span>(dds)[[intgroup[<span class="dv">1</span>]]]),</span>
<span id="cb165-31"><a href="#cb165-31" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">levels</span>(<span class="fu">colData</span>(dds)[[intgroup[<span class="dv">2</span>]]]),</span>
<span id="cb165-32"><a href="#cb165-32" aria-hidden="true" tabindex="-1"></a>                               paste, <span class="at">sep=</span><span class="st">":"</span>)))</span>
<span id="cb165-33"><a href="#cb165-33" aria-hidden="true" tabindex="-1"></a>    group <span class="ot">&lt;-</span> <span class="fu">droplevels</span>(<span class="fu">factor</span>(</span>
<span id="cb165-34"><a href="#cb165-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">apply</span>(<span class="fu">as.data.frame</span>(<span class="fu">colData</span>(dds)[,intgroup]),<span class="dv">1</span>,paste,<span class="at">collapse=</span><span class="st">":"</span>),</span>
<span id="cb165-35"><a href="#cb165-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels=</span>lvls))</span>
<span id="cb165-36"><a href="#cb165-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb165-37"><a href="#cb165-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb165-38"><a href="#cb165-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set order of groups on the x-axis if specified</span></span>
<span id="cb165-39"><a href="#cb165-39" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(groupOrder)) {</span>
<span id="cb165-40"><a href="#cb165-40" aria-hidden="true" tabindex="-1"></a>    group <span class="ot">&lt;-</span> <span class="fu">factor</span>(group, <span class="at">levels =</span> groupOrder)</span>
<span id="cb165-41"><a href="#cb165-41" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb165-42"><a href="#cb165-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb165-43"><a href="#cb165-43" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">count=</span>cnts<span class="sc">+</span>pc,</span>
<span id="cb165-44"><a href="#cb165-44" aria-hidden="true" tabindex="-1"></a>                     <span class="at">group=</span>group,</span>
<span id="cb165-45"><a href="#cb165-45" aria-hidden="true" tabindex="-1"></a>                     <span class="at">sample=</span><span class="fu">colnames</span>(dds),</span>
<span id="cb165-46"><a href="#cb165-46" aria-hidden="true" tabindex="-1"></a>                     <span class="at">condition=</span>group)</span>
<span id="cb165-47"><a href="#cb165-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb165-48"><a href="#cb165-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># axis labels</span></span>
<span id="cb165-49"><a href="#cb165-49" aria-hidden="true" tabindex="-1"></a>  ylab <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(normalized, <span class="st">"normalized count"</span>, <span class="st">"count"</span>)</span>
<span id="cb165-50"><a href="#cb165-50" aria-hidden="true" tabindex="-1"></a>  logxy <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(transform, <span class="st">"y"</span>, <span class="st">""</span>)</span>
<span id="cb165-51"><a href="#cb165-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb165-52"><a href="#cb165-52" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">missing</span>(main)) {</span>
<span id="cb165-53"><a href="#cb165-53" aria-hidden="true" tabindex="-1"></a>    main <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">is.numeric</span>(gene)) <span class="fu">rownames</span>(dds)[gene] <span class="cf">else</span> gene</span>
<span id="cb165-54"><a href="#cb165-54" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb165-55"><a href="#cb165-55" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (returnData) {</span>
<span id="cb165-56"><a href="#cb165-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">data.frame</span>(<span class="at">count=</span>data<span class="sc">$</span>count, <span class="fu">colData</span>(dds)[intgroup]))</span>
<span id="cb165-57"><a href="#cb165-57" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb165-58"><a href="#cb165-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb165-59"><a href="#cb165-59" aria-hidden="true" tabindex="-1"></a>  <span class="co"># base ggplot</span></span>
<span id="cb165-60"><a href="#cb165-60" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x=</span>group,<span class="at">y=</span>count,<span class="at">label=</span>sample,</span>
<span id="cb165-61"><a href="#cb165-61" aria-hidden="true" tabindex="-1"></a>                        <span class="at">color=</span>condition,<span class="at">group=</span>group)) <span class="sc">+</span></span>
<span id="cb165-62"><a href="#cb165-62" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x=</span>xlab, <span class="at">y=</span>ylab, <span class="at">title=</span>main) <span class="sc">+</span></span>
<span id="cb165-63"><a href="#cb165-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb165-64"><a href="#cb165-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">trans=</span><span class="fu">ifelse</span>(transform,<span class="st">"log10"</span>,<span class="st">"identity"</span>)) <span class="sc">+</span></span>
<span id="cb165-65"><a href="#cb165-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_brewer</span>(<span class="at">palette=</span><span class="st">"Set1"</span>)</span>
<span id="cb165-66"><a href="#cb165-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb165-67"><a href="#cb165-67" aria-hidden="true" tabindex="-1"></a>  <span class="co"># choose geom</span></span>
<span id="cb165-68"><a href="#cb165-68" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (plot<span class="sc">==</span><span class="st">"point"</span>) {</span>
<span id="cb165-69"><a href="#cb165-69" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>)</span>
<span id="cb165-70"><a href="#cb165-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (text) p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_text</span>(<span class="at">hjust=</span><span class="sc">-</span><span class="fl">0.2</span>, <span class="at">vjust=</span><span class="dv">0</span>)</span>
<span id="cb165-71"><a href="#cb165-71" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (plot<span class="sc">==</span><span class="st">"jitter"</span>) {</span>
<span id="cb165-72"><a href="#cb165-72" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_jitter</span>(<span class="at">size=</span><span class="dv">3</span>,<span class="at">width=</span><span class="fl">0.2</span>)</span>
<span id="cb165-73"><a href="#cb165-73" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (text) p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_text</span>(<span class="at">hjust=</span><span class="sc">-</span><span class="fl">0.2</span>, <span class="at">vjust=</span><span class="dv">0</span>)</span>
<span id="cb165-74"><a href="#cb165-74" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (plot<span class="sc">==</span><span class="st">"bar"</span>) {</span>
<span id="cb165-75"><a href="#cb165-75" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">"summary"</span>, <span class="at">fun=</span><span class="st">"mean"</span>,</span>
<span id="cb165-76"><a href="#cb165-76" aria-hidden="true" tabindex="-1"></a>                      <span class="at">position=</span><span class="st">"dodge"</span>, <span class="at">width=</span><span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb165-77"><a href="#cb165-77" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_errorbar</span>(<span class="at">stat=</span><span class="st">"summary"</span>, <span class="at">fun.data=</span><span class="st">"mean_se"</span>, <span class="at">width=</span><span class="fl">0.2</span>)</span>
<span id="cb165-78"><a href="#cb165-78" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (plot<span class="sc">==</span><span class="st">"violin"</span>) {</span>
<span id="cb165-79"><a href="#cb165-79" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_violin</span>(<span class="at">trim=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb165-80"><a href="#cb165-80" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_jitter</span>(<span class="at">size=</span><span class="dv">2</span>,<span class="at">width=</span><span class="fl">0.2</span>)</span>
<span id="cb165-81"><a href="#cb165-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (text) p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_text</span>(<span class="at">hjust=</span><span class="sc">-</span><span class="fl">0.2</span>, <span class="at">vjust=</span><span class="dv">0</span>)</span>
<span id="cb165-82"><a href="#cb165-82" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (plot<span class="sc">==</span><span class="st">"box"</span>) {</span>
<span id="cb165-83"><a href="#cb165-83" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb165-84"><a href="#cb165-84" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_jitter</span>(<span class="at">size=</span><span class="dv">2</span>,<span class="at">width=</span><span class="fl">0.2</span>)</span>
<span id="cb165-85"><a href="#cb165-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (text) p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_text</span>(<span class="at">hjust=</span><span class="sc">-</span><span class="fl">0.2</span>, <span class="at">vjust=</span><span class="dv">0</span>)</span>
<span id="cb165-86"><a href="#cb165-86" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb165-87"><a href="#cb165-87" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Invalid plot type. Choose from 'point','jitter','bar','violin','box'."</span>)</span>
<span id="cb165-88"><a href="#cb165-88" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb165-89"><a href="#cb165-89" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb165-90"><a href="#cb165-90" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add significance lines &amp; stars</span></span>
<span id="cb165-91"><a href="#cb165-91" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (showSignificance) {</span>
<span id="cb165-92"><a href="#cb165-92" aria-hidden="true" tabindex="-1"></a>    max_y    <span class="ot">&lt;-</span> <span class="fu">max</span>(data<span class="sc">$</span>count)</span>
<span id="cb165-93"><a href="#cb165-93" aria-hidden="true" tabindex="-1"></a>    step     <span class="ot">&lt;-</span> max_y <span class="sc">*</span> lineSpacing</span>
<span id="cb165-94"><a href="#cb165-94" aria-hidden="true" tabindex="-1"></a>    counter  <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb165-95"><a href="#cb165-95" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb165-96"><a href="#cb165-96" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">nlevels</span>(group) <span class="sc">-</span> <span class="dv">1</span>)) {</span>
<span id="cb165-97"><a href="#cb165-97" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (j <span class="cf">in</span> (i <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">nlevels</span>(group)) {</span>
<span id="cb165-98"><a href="#cb165-98" aria-hidden="true" tabindex="-1"></a>        contrast <span class="ot">&lt;-</span> <span class="fu">c</span>(intgroup, <span class="fu">levels</span>(group)[i], <span class="fu">levels</span>(group)[j])</span>
<span id="cb165-99"><a href="#cb165-99" aria-hidden="true" tabindex="-1"></a>        res      <span class="ot">&lt;-</span> <span class="fu">results</span>(dds, <span class="at">contrast =</span> contrast, <span class="at">alpha =</span> <span class="fl">0.05</span>)</span>
<span id="cb165-100"><a href="#cb165-100" aria-hidden="true" tabindex="-1"></a>        pv       <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(res[gene, <span class="st">"padj"</span>])</span>
<span id="cb165-101"><a href="#cb165-101" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb165-102"><a href="#cb165-102" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Determine label and color</span></span>
<span id="cb165-103"><a href="#cb165-103" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">is.na</span>(pv) <span class="sc">||</span> pv <span class="sc">&gt;</span> <span class="fl">0.05</span>) {</span>
<span id="cb165-104"><a href="#cb165-104" aria-hidden="true" tabindex="-1"></a>          lab <span class="ot">&lt;-</span> <span class="st">"ns"</span></span>
<span id="cb165-105"><a href="#cb165-105" aria-hidden="true" tabindex="-1"></a>          col <span class="ot">&lt;-</span> <span class="st">"grey70"</span></span>
<span id="cb165-106"><a href="#cb165-106" aria-hidden="true" tabindex="-1"></a>          size <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb165-107"><a href="#cb165-107" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> <span class="cf">if</span> (pv <span class="sc">&lt;=</span> <span class="fl">0.001</span>) {</span>
<span id="cb165-108"><a href="#cb165-108" aria-hidden="true" tabindex="-1"></a>          lab <span class="ot">&lt;-</span> <span class="st">"***"</span></span>
<span id="cb165-109"><a href="#cb165-109" aria-hidden="true" tabindex="-1"></a>          col <span class="ot">&lt;-</span> <span class="st">"black"</span></span>
<span id="cb165-110"><a href="#cb165-110" aria-hidden="true" tabindex="-1"></a>          size <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb165-111"><a href="#cb165-111" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> <span class="cf">if</span> (pv <span class="sc">&lt;=</span> <span class="fl">0.01</span>) {</span>
<span id="cb165-112"><a href="#cb165-112" aria-hidden="true" tabindex="-1"></a>          lab <span class="ot">&lt;-</span> <span class="st">"**"</span></span>
<span id="cb165-113"><a href="#cb165-113" aria-hidden="true" tabindex="-1"></a>          col <span class="ot">&lt;-</span> <span class="st">"black"</span></span>
<span id="cb165-114"><a href="#cb165-114" aria-hidden="true" tabindex="-1"></a>          size <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb165-115"><a href="#cb165-115" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb165-116"><a href="#cb165-116" aria-hidden="true" tabindex="-1"></a>          lab <span class="ot">&lt;-</span> <span class="st">"*"</span></span>
<span id="cb165-117"><a href="#cb165-117" aria-hidden="true" tabindex="-1"></a>          col <span class="ot">&lt;-</span> <span class="st">"black"</span></span>
<span id="cb165-118"><a href="#cb165-118" aria-hidden="true" tabindex="-1"></a>          size <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb165-119"><a href="#cb165-119" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb165-120"><a href="#cb165-120" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb165-121"><a href="#cb165-121" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Positioning</span></span>
<span id="cb165-122"><a href="#cb165-122" aria-hidden="true" tabindex="-1"></a>        counter <span class="ot">&lt;-</span> counter <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb165-123"><a href="#cb165-123" aria-hidden="true" tabindex="-1"></a>        y_line  <span class="ot">&lt;-</span> max_y <span class="sc">+</span> step <span class="sc">*</span> counter</span>
<span id="cb165-124"><a href="#cb165-124" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb165-125"><a href="#cb165-125" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add line and label</span></span>
<span id="cb165-126"><a href="#cb165-126" aria-hidden="true" tabindex="-1"></a>        p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb165-127"><a href="#cb165-127" aria-hidden="true" tabindex="-1"></a>          <span class="fu">annotate</span>(<span class="st">"segment"</span>,</span>
<span id="cb165-128"><a href="#cb165-128" aria-hidden="true" tabindex="-1"></a>                   <span class="at">x =</span> i, <span class="at">xend =</span> j,</span>
<span id="cb165-129"><a href="#cb165-129" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> y_line, <span class="at">yend =</span> y_line,</span>
<span id="cb165-130"><a href="#cb165-130" aria-hidden="true" tabindex="-1"></a>                   <span class="at">colour =</span> col) <span class="sc">+</span></span>
<span id="cb165-131"><a href="#cb165-131" aria-hidden="true" tabindex="-1"></a>          <span class="fu">annotate</span>(<span class="st">"text"</span>,</span>
<span id="cb165-132"><a href="#cb165-132" aria-hidden="true" tabindex="-1"></a>                   <span class="at">x =</span> <span class="fu">mean</span>(<span class="fu">c</span>(i, j)),</span>
<span id="cb165-133"><a href="#cb165-133" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> y_line <span class="sc">+</span> (step <span class="sc">*</span> <span class="fl">0.05</span>),</span>
<span id="cb165-134"><a href="#cb165-134" aria-hidden="true" tabindex="-1"></a>                   <span class="at">label =</span> lab,</span>
<span id="cb165-135"><a href="#cb165-135" aria-hidden="true" tabindex="-1"></a>                   <span class="at">size =</span> size,</span>
<span id="cb165-136"><a href="#cb165-136" aria-hidden="true" tabindex="-1"></a>                   <span class="at">colour =</span> col)</span>
<span id="cb165-137"><a href="#cb165-137" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb165-138"><a href="#cb165-138" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb165-139"><a href="#cb165-139" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb165-140"><a href="#cb165-140" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb165-141"><a href="#cb165-141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(p)</span>
<span id="cb165-142"><a href="#cb165-142" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now plot the different genera</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>plot_1 <span class="ot">=</span> <span class="fu">plotCountsGGsigline</span>(dds_hc, <span class="at">gene=</span> <span class="st">"g__Treponema"</span>, <span class="at">intgroup =</span> <span class="st">"accession"</span>, <span class="at">plot =</span> <span class="st">"box"</span>, <span class="at">text =</span> <span class="cn">FALSE</span>, <span class="at">showSignificance =</span> <span class="cn">TRUE</span>, <span class="at">lineSpacing =</span> <span class="dv">5</span>, <span class="at">groupOrder =</span> <span class="fu">c</span>(<span class="st">"noma"</span>, <span class="st">"DRR"</span>, <span class="st">"SRR"</span>, <span class="st">"SRS"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The following aesthetics were dropped during statistical transformation: label.
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>plot_2 <span class="ot">=</span> <span class="fu">plotCountsGGsigline</span>(dds_hc, <span class="at">gene=</span> <span class="st">"g__Bacteroides"</span>, <span class="at">intgroup =</span> <span class="st">"accession"</span>, <span class="at">plot =</span> <span class="st">"box"</span>, <span class="at">text =</span> <span class="cn">FALSE</span>, <span class="at">showSignificance =</span> <span class="cn">TRUE</span>, <span class="at">lineSpacing =</span> <span class="dv">5</span>, <span class="at">groupOrder =</span> <span class="fu">c</span>(<span class="st">"noma"</span>, <span class="st">"DRR"</span>, <span class="st">"SRR"</span>, <span class="st">"SRS"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The following aesthetics were dropped during statistical transformation: label.
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-35-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>plot_3 <span class="ot">=</span> <span class="fu">plotCountsGGsigline</span>(dds_hc, <span class="at">gene=</span> <span class="st">"g__Porphyromonas"</span>, <span class="at">intgroup =</span> <span class="st">"accession"</span>, <span class="at">plot =</span> <span class="st">"box"</span>, <span class="at">text =</span> <span class="cn">FALSE</span>, <span class="at">showSignificance =</span> <span class="cn">TRUE</span>, <span class="at">lineSpacing =</span> <span class="dv">5</span>, <span class="at">groupOrder =</span> <span class="fu">c</span>(<span class="st">"noma"</span>, <span class="st">"DRR"</span>, <span class="st">"SRR"</span>, <span class="st">"SRS"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The following aesthetics were dropped during statistical transformation: label.
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-35-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>plot_4 <span class="ot">=</span> <span class="fu">plotCountsGGsigline</span>(dds_hc, <span class="at">gene=</span> <span class="st">"g__Selenomonas"</span>, <span class="at">intgroup =</span> <span class="st">"accession"</span>, <span class="at">plot =</span> <span class="st">"box"</span>, <span class="at">text =</span> <span class="cn">FALSE</span>, <span class="at">showSignificance =</span> <span class="cn">TRUE</span>, <span class="at">lineSpacing =</span> <span class="dv">5</span>, <span class="at">groupOrder =</span> <span class="fu">c</span>(<span class="st">"noma"</span>, <span class="st">"DRR"</span>, <span class="st">"SRR"</span>, <span class="st">"SRS"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The following aesthetics were dropped during statistical transformation: label.
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-35-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>plot_5 <span class="ot">=</span> <span class="fu">plotCountsGGsigline</span>(dds_hc, <span class="at">gene=</span> <span class="st">"g__Prevotella"</span>, <span class="at">intgroup =</span> <span class="st">"accession"</span>, <span class="at">plot =</span> <span class="st">"box"</span>, <span class="at">text =</span> <span class="cn">FALSE</span>, <span class="at">showSignificance =</span> <span class="cn">TRUE</span>, <span class="at">lineSpacing =</span> <span class="dv">5</span>, <span class="at">groupOrder =</span> <span class="fu">c</span>(<span class="st">"noma"</span>, <span class="st">"DRR"</span>, <span class="st">"SRR"</span>, <span class="st">"SRS"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The following aesthetics were dropped during statistical transformation: label.
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-35-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>plot_6 <span class="ot">=</span> <span class="fu">plotCountsGGsigline</span>(dds_hc, <span class="at">gene=</span> <span class="st">"g__Streptococcus"</span>, <span class="at">intgroup =</span> <span class="st">"accession"</span>, <span class="at">plot =</span> <span class="st">"box"</span>, <span class="at">text =</span> <span class="cn">FALSE</span>, <span class="at">showSignificance =</span> <span class="cn">TRUE</span>, <span class="at">lineSpacing =</span> <span class="dv">5</span>, <span class="at">groupOrder =</span> <span class="fu">c</span>(<span class="st">"noma"</span>, <span class="st">"DRR"</span>, <span class="st">"SRR"</span>, <span class="st">"SRS"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The following aesthetics were dropped during statistical transformation: label.
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-35-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a>plot_7 <span class="ot">=</span> <span class="fu">plotCountsGGsigline</span>(dds_hc, <span class="at">gene=</span> <span class="st">"g__Rothia"</span>, <span class="at">intgroup =</span> <span class="st">"accession"</span>, <span class="at">plot =</span> <span class="st">"box"</span>, <span class="at">text =</span> <span class="cn">FALSE</span>, <span class="at">showSignificance =</span> <span class="cn">TRUE</span>, <span class="at">lineSpacing =</span> <span class="dv">5</span>, <span class="at">groupOrder =</span> <span class="fu">c</span>(<span class="st">"noma"</span>, <span class="st">"DRR"</span>, <span class="st">"SRR"</span>, <span class="st">"SRS"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The following aesthetics were dropped during statistical transformation: label.
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-35-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a>plot_8 <span class="ot">=</span> <span class="fu">plotCountsGGsigline</span>(dds_hc, <span class="at">gene=</span> <span class="st">"g__Veillonella"</span>, <span class="at">intgroup =</span> <span class="st">"accession"</span>, <span class="at">plot =</span> <span class="st">"box"</span>, <span class="at">text =</span> <span class="cn">FALSE</span>, <span class="at">showSignificance =</span> <span class="cn">TRUE</span>, <span class="at">lineSpacing =</span> <span class="dv">5</span>, <span class="at">groupOrder =</span> <span class="fu">c</span>(<span class="st">"noma"</span>, <span class="st">"DRR"</span>, <span class="st">"SRR"</span>, <span class="st">"SRS"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The following aesthetics were dropped during statistical transformation: label.
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-35-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>plot_9 <span class="ot">=</span> <span class="fu">plotCountsGGsigline</span>(dds_hc, <span class="at">gene=</span> <span class="st">"g__Gemella"</span>, <span class="at">intgroup =</span> <span class="st">"accession"</span>, <span class="at">plot =</span> <span class="st">"box"</span>, <span class="at">text =</span> <span class="cn">FALSE</span>, <span class="at">showSignificance =</span> <span class="cn">TRUE</span>, <span class="at">lineSpacing =</span> <span class="dv">5</span>, <span class="at">groupOrder =</span> <span class="fu">c</span>(<span class="st">"noma"</span>, <span class="st">"DRR"</span>, <span class="st">"SRR"</span>, <span class="st">"SRS"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The following aesthetics were dropped during statistical transformation: label.
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-35-9.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a>plot_10 <span class="ot">=</span> <span class="fu">plotCountsGGsigline</span>(dds_hc, <span class="at">gene=</span> <span class="st">"g__Schaalia"</span>, <span class="at">intgroup =</span> <span class="st">"accession"</span>, <span class="at">plot =</span> <span class="st">"box"</span>, <span class="at">text =</span> <span class="cn">FALSE</span>, <span class="at">showSignificance =</span> <span class="cn">TRUE</span>, <span class="at">lineSpacing =</span> <span class="dv">5</span>, <span class="at">groupOrder =</span> <span class="fu">c</span>(<span class="st">"noma"</span>, <span class="st">"DRR"</span>, <span class="st">"SRR"</span>, <span class="st">"SRS"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The following aesthetics were dropped during statistical transformation: label.
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-35-10.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>plot_11 <span class="ot">=</span> <span class="fu">plotCountsGGsigline</span>(dds_hc, <span class="at">gene=</span> <span class="st">"g__Actinomyces"</span>, <span class="at">intgroup =</span> <span class="st">"accession"</span>, <span class="at">plot =</span> <span class="st">"box"</span>, <span class="at">text =</span> <span class="cn">FALSE</span>, <span class="at">showSignificance =</span> <span class="cn">TRUE</span>, <span class="at">lineSpacing =</span> <span class="dv">5</span>, <span class="at">groupOrder =</span> <span class="fu">c</span>(<span class="st">"noma"</span>, <span class="st">"DRR"</span>, <span class="st">"SRR"</span>, <span class="st">"SRS"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The following aesthetics were dropped during statistical transformation: label.
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-35-11.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>plot_12 <span class="ot">=</span> <span class="fu">plotCountsGGsigline</span>(dds_hc, <span class="at">gene=</span> <span class="st">"g__Haemophilus"</span>, <span class="at">intgroup =</span> <span class="st">"accession"</span>, <span class="at">plot =</span> <span class="st">"box"</span>, <span class="at">text =</span> <span class="cn">FALSE</span>, <span class="at">showSignificance =</span> <span class="cn">TRUE</span>, <span class="at">lineSpacing =</span> <span class="dv">5</span>, <span class="at">groupOrder =</span> <span class="fu">c</span>(<span class="st">"noma"</span>, <span class="st">"DRR"</span>, <span class="st">"SRR"</span>, <span class="st">"SRS"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The following aesthetics were dropped during statistical transformation: label.
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-35-12.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(plot_1, plot_2, plot_3, plot_4, plot_5,</span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>             plot_6, plot_7, plot_8, plot_9, plot_10,</span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a>             plot_11, plot_12, <span class="at">ncol=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The following aesthetics were dropped during statistical transformation: label.
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?
The following aesthetics were dropped during statistical transformation: label.
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?
The following aesthetics were dropped during statistical transformation: label.
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?
The following aesthetics were dropped during statistical transformation: label.
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?
The following aesthetics were dropped during statistical transformation: label.
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?
The following aesthetics were dropped during statistical transformation: label.
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?
The following aesthetics were dropped during statistical transformation: label.
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?
The following aesthetics were dropped during statistical transformation: label.
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?
The following aesthetics were dropped during statistical transformation: label.
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?
The following aesthetics were dropped during statistical transformation: label.
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?
The following aesthetics were dropped during statistical transformation: label.
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?
The following aesthetics were dropped during statistical transformation: label.
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-35-13.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"../imgs/Supplementary_Figure_2.png"</span>, </span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a><span class="fu">arrangeGrob</span>(plot_1, plot_2, plot_3, plot_4, plot_5,</span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a>             plot_6, plot_7, plot_8, plot_9, plot_10,</span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a>             plot_11, plot_12, <span class="at">ncol=</span><span class="dv">3</span>),</span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a><span class="at">width =</span> <span class="dv">20</span>,</span>
<span id="cb192-6"><a href="#cb192-6" aria-hidden="true" tabindex="-1"></a><span class="at">height =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The following aesthetics were dropped during statistical transformation: label.
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?
The following aesthetics were dropped during statistical transformation: label.
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?
The following aesthetics were dropped during statistical transformation: label.
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?
The following aesthetics were dropped during statistical transformation: label.
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?
The following aesthetics were dropped during statistical transformation: label.
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?
The following aesthetics were dropped during statistical transformation: label.
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?
The following aesthetics were dropped during statistical transformation: label.
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?
The following aesthetics were dropped during statistical transformation: label.
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?
The following aesthetics were dropped during statistical transformation: label.
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?
The following aesthetics were dropped during statistical transformation: label.
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?
The following aesthetics were dropped during statistical transformation: label.
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?
The following aesthetics were dropped during statistical transformation: label.
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="random-forests" class="level1">
<h1>6. Random Forests</h1>
<p>Random forest (RF) classifiers were applied based on 500 estimator trees to identify key predictors of microbial community composition and their association with noma or healthy states.</p>
<p>We also ran a cross validation of the dataset taking 20% of samples as test data and 80% as training data. This was used to assess the predictive power of the RF classifier, assessed as an area under the receiver operating characteristic (ROC) curve (AUC) between 0 and 1.</p>
<p>A permutation test (n = 1000) was conducted to evaluate the statistical significance of the observed classification accuracy, this allowed for a null distribution of accuracy to be plotted. The observed accuracy of the random forest model was overlayed on the null distribution.</p>
<section id="preparing-the-data-2" class="level2">
<h2 class="anchored" data-anchor-id="preparing-the-data-2">6.1 Preparing the data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract metadata and OTU table</span></span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a>  phyloseq_obj <span class="ot">&lt;-</span> phyloseq_noma_esd</span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a>  metadata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">sample_data</span>(phyloseq_obj))</span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a>  otu_data <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">otu_table</span>(phyloseq_obj))</span>
<span id="cb194-5"><a href="#cb194-5" aria-hidden="true" tabindex="-1"></a>  otu_data <span class="ot">&lt;-</span> <span class="fu">t</span>(otu_data)  <span class="co"># Transpose so samples are rows and species are columns</span></span>
<span id="cb194-6"><a href="#cb194-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-7"><a href="#cb194-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combine OTU data with metadata</span></span>
<span id="cb194-8"><a href="#cb194-8" aria-hidden="true" tabindex="-1"></a>  ml_data <span class="ot">&lt;-</span> <span class="fu">cbind</span>(metadata, otu_data)</span>
<span id="cb194-9"><a href="#cb194-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-10"><a href="#cb194-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ensure the metadata column you're predicting (e.g., condition) is a factor</span></span>
<span id="cb194-11"><a href="#cb194-11" aria-hidden="true" tabindex="-1"></a>  ml_data<span class="sc">$</span>condition <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(ml_data<span class="sc">$</span>condition)  <span class="co"># Replace "condition" with your actual column</span></span>
<span id="cb194-12"><a href="#cb194-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-13"><a href="#cb194-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove columns containing NA</span></span>
<span id="cb194-14"><a href="#cb194-14" aria-hidden="true" tabindex="-1"></a>  ml_data_clean <span class="ot">&lt;-</span> ml_data[, <span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">colnames</span>(ml_data))]</span>
<span id="cb194-15"><a href="#cb194-15" aria-hidden="true" tabindex="-1"></a>  ml_data_clean <span class="ot">&lt;-</span> ml_data[, <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"NA"</span>, <span class="fu">colnames</span>(ml_data))]</span>
<span id="cb194-16"><a href="#cb194-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-17"><a href="#cb194-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">123456</span>)</span>
<span id="cb194-18"><a href="#cb194-18" aria-hidden="true" tabindex="-1"></a>  rf_model_cv <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(condition <span class="sc">~</span> ., <span class="at">data =</span> ml_data_clean, <span class="at">ntree =</span> <span class="dv">500</span>, <span class="at">importance =</span> <span class="cn">TRUE</span>)</span>
<span id="cb194-19"><a href="#cb194-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(rf_model_cv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
 randomForest(formula = condition ~ ., data = ml_data_clean, ntree = 500,      importance = TRUE) 
               Type of random forest: classification
                     Number of trees: 500
No. of variables tried at each split: 41

        OOB estimate of  error rate: 2.7%
Confusion matrix:
         diseased healthy class.error
diseased       16       1  0.05882353
healthy         0      20  0.00000000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a>  importance_rf_model_cv <span class="ot">&lt;-</span> <span class="fu">importance</span>(rf_model_cv)</span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Delete everything from start to Genus</span></span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a>  ml_data_col_names <span class="ot">=</span> <span class="fu">sub</span>(<span class="st">".*_g__"</span>,<span class="st">""</span>,<span class="fu">colnames</span>(ml_data))</span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add Genus back in </span></span>
<span id="cb196-7"><a href="#cb196-7" aria-hidden="true" tabindex="-1"></a>  ml_data_clean <span class="ot">=</span> <span class="fu">paste0</span>(<span class="fu">paste</span>(<span class="fu">rep</span>(<span class="st">"g__"</span>, <span class="fu">length</span>(ml_data_col_names)), ml_data_col_names))</span>
<span id="cb196-8"><a href="#cb196-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Delete the space introduced by this </span></span>
<span id="cb196-9"><a href="#cb196-9" aria-hidden="true" tabindex="-1"></a>  ml_data_col_names <span class="ot">=</span> <span class="fu">sub</span>(<span class="st">" "</span>,<span class="st">""</span>,ml_data_col_names)</span>
<span id="cb196-10"><a href="#cb196-10" aria-hidden="true" tabindex="-1"></a>  ml_data_col_names <span class="ot">=</span> <span class="fu">sub</span>(<span class="st">"g__condition"</span>,<span class="st">"condition"</span>,ml_data_col_names)</span>
<span id="cb196-11"><a href="#cb196-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(ml_data_col_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "condition"             "g__Coprothermobacter"  "g__Caldisericum"      
[4] "g__Desulfurispirillum" "g__Endomicrobium"      "g__Elusimicrobium"    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a>  ml_data_clean <span class="ot">=</span> ml_data</span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(ml_data_clean) <span class="ot">=</span> ml_data_col_names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="running-random-forests" class="level2">
<h2 class="anchored" data-anchor-id="running-random-forests">6.2 running random forests</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">123456</span>)</span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Run Random Forest to classify samples based on 'condition'</span></span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a>  rf_model <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(condition <span class="sc">~</span> ., <span class="at">data =</span> ml_data_clean, <span class="at">ntree =</span> <span class="dv">500</span>, <span class="at">importance =</span> <span class="cn">TRUE</span>)</span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(rf_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
 randomForest(formula = condition ~ ., data = ml_data_clean, ntree = 500,      importance = TRUE) 
               Type of random forest: classification
                     Number of trees: 500
No. of variables tried at each split: 41

        OOB estimate of  error rate: 2.7%
Confusion matrix:
         diseased healthy class.error
diseased       16       1  0.05882353
healthy         0      20  0.00000000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a>  importance_rf_model <span class="ot">&lt;-</span> <span class="fu">importance</span>(rf_model)</span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">123456</span>)</span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Run Random Forest to classify samples based on 'condition'</span></span>
<span id="cb201-5"><a href="#cb201-5" aria-hidden="true" tabindex="-1"></a>  rf_model_condition <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(condition <span class="sc">~</span> ., <span class="at">data =</span> ml_data_clean, <span class="at">ntree =</span> <span class="dv">500</span>, <span class="at">importance =</span> <span class="cn">TRUE</span>)</span>
<span id="cb201-6"><a href="#cb201-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(rf_model_condition)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
 randomForest(formula = condition ~ ., data = ml_data_clean, ntree = 500,      importance = TRUE) 
               Type of random forest: classification
                     Number of trees: 500
No. of variables tried at each split: 41

        OOB estimate of  error rate: 2.7%
Confusion matrix:
         diseased healthy class.error
diseased       16       1  0.05882353
healthy         0      20  0.00000000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a>  importance_rf_model <span class="ot">&lt;-</span> <span class="fu">importance</span>(rf_model_condition)</span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(importance_rf_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                      diseased  healthy MeanDecreaseAccuracy MeanDecreaseGini
g__Coprothermobacter  0.000000 0.000000             0.000000       0.00000000
g__Caldisericum       0.000000 0.000000             0.000000       0.00000000
g__Desulfurispirillum 0.000000 0.000000             0.000000       0.00000000
g__Endomicrobium      0.000000 0.000000             0.000000       0.00000000
g__Elusimicrobium     0.000000 0.000000             0.000000       0.00000000
g__Dictyoglomus       1.001002 1.001002             1.001002       0.03294723</code></pre>
</div>
</div>
</section>
<section id="plot-variable-importance" class="level2">
<h2 class="anchored" data-anchor-id="plot-variable-importance">6.3 Plot variable importance</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Plot Variable Importance</span></span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># To plot the variable importance, use the %IncMSE (or MeanDecreaseAccuracy) </span></span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># from the importance output. Below is an example of how to create a bar plot </span></span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># of the top 10 most important predictors:</span></span>
<span id="cb205-5"><a href="#cb205-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb205-6"><a href="#cb205-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-7"><a href="#cb205-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb205-8"><a href="#cb205-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract variable importance and convert to a data frame</span></span>
<span id="cb205-9"><a href="#cb205-9" aria-hidden="true" tabindex="-1"></a>  importance_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(importance_rf_model)</span>
<span id="cb205-10"><a href="#cb205-10" aria-hidden="true" tabindex="-1"></a>  importance_df <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(importance_df, <span class="st">"genus"</span>)</span>
<span id="cb205-11"><a href="#cb205-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb205-12"><a href="#cb205-12" aria-hidden="true" tabindex="-1"></a>  importance_df <span class="ot">&lt;-</span> importance_df <span class="sc">%&gt;%</span></span>
<span id="cb205-13"><a href="#cb205-13" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="st">`</span><span class="at">MeanDecreaseAccuracy</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb205-14"><a href="#cb205-14" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">50</span>)  <span class="co"># Select top 10 most important predictors</span></span>
<span id="cb205-15"><a href="#cb205-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb205-16"><a href="#cb205-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select by any above 1.7</span></span>
<span id="cb205-17"><a href="#cb205-17" aria-hidden="true" tabindex="-1"></a>  importance_df <span class="ot">&lt;-</span> importance_df <span class="sc">%&gt;%</span></span>
<span id="cb205-18"><a href="#cb205-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="st">`</span><span class="at">MeanDecreaseAccuracy</span><span class="st">`</span><span class="sc">&gt;</span><span class="fl">1.7</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb205-19"><a href="#cb205-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="st">`</span><span class="at">MeanDecreaseAccuracy</span><span class="st">`</span>))</span>
<span id="cb205-20"><a href="#cb205-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb205-21"><a href="#cb205-21" aria-hidden="true" tabindex="-1"></a>  importance_df_ggplot <span class="ot">=</span> importance_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"NA"</span>, genus))</span>
<span id="cb205-22"><a href="#cb205-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb205-23"><a href="#cb205-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Plot the top 10 important predictors</span></span>
<span id="cb205-24"><a href="#cb205-24" aria-hidden="true" tabindex="-1"></a>  gp <span class="ot">=</span> <span class="fu">ggplot</span>(importance_df_ggplot, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(genus, <span class="st">`</span><span class="at">MeanDecreaseAccuracy</span><span class="st">`</span>), <span class="at">y =</span> <span class="st">`</span><span class="at">MeanDecreaseAccuracy</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb205-25"><a href="#cb205-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb205-26"><a href="#cb205-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>() <span class="sc">+</span>  <span class="co"># Flip to make the plot horizontal</span></span>
<span id="cb205-27"><a href="#cb205-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb205-28"><a href="#cb205-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Top Most Important Genus Predictors in Random Forest"</span>,</span>
<span id="cb205-29"><a href="#cb205-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Genus"</span>,</span>
<span id="cb205-30"><a href="#cb205-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Increase in Mean Squared Error (%IncMSE)"</span></span>
<span id="cb205-31"><a href="#cb205-31" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb205-32"><a href="#cb205-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">10</span>)</span>
<span id="cb205-33"><a href="#cb205-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb205-34"><a href="#cb205-34" aria-hidden="true" tabindex="-1"></a>  gp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select only the top genera with a relative abundance above 1%</span></span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a>  top_Genus_pc<span class="sc">$</span>top_Genus_above_0<span class="fl">.1</span> <span class="ot">=</span> <span class="fu">ifelse</span>(top_Genus_pc<span class="sc">$</span>top_Genus_percentage <span class="sc">&gt;</span> <span class="dv">1</span>, top_Genus_pc<span class="sc">$</span>top_Genus, <span class="st">"-other"</span>)</span>
<span id="cb206-3"><a href="#cb206-3" aria-hidden="true" tabindex="-1"></a>  top_Genus_above_1 <span class="ot">=</span> <span class="fu">unique</span>(top_Genus_pc<span class="sc">$</span>top_Genus_above_1)</span>
<span id="cb206-4"><a href="#cb206-4" aria-hidden="true" tabindex="-1"></a>  top_Genus_above_1_nog <span class="ot">=</span>  <span class="fu">gsub</span>(<span class="st">"g__"</span>, <span class="st">""</span>, top_Genus_above_1)</span>
<span id="cb206-5"><a href="#cb206-5" aria-hidden="true" tabindex="-1"></a>  top_Genus_above_1_nog</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Prevotella"      "Streptococcus"   "Neisseria"       "Haemophilus"    
 [5] "Veillonella"     "Rothia"          "Fusobacterium"   "Treponema"      
 [9] "Schaalia"        "Escherichia"     "Aggregatibacter" "Selenomonas"    
[13] "Leptotrichia"    "Actinomyces"     "Campylobacter"   "Capnocytophaga" 
[17] "Porphyromonas"   "Bacteroides"     "Gemella"         "-other"         </code></pre>
</div>
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select genera above 1% </span></span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a>importance_df<span class="sc">$</span>genera_above_1pc <span class="ot">=</span> <span class="fu">ifelse</span>(importance_df<span class="sc">$</span>genus <span class="sc">%in%</span> top_Genus_above_1, importance_df<span class="sc">$</span>genus, <span class="st">"-other"</span>)</span>
<span id="cb208-4"><a href="#cb208-4" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(importance_df<span class="sc">$</span>genera_above_1pc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "-other"           "g__Treponema"     "g__Streptococcus" "g__Rothia"       
[5] "g__Schaalia"      "g__Bacteroides"   "g__Veillonella"  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a>importance_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  genus diseased  healthy MeanDecreaseAccuracy MeanDecreaseGini
1     g__Bradyrhizobium 3.660392 3.557975             3.673806       0.50996139
2     g__Nitratifractor 2.886977 2.997524             3.030241       0.33400705
3          g__Treponema 2.962498 2.911517             2.991059       0.36043243
4          g__Wolinella 2.801180 2.802402             2.981173       0.28526589
5      g__Streptococcus 2.787027 2.779934             2.915069       0.28964736
6      g__Mesorhizobium 2.790511 2.761828             2.881425       0.29020077
7             g__Rothia 2.599118 2.761250             2.823918       0.28268074
8           g__Simiduia 2.549200 2.864130             2.805329       0.28998448
9   g__Halothiobacillus 2.496354 2.689688             2.755405       0.26437303
10    g__Thiomicrospira 2.601722 2.658815             2.726651       0.24352427
11       g__Salinispira 2.521035 2.350143             2.625674       0.23040216
12      g__Methylomonas 2.579653 2.470100             2.543027       0.24927539
13      g__Helicobacter 2.088690 2.232992             2.531597       0.18590805
14          g__Schaalia 2.144130 2.413290             2.495430       0.19663482
15     g__Gluconobacter 2.227086 2.517391             2.437368       0.23894843
16       g__Spirochaeta 1.722526 2.028057             2.437185       0.19821883
17         g__Apibacter 2.037999 2.284614             2.397257       0.17730516
18  g__Prosthecochloris 2.216696 2.469697             2.394048       0.25998720
19       g__Spiribacter 2.297540 2.117724             2.272871       0.18288168
20   g__Serpentinomonas 1.936345 1.962885             2.260316       0.17640499
21   g__Geoalkalibacter 1.841104 2.264631             2.251752       0.14044622
22     g__Sphaerochaeta 2.206124 2.103478             2.196250       0.17029541
23   g__Streptobacillus 2.119667 2.160702             2.176204       0.15830508
24       g__Agarilytica 2.370907 1.749595             2.169279       0.16377581
25     g__Thalassospira 1.877006 2.045678             2.136811       0.13782816
26     g__Granulibacter 1.906361 2.119751             2.130254       0.14356757
27       g__Borreliella 1.930511 2.138987             2.088895       0.16342194
28    g__Chloroherpeton 2.142411 1.954972             2.082952       0.10610174
29          g__Niabella 2.141765 1.951497             2.039544       0.17989189
30       g__Bacteroides 1.999736 1.857074             2.012205       0.17357101
31    g__Leptospirillum 1.349602 1.697325             1.997624       0.13054504
32     g__Aquabacterium 1.919154 2.001198             1.989838       0.09464830
33     g__Nitrosococcus 1.732312 2.112943             1.977565       0.17081648
34      g__Nitrosomonas 1.936378 1.925083             1.976378       0.12559560
35       g__Salinimonas 2.003268 1.768322             1.967160       0.13122178
36        g__Microvirga 1.878808 1.859586             1.960088       0.14039013
37      g__Bdellovibrio 1.939976 1.864312             1.954875       0.13583473
38       g__Labilithrix 1.895867 1.650699             1.936699       0.11105688
39 g__Ruminiclostridium 1.795386 1.904024             1.935427       0.13083564
40         g__Kosakonia 1.879982 1.956399             1.930921       0.11751968
41    g__Hydrogenophaga 1.727020 1.937971             1.870173       0.10838049
42         g__Muricauda 1.936378 1.775070             1.868046       0.11144237
43  g__Sulfurospirillum 1.637280 1.902655             1.852548       0.11252056
44       g__Aromatoleum 2.036208 1.229737             1.813548       0.15655335
45        g__Hydromonas 1.411208 1.869259             1.774088       0.06547688
46      g__Methylovulum 1.687840 1.707430             1.730118       0.10702703
47       g__Veillonella 1.570559 1.659584             1.723172       0.08020104
48         g__Atopobium 1.417051 1.599778             1.722366       0.03950574
49       g__Jonquetella 1.723004 1.417051             1.703829       0.13368684
   genera_above_1pc
1            -other
2            -other
3      g__Treponema
4            -other
5  g__Streptococcus
6            -other
7         g__Rothia
8            -other
9            -other
10           -other
11           -other
12           -other
13           -other
14      g__Schaalia
15           -other
16           -other
17           -other
18           -other
19           -other
20           -other
21           -other
22           -other
23           -other
24           -other
25           -other
26           -other
27           -other
28           -other
29           -other
30   g__Bacteroides
31           -other
32           -other
33           -other
34           -other
35           -other
36           -other
37           -other
38           -other
39           -other
40           -other
41           -other
42           -other
43           -other
44           -other
45           -other
46           -other
47   g__Veillonella
48           -other
49           -other</code></pre>
</div>
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a>importance_df_to_plot <span class="ot">=</span> importance_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(genera_above_1pc <span class="sc">!=</span> <span class="st">"-other"</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"NA"</span>, genus))</span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-3"><a href="#cb212-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the top 10 important predictors above 0.1%</span></span>
<span id="cb212-4"><a href="#cb212-4" aria-hidden="true" tabindex="-1"></a>gp2 <span class="ot">=</span> <span class="fu">ggplot</span>(importance_df_to_plot, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(genera_above_1pc, <span class="st">`</span><span class="at">MeanDecreaseAccuracy</span><span class="st">`</span>), <span class="at">y =</span> <span class="st">`</span><span class="at">MeanDecreaseAccuracy</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb212-5"><a href="#cb212-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb212-6"><a href="#cb212-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span>  <span class="co"># Flip to make the plot horizontal</span></span>
<span id="cb212-7"><a href="#cb212-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb212-8"><a href="#cb212-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Top Most Important Genera Predictors"</span>,</span>
<span id="cb212-9"><a href="#cb212-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Genera above 1% overall abundance"</span>,</span>
<span id="cb212-10"><a href="#cb212-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Increase in Mean Squared Error (%IncMSE)"</span></span>
<span id="cb212-11"><a href="#cb212-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb212-12"><a href="#cb212-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">10</span>)</span>
<span id="cb212-13"><a href="#cb212-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-14"><a href="#cb212-14" aria-hidden="true" tabindex="-1"></a>gp2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-38-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"../imgs/Figure_3A.png"</span>, <span class="at">plot =</span> gp2, <span class="at">width =</span> <span class="dv">28</span>, <span class="at">height =</span> <span class="dv">16</span>, <span class="at">dpi =</span> <span class="dv">400</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cross-validation" class="level2">
<h2 class="anchored" data-anchor-id="cross-validation">6.4 Cross validation</h2>
<section id="cross-validation-1" class="level3">
<h3 class="anchored" data-anchor-id="cross-validation-1">6.4.1 Cross validation</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a>  otu_table_g <span class="ot">=</span> <span class="fu">as.data.frame</span>(<span class="fu">otu_table</span>(phyloseq_obj))</span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb214-3"><a href="#cb214-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(otu_table_g) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">".*(g__*)"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, <span class="fu">colnames</span>(otu_table_g))</span>
<span id="cb214-4"><a href="#cb214-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(otu_table_g)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "A10"        "A11"        "A13"        "A14"        "A16"       
 [6] "A17"        "A18"        "A19"        "A1"         "A2"        
[11] "A3"         "A4"         "A5"         "A6"         "A7"        
[16] "A8"         "A9"         "DRR214959"  "DRR214960"  "DRR214961" 
[21] "DRR214962"  "DRR241310"  "SRR5892208" "SRR5892209" "SRR5892210"
[26] "SRR5892211" "SRR5892212" "SRR5892213" "SRR5892214" "SRR5892215"
[31] "SRR5892216" "SRR5892217" "SRS013942"  "SRS014468"  "SRS014692" 
[36] "SRS015055"  "SRS019120" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove columns containing NA</span></span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a>  otu_table_g <span class="ot">&lt;-</span> otu_table_g[, <span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">colnames</span>(otu_table_g))]</span>
<span id="cb216-3"><a href="#cb216-3" aria-hidden="true" tabindex="-1"></a>  otu_table_g <span class="ot">&lt;-</span> otu_table_g[, <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"NA"</span>, <span class="fu">colnames</span>(otu_table_g))]</span>
<span id="cb216-4"><a href="#cb216-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb216-5"><a href="#cb216-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colSums</span>(<span class="fu">is.na</span>(otu_table_g)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       A10        A11        A13        A14        A16        A17        A18 
         0          0          0          0          0          0          0 
       A19         A1         A2         A3         A4         A5         A6 
         0          0          0          0          0          0          0 
        A7         A8         A9  DRR214959  DRR214960  DRR214961  DRR214962 
         0          0          0          0          0          0          0 
 DRR241310 SRR5892208 SRR5892209 SRR5892210 SRR5892211 SRR5892212 SRR5892213 
         0          0          0          0          0          0          0 
SRR5892214 SRR5892215 SRR5892216 SRR5892217  SRS013942  SRS014468  SRS014692 
         0          0          0          0          0          0          0 
 SRS015055  SRS019120 
         0          0 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a>  <span class="co">#otu_table_g = t(otu_table_g)</span></span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb218-3"><a href="#cb218-3" aria-hidden="true" tabindex="-1"></a>  condition <span class="ot">=</span> <span class="fu">as.data.frame</span>(metadata<span class="sc">$</span>condition)</span>
<span id="cb218-4"><a href="#cb218-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(condition) <span class="ot">=</span> <span class="fu">rownames</span>(metadata)</span>
<span id="cb218-5"><a href="#cb218-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb218-6"><a href="#cb218-6" aria-hidden="true" tabindex="-1"></a>  otu_table_g <span class="ot">=</span> <span class="fu">t</span>(otu_table_g)</span>
<span id="cb218-7"><a href="#cb218-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb218-8"><a href="#cb218-8" aria-hidden="true" tabindex="-1"></a>  otu_table_g <span class="ot">&lt;-</span> <span class="fu">cbind</span>(condition, otu_table_g)</span>
<span id="cb218-9"><a href="#cb218-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb218-10"><a href="#cb218-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Split data into training and test sets (80/20 split)</span></span>
<span id="cb218-11"><a href="#cb218-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">123456</span>)</span>
<span id="cb218-12"><a href="#cb218-12" aria-hidden="true" tabindex="-1"></a>  train_index <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(otu_table_g), <span class="fl">0.8</span> <span class="sc">*</span> <span class="fu">nrow</span>(otu_table_g))</span>
<span id="cb218-13"><a href="#cb218-13" aria-hidden="true" tabindex="-1"></a>  train_data <span class="ot">&lt;-</span> otu_table_g[train_index, ]</span>
<span id="cb218-14"><a href="#cb218-14" aria-hidden="true" tabindex="-1"></a>  test_data <span class="ot">&lt;-</span> otu_table_g[<span class="sc">-</span>train_index, ]</span>
<span id="cb218-15"><a href="#cb218-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb218-16"><a href="#cb218-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dim</span>(train_data)  <span class="co"># Check dimensions of your dataset</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]   29 1758</code></pre>
</div>
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dim</span>(test_data) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]    8 1758</code></pre>
</div>
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a>  train_data<span class="sc">$</span><span class="st">`</span><span class="at">metadata$condition</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(train_data<span class="sc">$</span><span class="st">`</span><span class="at">metadata$condition</span><span class="st">`</span>)</span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-3"><a href="#cb222-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Train Random Forest</span></span>
<span id="cb222-4"><a href="#cb222-4" aria-hidden="true" tabindex="-1"></a>  rf_model_2 <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(<span class="st">`</span><span class="at">metadata$condition</span><span class="st">`</span> <span class="sc">~</span> ., <span class="at">data =</span> train_data, <span class="at">importance =</span> <span class="cn">TRUE</span>)</span>
<span id="cb222-5"><a href="#cb222-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb222-6"><a href="#cb222-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Predict on test set</span></span>
<span id="cb222-7"><a href="#cb222-7" aria-hidden="true" tabindex="-1"></a>  pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model_2, test_data, <span class="at">type =</span> <span class="st">"prob"</span>)[, <span class="dv">2</span>]</span>
<span id="cb222-8"><a href="#cb222-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb222-9"><a href="#cb222-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Evaluate model performance</span></span>
<span id="cb222-10"><a href="#cb222-10" aria-hidden="true" tabindex="-1"></a>  roc_obj <span class="ot">&lt;-</span> <span class="fu">roc</span>(test_data<span class="sc">$</span><span class="st">`</span><span class="at">metadata$condition</span><span class="st">`</span>, pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = diseased, case = healthy</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb225"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a>  roc_plot <span class="ot">=</span> <span class="fu">plot</span>(roc_obj, <span class="at">main =</span> <span class="st">"ROC Curve for Random Forest"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb226"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a>  roc_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
roc.default(response = test_data$`metadata$condition`, predictor = pred)

Data: pred in 5 controls (test_data$`metadata$condition` diseased) &lt; 3 cases (test_data$`metadata$condition` healthy).
Area under the curve: 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">auc</span>(roc_obj)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Area under the curve: 1</code></pre>
</div>
</div>
</section>
<section id="train-random-forests-model-with-80-of-dataset" class="level3">
<h3 class="anchored" data-anchor-id="train-random-forests-model-with-80-of-dataset">6.4.1 Train random forests model with 80% of dataset</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load required libraries</span></span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-3"><a href="#cb230-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-4"><a href="#cb230-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Split data into training and testing sets</span></span>
<span id="cb230-5"><a href="#cb230-5" aria-hidden="true" tabindex="-1"></a><span class="co"># This is a crucial step you were missing</span></span>
<span id="cb230-6"><a href="#cb230-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123456</span>) <span class="co"># For reproducibility</span></span>
<span id="cb230-7"><a href="#cb230-7" aria-hidden="true" tabindex="-1"></a>train_index <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(ml_data_clean<span class="sc">$</span>condition, <span class="at">p =</span> <span class="fl">0.8</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb230-8"><a href="#cb230-8" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> ml_data_clean[train_index, ]</span>
<span id="cb230-9"><a href="#cb230-9" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> ml_data_clean[<span class="sc">-</span>train_index, ]</span>
<span id="cb230-10"><a href="#cb230-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-11"><a href="#cb230-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Train Random Forest model on training data</span></span>
<span id="cb230-12"><a href="#cb230-12" aria-hidden="true" tabindex="-1"></a>rf_model_cv <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(condition <span class="sc">~</span> ., </span>
<span id="cb230-13"><a href="#cb230-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data =</span> train_data, </span>
<span id="cb230-14"><a href="#cb230-14" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ntree =</span> <span class="dv">500</span>, </span>
<span id="cb230-15"><a href="#cb230-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">importance =</span> <span class="cn">TRUE</span>)</span>
<span id="cb230-16"><a href="#cb230-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-17"><a href="#cb230-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Print model summary</span></span>
<span id="cb230-18"><a href="#cb230-18" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rf_model_cv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
 randomForest(formula = condition ~ ., data = train_data, ntree = 500,      importance = TRUE) 
               Type of random forest: classification
                     Number of trees: 500
No. of variables tried at each split: 41

        OOB estimate of  error rate: 3.33%
Confusion matrix:
         diseased healthy class.error
diseased       13       1  0.07142857
healthy         0      16  0.00000000</code></pre>
</div>
</div>
</section>
<section id="variable-importance" class="level3">
<h3 class="anchored" data-anchor-id="variable-importance">6.4.1 Variable importance</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Variable importance</span></span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a>importance_rf_model_cv <span class="ot">&lt;-</span> <span class="fu">importance</span>(rf_model_cv)</span>
<span id="cb232-3"><a href="#cb232-3" aria-hidden="true" tabindex="-1"></a><span class="fu">varImpPlot</span>(rf_model_cv, <span class="at">main =</span> <span class="st">"Variable Importance"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="predicting-probabilities-of-test-data-based-on-trained-model" class="level3">
<h3 class="anchored" data-anchor-id="predicting-probabilities-of-test-data-based-on-trained-model">6.4.1 Predicting probabilities of test data based on trained model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb233"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate on testing data - never evaluate on the same data you trained on</span></span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a>predictions_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model_cv, test_data, <span class="at">type =</span> <span class="st">"prob"</span>)</span>
<span id="cb233-3"><a href="#cb233-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-4"><a href="#cb233-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Check structure of predictions</span></span>
<span id="cb233-5"><a href="#cb233-5" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(predictions_prob)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 'matrix' num [1:7, 1:2] 0.892 0.826 0.658 0.026 0.066 0.05 0.162 0.108 0.174 0.342 ...
 - attr(*, "dimnames")=List of 2
  ..$ : chr [1:7] "A11" "A3" "A7" "DRR214962" ...
  ..$ : chr [1:2] "diseased" "healthy"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb235"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract probabilities for the positive class (assuming binary classification)</span></span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a><span class="co"># If condition has levels "No" and "Yes" or "0" and "1"</span></span>
<span id="cb235-3"><a href="#cb235-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the column name of the positive class (typically the second column)</span></span>
<span id="cb235-4"><a href="#cb235-4" aria-hidden="true" tabindex="-1"></a>positive_class <span class="ot">&lt;-</span> <span class="fu">colnames</span>(predictions_prob)[<span class="dv">2</span>]</span>
<span id="cb235-5"><a href="#cb235-5" aria-hidden="true" tabindex="-1"></a>prob_positive <span class="ot">&lt;-</span> predictions_prob[, positive_class]</span>
<span id="cb235-6"><a href="#cb235-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-7"><a href="#cb235-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create class predictions based on probability threshold</span></span>
<span id="cb235-8"><a href="#cb235-8" aria-hidden="true" tabindex="-1"></a>threshold <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb235-9"><a href="#cb235-9" aria-hidden="true" tabindex="-1"></a>predictions_class <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(prob_positive <span class="sc">&gt;</span> threshold, </span>
<span id="cb235-10"><a href="#cb235-10" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">levels</span>(test_data<span class="sc">$</span>condition)[<span class="dv">2</span>], </span>
<span id="cb235-11"><a href="#cb235-11" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">levels</span>(test_data<span class="sc">$</span>condition)[<span class="dv">1</span>]),</span>
<span id="cb235-12"><a href="#cb235-12" aria-hidden="true" tabindex="-1"></a>                           <span class="at">levels =</span> <span class="fu">levels</span>(test_data<span class="sc">$</span>condition))</span>
<span id="cb235-13"><a href="#cb235-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-14"><a href="#cb235-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create confusion matrix</span></span>
<span id="cb235-15"><a href="#cb235-15" aria-hidden="true" tabindex="-1"></a>conf_matrix <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(predictions_class, test_data<span class="sc">$</span>condition)</span>
<span id="cb235-16"><a href="#cb235-16" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(conf_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction diseased healthy
  diseased        3       0
  healthy         0       4
                                     
               Accuracy : 1          
                 95% CI : (0.5904, 1)
    No Information Rate : 0.5714     
    P-Value [Acc &gt; NIR] : 0.01989    
                                     
                  Kappa : 1          
                                     
 Mcnemar's Test P-Value : NA         
                                     
            Sensitivity : 1.0000     
            Specificity : 1.0000     
         Pos Pred Value : 1.0000     
         Neg Pred Value : 1.0000     
             Prevalence : 0.4286     
         Detection Rate : 0.4286     
   Detection Prevalence : 0.4286     
      Balanced Accuracy : 1.0000     
                                     
       'Positive' Class : diseased   
                                     </code></pre>
</div>
</div>
</section>
<section id="roc-curve-and-auc-with-rocr" class="level3">
<h3 class="anchored" data-anchor-id="roc-curve-and-auc-with-rocr">6.4.1 ROC curve and AUC with ROCR</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb237"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ROC curve using ROCR</span></span>
<span id="cb237-2"><a href="#cb237-2" aria-hidden="true" tabindex="-1"></a><span class="co"># For ROCR, we need numeric labels (convert factor to numeric)</span></span>
<span id="cb237-3"><a href="#cb237-3" aria-hidden="true" tabindex="-1"></a>numeric_labels <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(test_data<span class="sc">$</span>condition) <span class="sc">-</span> <span class="dv">1</span>  <span class="co"># Convert to 0/1</span></span>
<span id="cb237-4"><a href="#cb237-4" aria-hidden="true" tabindex="-1"></a>roc_pred <span class="ot">&lt;-</span> <span class="fu">prediction</span>(<span class="at">predictions =</span> prob_positive, <span class="at">labels =</span> numeric_labels)</span>
<span id="cb237-5"><a href="#cb237-5" aria-hidden="true" tabindex="-1"></a>roc_perf <span class="ot">&lt;-</span> <span class="fu">performance</span>(roc_pred, <span class="st">"tpr"</span>, <span class="st">"fpr"</span>)</span>
<span id="cb237-6"><a href="#cb237-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-7"><a href="#cb237-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot ROC curve</span></span>
<span id="cb237-8"><a href="#cb237-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc_perf,</span>
<span id="cb237-9"><a href="#cb237-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">colorize =</span> <span class="cn">TRUE</span>,</span>
<span id="cb237-10"><a href="#cb237-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">print.cutoffs.at =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>),</span>
<span id="cb237-11"><a href="#cb237-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">text.adj =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.2</span>, <span class="fl">1.7</span>),</span>
<span id="cb237-12"><a href="#cb237-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"ROC Curve"</span>)</span>
<span id="cb237-13"><a href="#cb237-13" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"gray"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb238"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate AUC</span></span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a>auc_ROCR <span class="ot">&lt;-</span> <span class="fu">performance</span>(roc_pred, <span class="at">measure =</span> <span class="st">"auc"</span>)</span>
<span id="cb238-3"><a href="#cb238-3" aria-hidden="true" tabindex="-1"></a>auc_value <span class="ot">&lt;-</span> auc_ROCR<span class="sc">@</span>y.values[[<span class="dv">1</span>]]</span>
<span id="cb238-4"><a href="#cb238-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"AUC:"</span>, <span class="fu">round</span>(auc_value, <span class="dv">4</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "AUC: 1"</code></pre>
</div>
</div>
</section>
<section id="roc-curve-and-auc-with-proc" class="level3">
<h3 class="anchored" data-anchor-id="roc-curve-and-auc-with-proc">6.4.1 ROC curve and AUC with pROC</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb240"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternative ROC curve using pROC package</span></span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a>roc_curve <span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="at">response =</span> test_data<span class="sc">$</span>condition, </span>
<span id="cb240-3"><a href="#cb240-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">predictor =</span> prob_positive)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = diseased, case = healthy</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb243"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc_curve, <span class="at">main =</span> <span class="st">"ROC Curve using pROC"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb244"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"AUC (pROC):"</span>, <span class="fu">round</span>(<span class="fu">auc</span>(roc_curve), <span class="dv">4</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "AUC (pROC): 1"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb246"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save as pnf file</span></span>
<span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Open png file</span></span>
<span id="cb246-3"><a href="#cb246-3" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">"../imgs/Figure_3B.png"</span>, <span class="at">width =</span> <span class="dv">256</span>, <span class="at">height =</span> <span class="dv">256</span>, <span class="at">units =</span> <span class="st">"px"</span>)</span>
<span id="cb246-4"><a href="#cb246-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Create the plot</span></span>
<span id="cb246-5"><a href="#cb246-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc_curve, <span class="at">main =</span> <span class="st">"ROC Curve using pROC"</span>)</span>
<span id="cb246-6"><a href="#cb246-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"AUC (pROC):"</span>, <span class="fu">round</span>(<span class="fu">auc</span>(roc_curve), <span class="dv">4</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "AUC (pROC): 1"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb248"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Close the file</span></span>
<span id="cb248-2"><a href="#cb248-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>quartz_off_screen 
                2 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb250"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print performance metrics</span></span>
<span id="cb250-2"><a href="#cb250-2" aria-hidden="true" tabindex="-1"></a>accuracy <span class="ot">&lt;-</span> conf_matrix<span class="sc">$</span>overall[<span class="st">"Accuracy"</span>]</span>
<span id="cb250-3"><a href="#cb250-3" aria-hidden="true" tabindex="-1"></a>sensitivity <span class="ot">&lt;-</span> conf_matrix<span class="sc">$</span>byClass[<span class="st">"Sensitivity"</span>]</span>
<span id="cb250-4"><a href="#cb250-4" aria-hidden="true" tabindex="-1"></a>specificity <span class="ot">&lt;-</span> conf_matrix<span class="sc">$</span>byClass[<span class="st">"Specificity"</span>]</span>
<span id="cb250-5"><a href="#cb250-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb250-6"><a href="#cb250-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Accuracy:"</span>, <span class="fu">round</span>(accuracy, <span class="dv">4</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Accuracy: 1"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb252"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Sensitivity:"</span>, <span class="fu">round</span>(sensitivity, <span class="dv">4</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Sensitivity: 1"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb254"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Specificity:"</span>, <span class="fu">round</span>(specificity, <span class="dv">4</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Specificity: 1"</code></pre>
</div>
</div>
</section>
</section>
<section id="permutation-testing-for-rf-accuracy" class="level2">
<h2 class="anchored" data-anchor-id="permutation-testing-for-rf-accuracy">6.5 Permutation testing for RF accuracy</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb256"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ensure column names are correctly referenced</span></span>
<span id="cb256-2"><a href="#cb256-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">123456</span>)</span>
<span id="cb256-3"><a href="#cb256-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb256-4"><a href="#cb256-4" aria-hidden="true" tabindex="-1"></a>  train_data<span class="sc">$</span><span class="st">`</span><span class="at">metadata$condition</span><span class="st">`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
<div class="sourceCode cell-code" id="cb258"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(train_data)[<span class="fu">colnames</span>(train_data) <span class="sc">==</span> <span class="st">"metadata$condition"</span>] <span class="ot">&lt;-</span> <span class="st">"condition"</span></span>
<span id="cb258-2"><a href="#cb258-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(test_data)[<span class="fu">colnames</span>(test_data) <span class="sc">==</span> <span class="st">"metadata$condition"</span>] <span class="ot">&lt;-</span> <span class="st">"condition"</span></span>
<span id="cb258-3"><a href="#cb258-3" aria-hidden="true" tabindex="-1"></a>  train_data<span class="sc">$</span>condition</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] diseased diseased diseased diseased diseased diseased diseased diseased
 [9] diseased diseased diseased diseased diseased diseased healthy  healthy 
[17] healthy  healthy  healthy  healthy  healthy  healthy  healthy  healthy 
[25] healthy  healthy  healthy  healthy  healthy  healthy 
Levels: diseased healthy</code></pre>
</div>
<div class="sourceCode cell-code" id="cb260"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a>  test_data<span class="sc">$</span>condition</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] diseased diseased diseased healthy  healthy  healthy  healthy 
Levels: diseased healthy</code></pre>
</div>
<div class="sourceCode cell-code" id="cb262"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Permutation testing</span></span>
<span id="cb262-2"><a href="#cb262-2" aria-hidden="true" tabindex="-1"></a>  null_accuracies <span class="ot">&lt;-</span> <span class="fu">replicate</span>(<span class="dv">10</span>, {</span>
<span id="cb262-3"><a href="#cb262-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Shuffle the labels</span></span>
<span id="cb262-4"><a href="#cb262-4" aria-hidden="true" tabindex="-1"></a>    perm_labels <span class="ot">&lt;-</span> <span class="fu">sample</span>(train_data<span class="sc">$</span>condition)  <span class="co"># Use the actual column name for condition</span></span>
<span id="cb262-5"><a href="#cb262-5" aria-hidden="true" tabindex="-1"></a>    train_data_perm <span class="ot">&lt;-</span> train_data</span>
<span id="cb262-6"><a href="#cb262-6" aria-hidden="true" tabindex="-1"></a>    train_data_perm<span class="sc">$</span>condition <span class="ot">&lt;-</span> perm_labels  <span class="co"># Replace condition labels with permuted ones</span></span>
<span id="cb262-7"><a href="#cb262-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb262-8"><a href="#cb262-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Train random forest on permuted data</span></span>
<span id="cb262-9"><a href="#cb262-9" aria-hidden="true" tabindex="-1"></a>    rf_perm <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(condition <span class="sc">~</span> ., <span class="at">data =</span> train_data_perm, <span class="at">importance =</span> <span class="cn">TRUE</span>)</span>
<span id="cb262-10"><a href="#cb262-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb262-11"><a href="#cb262-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Test on test_data</span></span>
<span id="cb262-12"><a href="#cb262-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(<span class="fu">predict</span>(rf_perm, test_data) <span class="sc">==</span> test_data<span class="sc">$</span>condition)  <span class="co"># Ensure test_data$condition matches</span></span>
<span id="cb262-13"><a href="#cb262-13" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb262-14"><a href="#cb262-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb262-15"><a href="#cb262-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compare observed accuracy to null distribution</span></span>
<span id="cb262-16"><a href="#cb262-16" aria-hidden="true" tabindex="-1"></a>  observed_accuracy <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">predict</span>(rf_model_cv, test_data) <span class="sc">==</span> test_data<span class="sc">$</span>condition)</span>
<span id="cb262-17"><a href="#cb262-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb262-18"><a href="#cb262-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Visualize and interpret</span></span>
<span id="cb262-19"><a href="#cb262-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb262-20"><a href="#cb262-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2. Create the plot</span></span>
<span id="cb262-21"><a href="#cb262-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hist</span>(null_accuracies, <span class="at">main =</span> <span class="st">"Null Distribution of Accuracy"</span>, <span class="at">xlab =</span> <span class="st">"Accuracy"</span>)</span>
<span id="cb262-22"><a href="#cb262-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">v =</span> observed_accuracy, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb263"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save as pnf file</span></span>
<span id="cb263-2"><a href="#cb263-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Open png file</span></span>
<span id="cb263-3"><a href="#cb263-3" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">"../imgs/Figure_3C.png"</span>, <span class="at">width =</span> <span class="dv">2560</span>, <span class="at">height =</span> <span class="dv">2560</span>, <span class="at">units =</span> <span class="st">"px"</span>)</span>
<span id="cb263-4"><a href="#cb263-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Create the plot</span></span>
<span id="cb263-5"><a href="#cb263-5" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(null_accuracies, <span class="at">main =</span> <span class="st">"Null Distribution of Accuracy"</span>, <span class="at">xlab =</span> <span class="st">"Accuracy"</span>)</span>
<span id="cb263-6"><a href="#cb263-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> observed_accuracy, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>) </span>
<span id="cb263-7"><a href="#cb263-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Close the file</span></span>
<span id="cb263-8"><a href="#cb263-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>quartz_off_screen 
                2 </code></pre>
</div>
</div>
</section>
</section>
<section id="ordination-of-multivariate-data" class="level1">
<h1>7. Ordination of multivariate data</h1>
<p>Here we run ordination of multivariate data into two dimensions using the unsupervised learning techniques; Principal Coordinate Analysis (PCoA), Non-metric Multidimensional Scaling (NMDS), and Redundancy Analysis (RDA) all with Bray-Curtis dissimilarity.</p>
<section id="calculating-bray-curtis-dissimilarity" class="level2">
<h2 class="anchored" data-anchor-id="calculating-bray-curtis-dissimilarity">7.1 Calculating Bray-Curtis dissimilarity</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb265"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a>  phyloseq_obj</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>phyloseq-class experiment-level object
otu_table()   OTU Table:         [ 1757 taxa and 37 samples ]
sample_data() Sample Data:       [ 37 samples by 1 sample variables ]
tax_table()   Taxonomy Table:    [ 1757 taxa by 7 taxonomic ranks ]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb267"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true" tabindex="-1"></a>  phyloseq_obj<span class="sc">@</span>sam_data[[<span class="st">"condition"</span>]] <span class="ot">=</span> <span class="fu">as.factor</span>(phyloseq_obj<span class="sc">@</span>sam_data[[<span class="st">"condition"</span>]])</span>
<span id="cb267-2"><a href="#cb267-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb267-3"><a href="#cb267-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate Bray-Curtis dissimilarity</span></span>
<span id="cb267-4"><a href="#cb267-4" aria-hidden="true" tabindex="-1"></a>  dist_bc <span class="ot">&lt;-</span> phyloseq<span class="sc">::</span><span class="fu">distance</span>(phyloseq_obj, <span class="at">method =</span> <span class="st">"bray"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="permanova" class="level2">
<h2 class="anchored" data-anchor-id="permanova">7.1 PERMANOVA</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb268"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a>  dist_bc <span class="ot">&lt;-</span> phyloseq<span class="sc">::</span><span class="fu">distance</span>(phyloseq_obj, <span class="at">method =</span> <span class="st">"bray"</span>)</span>
<span id="cb268-2"><a href="#cb268-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adonis2</span>(dist_bc <span class="sc">~</span> condition, <span class="at">data =</span> <span class="fu">as</span>(<span class="fu">sample_data</span>(phyloseq_obj), <span class="st">"data.frame"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Permutation test for adonis under reduced model
Permutation: free
Number of permutations: 999

adonis2(formula = dist_bc ~ condition, data = as(sample_data(phyloseq_obj), "data.frame"))
         Df SumOfSqs      R2      F Pr(&gt;F)    
Model     1   2.5163 0.40556 23.879  0.001 ***
Residual 35   3.6881 0.59444                  
Total    36   6.2044 1.00000                  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
<section id="pcoa" class="level2">
<h2 class="anchored" data-anchor-id="pcoa">7.3 PCoA</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb270"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Visualize PCoA</span></span>
<span id="cb270-2"><a href="#cb270-2" aria-hidden="true" tabindex="-1"></a>  ordination_results <span class="ot">&lt;-</span> <span class="fu">ordinate</span>(phyloseq_obj, <span class="at">method =</span> <span class="st">"PCoA"</span>, <span class="at">distance =</span> <span class="st">"bray"</span>)</span>
<span id="cb270-3"><a href="#cb270-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb270-4"><a href="#cb270-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert ordination to a data frame</span></span>
<span id="cb270-5"><a href="#cb270-5" aria-hidden="true" tabindex="-1"></a>  ordination_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(ordination_results<span class="sc">$</span>vectors)</span>
<span id="cb270-6"><a href="#cb270-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(ordination_df) <span class="ot">=</span> <span class="fu">rownames</span>(ordination_results<span class="sc">$</span>vectors)</span>
<span id="cb270-7"><a href="#cb270-7" aria-hidden="true" tabindex="-1"></a>  ordination_df<span class="sc">$</span>condition <span class="ot">&lt;-</span> <span class="fu">sample_data</span>(phyloseq_obj)<span class="sc">$</span>condition</span>
<span id="cb270-8"><a href="#cb270-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(ordination_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Axis.1     Axis.2      Axis.3      Axis.4       Axis.5        Axis.6
A10 -0.3990528 -0.2763281 -0.02763561  0.01750740 -0.138888422  0.0500316957
A11 -0.2163923  0.1093911  0.08424231 -0.01368495  0.077659141  0.1039769612
A13 -0.3788201 -0.0812252  0.02994839  0.04811056 -0.024370993  0.0032111610
A14 -0.2237416  0.1484954  0.07359393 -0.02273669  0.066676250  0.0005697727
A16 -0.1909393  0.3327742 -0.02746487  0.04747409  0.005856121  0.1327296103
A17 -0.2253981  0.1666075 -0.11150852  0.18120400  0.321480041 -0.1972564933
          Axis.7      Axis.8       Axis.9      Axis.10     Axis.11      Axis.12
A10 -0.014754793 -0.06335845  0.105871797  0.019766348  0.03963333 -0.045911689
A11  0.074412305  0.09558781 -0.043101902 -0.065767576  0.02368048  0.009730679
A13  0.062739465 -0.07794522  0.006988258  0.052129777  0.01741799 -0.026402558
A14  0.012886279  0.10306105  0.071850753  0.038935393 -0.03672565 -0.094311398
A16 -0.044221595  0.02505884 -0.053434452 -0.039630828  0.10089014  0.041121914
A17 -0.005963391 -0.07225894  0.074203753 -0.002761451  0.01035562  0.015650505
         Axis.13       Axis.14       Axis.15      Axis.16       Axis.17
A10 -0.007735055  0.0243225804 -0.0500978722  0.002754255  0.0141803813
A11  0.028719219  0.0468579695 -0.0008639627  0.013852955  0.0001041077
A13  0.090486148 -0.0029947033 -0.0005909820 -0.037640174  0.0089074175
A14 -0.021976023 -0.0189616196 -0.0040817690 -0.017059139  0.0036328221
A16 -0.036876441  0.0002420351  0.0005302102 -0.001988632  0.0121336219
A17 -0.003764348  0.0045354662 -0.0201016169  0.016929575 -0.0135230435
          Axis.18      Axis.19      Axis.20      Axis.21      Axis.22 condition
A10 -0.0204580789 -0.003451114  0.020110360  0.015963667 -0.008437933  diseased
A11 -0.0039070040 -0.022333723 -0.001090578 -0.001483207 -0.002401530  diseased
A13 -0.0053896699 -0.013526270 -0.003312557 -0.001061440 -0.002060376  diseased
A14  0.0251298650  0.012571149 -0.001016701  0.001364480  0.007975996  diseased
A16 -0.0009390817 -0.001842882  0.004423927  0.005939336 -0.004796995  diseased
A17  0.0006735671 -0.001796595  0.001398673 -0.001108894 -0.001930982  diseased</code></pre>
</div>
<div class="sourceCode cell-code" id="cb272"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Plot using ggplot2</span></span>
<span id="cb272-2"><a href="#cb272-2" aria-hidden="true" tabindex="-1"></a>  PCoA_plot <span class="ot">=</span> <span class="fu">ggplot</span>(ordination_df, <span class="fu">aes</span>(<span class="at">x =</span> Axis<span class="fl">.1</span>, <span class="at">y =</span> Axis<span class="fl">.2</span>, <span class="at">color =</span> condition)) <span class="sc">+</span></span>
<span id="cb272-3"><a href="#cb272-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb272-4"><a href="#cb272-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb272-5"><a href="#cb272-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"PCoA1"</span>, <span class="at">y =</span> <span class="st">"PCoA2"</span>)  <span class="sc">+</span></span>
<span id="cb272-6"><a href="#cb272-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"PCoA"</span>) <span class="sc">+</span></span>
<span id="cb272-7"><a href="#cb272-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">10</span>)</span>
<span id="cb272-8"><a href="#cb272-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb272-9"><a href="#cb272-9" aria-hidden="true" tabindex="-1"></a>  PCoA_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="nmds" class="level2">
<h2 class="anchored" data-anchor-id="nmds">7.4 NMDS</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb273"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb273-1"><a href="#cb273-1" aria-hidden="true" tabindex="-1"></a>  ordination_results <span class="ot">&lt;-</span> <span class="fu">ordinate</span>(phyloseq_obj, <span class="at">method =</span> <span class="st">"NMDS"</span>, <span class="at">distance =</span> <span class="st">"bray"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Square root transformation
Wisconsin double standardization
Run 0 stress 0.102349 
Run 1 stress 0.1218075 
Run 2 stress 0.1219462 
Run 3 stress 0.102349 
... New best solution
... Procrustes: rmse 0.0001243376  max resid 0.0006357427 
... Similar to previous best
Run 4 stress 0.1310319 
Run 5 stress 0.102349 
... New best solution
... Procrustes: rmse 9.059102e-05  max resid 0.0004721109 
... Similar to previous best
Run 6 stress 0.1412518 
Run 7 stress 0.1219459 
Run 8 stress 0.102349 
... New best solution
... Procrustes: rmse 5.234615e-05  max resid 0.0002581765 
... Similar to previous best
Run 9 stress 0.1604445 
Run 10 stress 0.102349 
... Procrustes: rmse 5.683581e-05  max resid 0.0002887745 
... Similar to previous best
Run 11 stress 0.1507048 
Run 12 stress 0.1197668 
Run 13 stress 0.1307239 
Run 14 stress 0.102349 
... New best solution
... Procrustes: rmse 2.545909e-05  max resid 0.0001010183 
... Similar to previous best
Run 15 stress 0.1197667 
Run 16 stress 0.1473149 
Run 17 stress 0.1219461 
Run 18 stress 0.1519854 
Run 19 stress 0.1561846 
Run 20 stress 0.1561631 
*** Best solution repeated 1 times</code></pre>
</div>
<div class="sourceCode cell-code" id="cb275"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert ordination to a data frame</span></span>
<span id="cb275-2"><a href="#cb275-2" aria-hidden="true" tabindex="-1"></a>  ordination_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(ordination_results<span class="sc">$</span>points)</span>
<span id="cb275-3"><a href="#cb275-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(ordination_df) <span class="ot">=</span> <span class="fu">rownames</span>(ordination_results<span class="sc">$</span>points)</span>
<span id="cb275-4"><a href="#cb275-4" aria-hidden="true" tabindex="-1"></a>  ordination_df<span class="sc">$</span>condition <span class="ot">&lt;-</span> <span class="fu">sample_data</span>(phyloseq_obj)<span class="sc">$</span>condition</span>
<span id="cb275-5"><a href="#cb275-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(ordination_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           MDS1         MDS2 condition
A10 -0.06261851  0.105930840  diseased
A11 -0.07493600  0.005848067  diseased
A13 -0.05958729  0.074261637  diseased
A14 -0.12131611  0.035256716  diseased
A16 -0.11960044 -0.006426233  diseased
A17 -0.25741911  0.112212205  diseased</code></pre>
</div>
<div class="sourceCode cell-code" id="cb277"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Plot using ggplot2</span></span>
<span id="cb277-2"><a href="#cb277-2" aria-hidden="true" tabindex="-1"></a>  NMDS_plot <span class="ot">=</span> <span class="fu">ggplot</span>(ordination_df, <span class="fu">aes</span>(<span class="at">x =</span> MDS1, <span class="at">y =</span> MDS2, <span class="at">color =</span> condition)) <span class="sc">+</span></span>
<span id="cb277-3"><a href="#cb277-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb277-4"><a href="#cb277-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"MDS1"</span>, <span class="at">y =</span> <span class="st">"MDS2"</span>)  <span class="sc">+</span></span>
<span id="cb277-5"><a href="#cb277-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"NMDS"</span>) <span class="sc">+</span></span>
<span id="cb277-6"><a href="#cb277-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">10</span>)</span>
<span id="cb277-7"><a href="#cb277-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb277-8"><a href="#cb277-8" aria-hidden="true" tabindex="-1"></a>  NMDS_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="rda" class="level2">
<h2 class="anchored" data-anchor-id="rda">7.5 RDA</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb278"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Visualize PCoA</span></span>
<span id="cb278-2"><a href="#cb278-2" aria-hidden="true" tabindex="-1"></a>  ordination_results <span class="ot">&lt;-</span> <span class="fu">ordinate</span>(phyloseq_obj, <span class="at">method =</span> <span class="st">"RDA"</span>, <span class="at">distance =</span> <span class="st">"bray"</span>)</span>
<span id="cb278-3"><a href="#cb278-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb278-4"><a href="#cb278-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert ordination to a data frame</span></span>
<span id="cb278-5"><a href="#cb278-5" aria-hidden="true" tabindex="-1"></a>  ordination_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(ordination_results[[<span class="st">"CA"</span>]][[<span class="st">"u"</span>]])</span>
<span id="cb278-6"><a href="#cb278-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(ordination_df) <span class="ot">=</span> <span class="fu">rownames</span>(ordination_results[[<span class="st">"CA"</span>]][[<span class="st">"u"</span>]])</span>
<span id="cb278-7"><a href="#cb278-7" aria-hidden="true" tabindex="-1"></a>  ordination_df<span class="sc">$</span>condition <span class="ot">&lt;-</span> <span class="fu">sample_data</span>(phyloseq_obj)<span class="sc">$</span>condition</span>
<span id="cb278-8"><a href="#cb278-8" aria-hidden="true" tabindex="-1"></a>  ordination_df<span class="sc">$</span>sample_names <span class="ot">=</span> <span class="fu">rownames</span>(ordination_df)</span>
<span id="cb278-9"><a href="#cb278-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(ordination_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            PC1         PC2          PC3         PC4         PC5         PC6
A10 -0.33204284  0.20912012 -0.144253041 -0.03059961  0.23588105 -0.03713143
A11 -0.08468054 -0.05827521  0.091839883 -0.03904873 -0.03025444  0.11074921
A13 -0.21986915  0.05864669 -0.005890016 -0.06419824  0.11837347  0.01683602
A14 -0.10014296 -0.07028627  0.129444325 -0.03692765 -0.06995082 -0.05230855
A16 -0.03148699 -0.19503334  0.263923709 -0.14196187  0.07884507  0.16475294
A17 -0.04975940 -0.15219201  0.110139728 -0.25735315 -0.72081181 -0.17642925
            PC7         PC8          PC9         PC10        PC11        PC12
A10 -0.02944898  0.25566690 -0.306760531  0.124883398 -0.12498715  0.16274571
A11  0.01094340 -0.15876290  0.115473979 -0.367725699 -0.16103047  0.05711542
A13  0.02455014  0.04861554 -0.109757220  0.007177984 -0.18117784 -0.42471427
A14 -0.10766862  0.28908187 -0.164363766  0.068477770  0.10221473  0.21414285
A16 -0.03183595 -0.11431324  0.176763963 -0.080347004 -0.16250451  0.27998110
A17 -0.11097290  0.11671967 -0.002509756  0.347931019 -0.08731619 -0.19967489
            PC13        PC14        PC15         PC16        PC17       PC18
A10 -0.095156533  0.09453161 -0.12202847  0.020785156  0.03601123 -0.1181814
A11 -0.007034822  0.15933808 -0.07668232  0.112010102 -0.12134268 -0.1053740
A13 -0.576576384  0.18839905  0.02470430  0.086624203  0.05976665 -0.1154655
A14  0.165565336 -0.03733827  0.18188986 -0.148754274  0.18201159 -0.1773570
A16 -0.059880870  0.26900679 -0.28375716 -0.031229954 -0.11600837 -0.2700773
A17 -0.045742598  0.03633465 -0.01428297  0.009103755 -0.13884746  0.1092161
           PC19        PC20        PC21         PC22        PC23        PC24
A10 -0.22109978  0.13269048  0.16100239  0.097298537  0.06213204  0.03879865
A11 -0.01730906  0.46492550 -0.16470574  0.271570983  0.33759611  0.12054865
A13  0.10220793 -0.14417527 -0.06732180 -0.122297369  0.16478915 -0.27003072
A14 -0.12276290 -0.13931812  0.08742432 -0.030674244 -0.01195781 -0.02473966
A16 -0.11544395 -0.03174451  0.02565170 -0.006926064 -0.51149227 -0.18306242
A17 -0.06962461  0.14244117 -0.10618803  0.080501463 -0.07313958 -0.07749316
           PC25        PC26          PC27        PC28        PC29        PC30
A10 -0.42812319 -0.21903386 -0.0007227003 -0.02340901 -0.02632542 -0.16877654
A11 -0.02948713 -0.02394383  0.0017440496  0.21644163 -0.18301587  0.31180164
A13  0.12137868  0.17231373  0.1538940397 -0.05300262  0.06280725  0.08988459
A14  0.10997873 -0.17703706  0.3085810106  0.31629916  0.11977402  0.43975276
A16  0.08708884 -0.08039283 -0.0044842244 -0.21725513  0.01552273 -0.10433124
A17 -0.12309220 -0.05488621 -0.0601495289  0.03133817 -0.02899176 -0.06770742
           PC31        PC32        PC33         PC34         PC35         PC36
A10 -0.03695492 -0.22395802 -0.04865635 -0.181440709 -0.037170808 -0.131063826
A11 -0.01621193 -0.05244742  0.05173978  0.173070007  0.064738719 -0.042649428
A13 -0.07342503  0.16770515  0.01757990  0.050672094  0.018517629  0.105086390
A14  0.02943466  0.31496951 -0.06218461  0.074158512  0.013174469 -0.024876276
A16  0.02869031  0.12802347 -0.09138193  0.042254488 -0.004793286 -0.020223887
A17 -0.01490583 -0.06973480 -0.03553475 -0.007599638  0.002019312  0.005315909
    condition sample_names
A10  diseased          A10
A11  diseased          A11
A13  diseased          A13
A14  diseased          A14
A16  diseased          A16
A17  diseased          A17</code></pre>
</div>
<div class="sourceCode cell-code" id="cb280"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Plot using ggplot2</span></span>
<span id="cb280-2"><a href="#cb280-2" aria-hidden="true" tabindex="-1"></a>  RDA_plot <span class="ot">=</span> <span class="fu">ggplot</span>(ordination_df, <span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2, <span class="at">color =</span> condition)) <span class="sc">+</span></span>
<span id="cb280-3"><a href="#cb280-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb280-4"><a href="#cb280-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"PC1"</span>, <span class="at">y =</span> <span class="st">"PC2"</span>)  <span class="sc">+</span></span>
<span id="cb280-5"><a href="#cb280-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"RDA"</span>) <span class="sc">+</span></span>
<span id="cb280-6"><a href="#cb280-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">10</span>)</span>
<span id="cb280-7"><a href="#cb280-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-8"><a href="#cb280-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-9"><a href="#cb280-9" aria-hidden="true" tabindex="-1"></a>   RDA_plot </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Now we will save all the plots together</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb281"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(PCoA_plot, NMDS_plot, RDA_plot, <span class="at">ncol=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb282"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"../imgs/Figure_3D.png"</span>, </span>
<span id="cb282-2"><a href="#cb282-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">arrangeGrob</span>(PCoA_plot, NMDS_plot, RDA_plot, <span class="at">ncol=</span><span class="dv">3</span>),</span>
<span id="cb282-3"><a href="#cb282-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">20</span>,</span>
<span id="cb282-4"><a href="#cb282-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="hierachical-clustering-of-centered-log-ratios" class="level1">
<h1>7. Hierachical Clustering of Centered log ratios</h1>
<p>Here we plotted a heatmap displaying the z-score standardized centered log-ratio (CLR) of the top 20 most abundant genera.</p>
<section id="preparing-the-data-3" class="level2">
<h2 class="anchored" data-anchor-id="preparing-the-data-3">7.1 Preparing the data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb283"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ensure Genus </span></span>
<span id="cb283-2"><a href="#cb283-2" aria-hidden="true" tabindex="-1"></a>  tse_genus <span class="ot">&lt;-</span> <span class="fu">altExp</span>(tse_metaphlan, <span class="st">"Genus"</span>)</span>
<span id="cb283-3"><a href="#cb283-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb283-4"><a href="#cb283-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add clr-transformation (centred-lofg ratio)</span></span>
<span id="cb283-5"><a href="#cb283-5" aria-hidden="true" tabindex="-1"></a>  tse_genus <span class="ot">&lt;-</span> <span class="fu">transformAssay</span>(tse_genus, <span class="at">assay.type =</span> <span class="st">"counts"</span>, <span class="at">method =</span> <span class="st">"relabundance"</span>)</span>
<span id="cb283-6"><a href="#cb283-6" aria-hidden="true" tabindex="-1"></a>  tse_genus <span class="ot">&lt;-</span> <span class="fu">transformAssay</span>(tse_genus, <span class="at">assay.type =</span> <span class="st">"relabundance"</span>,</span>
<span id="cb283-7"><a href="#cb283-7" aria-hidden="true" tabindex="-1"></a>                              <span class="at">method =</span> <span class="st">"clr"</span>, <span class="at">pseudocount =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>A pseudocount of 7.6187051401118e-09 was applied.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb285"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb285-1"><a href="#cb285-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Apply a z-transformation across rows (taxa)</span></span>
<span id="cb285-2"><a href="#cb285-2" aria-hidden="true" tabindex="-1"></a>  tse_genus <span class="ot">&lt;-</span> <span class="fu">transformAssay</span>(tse_genus, <span class="at">assay.type =</span> <span class="st">"clr"</span>, </span>
<span id="cb285-3"><a href="#cb285-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">MARGIN =</span> <span class="st">"features"</span>,</span>
<span id="cb285-4"><a href="#cb285-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">method =</span> <span class="st">"standardize"</span>, <span class="at">name =</span> <span class="st">"clr_z"</span>)</span>
<span id="cb285-5"><a href="#cb285-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb285-6"><a href="#cb285-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get 20 most abundant genera, and subsets the data by them</span></span>
<span id="cb285-7"><a href="#cb285-7" aria-hidden="true" tabindex="-1"></a>  top_20_genus <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">sort</span>(total_relabundance_Genus, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>])</span>
<span id="cb285-8"><a href="#cb285-8" aria-hidden="true" tabindex="-1"></a>  tse_genus_subset <span class="ot">&lt;-</span> tse_genus[top_20_genus, ]</span>
<span id="cb285-9"><a href="#cb285-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb285-10"><a href="#cb285-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate the proportion of bacteria accounted for in the top 20 Genera</span></span>
<span id="cb285-11"><a href="#cb285-11" aria-hidden="true" tabindex="-1"></a>  (<span class="fu">sum</span>(<span class="fu">assay</span>(tse_genus_subset, <span class="st">"relabundance"</span>))) <span class="sc">/</span> <span class="dv">15</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.226121</code></pre>
</div>
<div class="sourceCode cell-code" id="cb287"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># delete to _g__</span></span>
<span id="cb287-2"><a href="#cb287-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(tse_genus_subset) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">".*(g__*)"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, <span class="fu">rownames</span>(tse_genus_subset))</span>
<span id="cb287-3"><a href="#cb287-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb287-4"><a href="#cb287-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Gets the assay table</span></span>
<span id="cb287-5"><a href="#cb287-5" aria-hidden="true" tabindex="-1"></a>  mat <span class="ot">&lt;-</span> <span class="fu">assay</span>(tse_genus_subset, <span class="st">"clr_z"</span>)</span>
<span id="cb287-6"><a href="#cb287-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb287-7"><a href="#cb287-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make a dataframe for sample information</span></span>
<span id="cb287-8"><a href="#cb287-8" aria-hidden="true" tabindex="-1"></a>  sample_data <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">colData</span>(tse_genus_subset))</span>
<span id="cb287-9"><a href="#cb287-9" aria-hidden="true" tabindex="-1"></a>  sample_data <span class="ot">&lt;-</span> sample_data[, <span class="fu">c</span>(<span class="st">"condition"</span>), drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb287-10"><a href="#cb287-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb287-11"><a href="#cb287-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make a dataframe for taxonomic information</span></span>
<span id="cb287-12"><a href="#cb287-12" aria-hidden="true" tabindex="-1"></a>  taxonomic_data <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">rowData</span>(tse_genus_subset))</span>
<span id="cb287-13"><a href="#cb287-13" aria-hidden="true" tabindex="-1"></a>  taxonomic_data <span class="ot">&lt;-</span> taxonomic_data[, <span class="st">"Phylum"</span>, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plotting-heatmap-of-centred-log-ratios" class="level2">
<h2 class="anchored" data-anchor-id="plotting-heatmap-of-centred-log-ratios">7.2 Plotting heatmap of centred log ratios</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb288"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set heatmap scaling and colors</span></span>
<span id="cb288-2"><a href="#cb288-2" aria-hidden="true" tabindex="-1"></a>  breaks <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fu">ceiling</span>(<span class="fu">max</span>(<span class="fu">abs</span>(mat))), <span class="fu">ceiling</span>(<span class="fu">max</span>(<span class="fu">abs</span>(mat))), </span>
<span id="cb288-3"><a href="#cb288-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">length.out =</span> <span class="fu">ifelse</span>( <span class="fu">max</span>(<span class="fu">abs</span>(mat))<span class="sc">&gt;</span><span class="dv">5</span>, <span class="dv">2</span><span class="sc">*</span><span class="fu">ceiling</span>(<span class="fu">max</span>(<span class="fu">abs</span>(mat))), <span class="dv">10</span> ) )</span>
<span id="cb288-4"><a href="#cb288-4" aria-hidden="true" tabindex="-1"></a>  colors <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">"darkblue"</span>, <span class="st">"blue"</span>, <span class="st">"white"</span>, <span class="st">"red"</span>, <span class="st">"darkred"</span>))(<span class="fu">length</span>(breaks)<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb288-5"><a href="#cb288-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb288-6"><a href="#cb288-6" aria-hidden="true" tabindex="-1"></a>  colors <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">"#1E3A5F"</span>, <span class="st">"#4682B4"</span>, <span class="st">"#FFFFFF"</span>, <span class="st">"#E41A1C"</span>, <span class="st">"#A11618"</span>))(<span class="fu">length</span>(breaks) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb288-7"><a href="#cb288-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb288-8"><a href="#cb288-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set column annotation colors</span></span>
<span id="cb288-9"><a href="#cb288-9" aria-hidden="true" tabindex="-1"></a>  ann_colors <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb288-10"><a href="#cb288-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">condition =</span> <span class="fu">c</span>(<span class="st">"healthy"</span> <span class="ot">=</span> <span class="st">"#4682B4"</span>, <span class="st">"diseased"</span> <span class="ot">=</span> <span class="st">"#E41A1C"</span>),</span>
<span id="cb288-11"><a href="#cb288-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">taxonomic_data =</span> <span class="fu">c</span>(<span class="fu">brewer.pal</span>(<span class="dv">6</span>, <span class="st">"Dark2"</span>))</span>
<span id="cb288-12"><a href="#cb288-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb288-13"><a href="#cb288-13" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb288-14"><a href="#cb288-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create the heatmap</span></span>
<span id="cb288-15"><a href="#cb288-15" aria-hidden="true" tabindex="-1"></a>  genus_clusters <span class="ot">=</span> <span class="fu">pheatmap</span>(mat, </span>
<span id="cb288-16"><a href="#cb288-16" aria-hidden="true" tabindex="-1"></a>                             <span class="at">annotation_col =</span> sample_data, </span>
<span id="cb288-17"><a href="#cb288-17" aria-hidden="true" tabindex="-1"></a>                             <span class="at">annotation_row =</span> taxonomic_data, </span>
<span id="cb288-18"><a href="#cb288-18" aria-hidden="true" tabindex="-1"></a>                             <span class="at">annotation_colors =</span> ann_colors, </span>
<span id="cb288-19"><a href="#cb288-19" aria-hidden="true" tabindex="-1"></a>                             <span class="at">color =</span> colors, </span>
<span id="cb288-20"><a href="#cb288-20" aria-hidden="true" tabindex="-1"></a>                             <span class="at">breaks =</span> breaks,</span>
<span id="cb288-21"><a href="#cb288-21" aria-hidden="true" tabindex="-1"></a>                             <span class="at">clustering_distance_cols =</span> <span class="st">"euclidean"</span>, </span>
<span id="cb288-22"><a href="#cb288-22" aria-hidden="true" tabindex="-1"></a>                             <span class="at">clustering_method =</span> <span class="st">"complete"</span>)</span>
<span id="cb288-23"><a href="#cb288-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb288-24"><a href="#cb288-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># print plot</span></span>
<span id="cb288-25"><a href="#cb288-25" aria-hidden="true" tabindex="-1"></a>  genus_clusters</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb289"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="st">"../imgs/Figure_3E.png"</span>, </span>
<span id="cb289-2"><a href="#cb289-2" aria-hidden="true" tabindex="-1"></a>       genus_clusters,</span>
<span id="cb289-3"><a href="#cb289-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">20</span>,</span>
<span id="cb289-4"><a href="#cb289-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="determining-mean-centred-log-ratos" class="level2">
<h2 class="anchored" data-anchor-id="determining-mean-centred-log-ratos">7.3 Determining mean Centred log ratos</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb290"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combine CLR z-scores with Sample Conditions</span></span>
<span id="cb290-2"><a href="#cb290-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combine mat and sample_data</span></span>
<span id="cb290-3"><a href="#cb290-3" aria-hidden="true" tabindex="-1"></a>  clr_z_with_condition <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(mat))</span>
<span id="cb290-4"><a href="#cb290-4" aria-hidden="true" tabindex="-1"></a>  clr_z_with_condition<span class="sc">$</span>condition <span class="ot">&lt;-</span> sample_data<span class="sc">$</span>condition</span>
<span id="cb290-5"><a href="#cb290-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb290-6"><a href="#cb290-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Specify genera of interest</span></span>
<span id="cb290-7"><a href="#cb290-7" aria-hidden="true" tabindex="-1"></a>  genera_of_interest <span class="ot">&lt;-</span> top_Genus_above_1</span>
<span id="cb290-8"><a href="#cb290-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb290-9"><a href="#cb290-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb290-10"><a href="#cb290-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Identify genera present in the CLR z-score data</span></span>
<span id="cb290-11"><a href="#cb290-11" aria-hidden="true" tabindex="-1"></a>  valid_genera <span class="ot">&lt;-</span> <span class="fu">intersect</span>(genera_of_interest, <span class="fu">colnames</span>(clr_z_with_condition))</span>
<span id="cb290-12"><a href="#cb290-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb290-13"><a href="#cb290-13" aria-hidden="true" tabindex="-1"></a>  valid_genera <span class="ot">=</span> <span class="fu">c</span>(valid_genera, <span class="st">"g__Filifactor"</span>)</span>
<span id="cb290-14"><a href="#cb290-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb290-15"><a href="#cb290-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Subset for valid genera and condition</span></span>
<span id="cb290-16"><a href="#cb290-16" aria-hidden="true" tabindex="-1"></a>  clr_z_subset <span class="ot">&lt;-</span> clr_z_with_condition[, <span class="fu">c</span>(valid_genera, <span class="st">"condition"</span>)]</span>
<span id="cb290-17"><a href="#cb290-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb290-18"><a href="#cb290-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate mean z-scores</span></span>
<span id="cb290-19"><a href="#cb290-19" aria-hidden="true" tabindex="-1"></a>  mean_clr_z_scores <span class="ot">&lt;-</span> clr_z_subset <span class="sc">%&gt;%</span></span>
<span id="cb290-20"><a href="#cb290-20" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">group_by</span>(condition) <span class="sc">%&gt;%</span></span>
<span id="cb290-21"><a href="#cb290-21" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span> <span class="fu">mean</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.names =</span> <span class="st">"mean_{.col}"</span>))</span>
<span id="cb290-22"><a href="#cb290-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb290-23"><a href="#cb290-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate means</span></span>
<span id="cb290-24"><a href="#cb290-24" aria-hidden="true" tabindex="-1"></a>  mean_clr_z_scores <span class="ot">&lt;-</span> clr_z_subset <span class="sc">%&gt;%</span></span>
<span id="cb290-25"><a href="#cb290-25" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">group_by</span>(condition) <span class="sc">%&gt;%</span></span>
<span id="cb290-26"><a href="#cb290-26" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(valid_genera), <span class="sc">~</span> <span class="fu">mean</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb290-27"><a href="#cb290-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb290-28"><a href="#cb290-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># View the result</span></span>
<span id="cb290-29"><a href="#cb290-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(mean_clr_z_scores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 21
  condition g__Prevotella g__Streptococcus g__Neisseria g__Haemophilus
  &lt;chr&gt;             &lt;dbl&gt;            &lt;dbl&gt;        &lt;dbl&gt;          &lt;dbl&gt;
1 diseased          0.129           -0.940        0.196         -0.323
2 healthy          -0.110            0.799       -0.166          0.275
# ℹ 16 more variables: g__Veillonella &lt;dbl&gt;, g__Rothia &lt;dbl&gt;,
#   g__Fusobacterium &lt;dbl&gt;, g__Treponema &lt;dbl&gt;, g__Schaalia &lt;dbl&gt;,
#   g__Escherichia &lt;dbl&gt;, g__Aggregatibacter &lt;dbl&gt;, g__Selenomonas &lt;dbl&gt;,
#   g__Leptotrichia &lt;dbl&gt;, g__Actinomyces &lt;dbl&gt;, g__Campylobacter &lt;dbl&gt;,
#   g__Capnocytophaga &lt;dbl&gt;, g__Porphyromonas &lt;dbl&gt;, g__Bacteroides &lt;dbl&gt;,
#   g__Gemella &lt;dbl&gt;, g__Filifactor &lt;dbl&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb292"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb292-1"><a href="#cb292-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert to long format for ggplot</span></span>
<span id="cb292-2"><a href="#cb292-2" aria-hidden="true" tabindex="-1"></a>  clr_z_long <span class="ot">&lt;-</span> mean_clr_z_scores <span class="sc">%&gt;%</span> </span>
<span id="cb292-3"><a href="#cb292-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>condition, <span class="at">names_to =</span> <span class="st">"Genus"</span>, <span class="at">values_to =</span> <span class="st">"Mean_Z_Score"</span>)</span>
<span id="cb292-4"><a href="#cb292-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb292-5"><a href="#cb292-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb292-6"><a href="#cb292-6" aria-hidden="true" tabindex="-1"></a>  Mean_CLR_Z_Score <span class="ot">=</span> <span class="fu">ggplot</span>(clr_z_long, <span class="fu">aes</span>(<span class="at">x =</span> Mean_Z_Score, <span class="at">y =</span> condition, <span class="at">fill =</span> condition)) <span class="sc">+</span></span>
<span id="cb292-7"><a href="#cb292-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span>  <span class="co"># Black border around bars</span></span>
<span id="cb292-8"><a href="#cb292-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> Genus, <span class="at">scales =</span> <span class="st">"free_y"</span>, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># Separate panels for each genus</span></span>
<span id="cb292-9"><a href="#cb292-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Condition"</span>, <span class="at">y =</span> <span class="st">"Mean CLR Z-Score"</span>, <span class="at">fill =</span> <span class="st">"Condition"</span>, <span class="at">title =</span> <span class="st">"Mean CLR Z-Scores by Genus and Condition"</span>) <span class="sc">+</span></span>
<span id="cb292-10"><a href="#cb292-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb292-11"><a href="#cb292-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">size =</span> <span class="dv">1</span>))  <span class="co"># Add a border around each panel </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The `size` argument of `element_rect()` is deprecated as of ggplot2 3.4.0.
ℹ Please use the `linewidth` argument instead.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb294"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb294-1"><a href="#cb294-1" aria-hidden="true" tabindex="-1"></a>  Mean_CLR_Z_Score</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Noma-vs-healthy_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb295"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb295-1"><a href="#cb295-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="st">"../imgs/Figure_3F.png"</span>, </span>
<span id="cb295-2"><a href="#cb295-2" aria-hidden="true" tabindex="-1"></a>       Mean_CLR_Z_Score,</span>
<span id="cb295-3"><a href="#cb295-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">10</span>,</span>
<span id="cb295-4"><a href="#cb295-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>